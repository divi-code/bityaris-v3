import{a9 as k,b as p,a as v,d as D,U as c,al as m,m as u,bv as A,bw as C,bx as I,by as S,u as L}from"./chunk-19a327d5.js";import{a as P,B as l}from"./app-a93d0564.js";var h=(e=>(e[e.MAIL_CODE=1]="MAIL_CODE",e[e.OTP=2]="OTP",e[e.PASSKEY=3]="PASSKEY",e))(h||{}),x=(e=>(e.ADD="add",e.DELETE="delete",e))(x||{}),O=(e=>(e.errorAuthenticatorPreviouslyRegistered="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",e.errorPassThroughSeeCauseProperty="ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",e))(O||{});const E="passkey-enable-status",W=I,b=new P,w=new l({total:-1,rows:[]}),N=new P;new l({limit:!1});const _=new l({}),g=new l({}),i=new l({visible:!1});function z(e){return e+"/help-center/how-do-i-create-passkeys-web"}function U(){return localStorage.getItem(E)}function Q(e){if(!e)return;const s=(U()||"").split(",").filter(Boolean);s.indexOf(e.toString())>=0||(s.push(e),localStorage.setItem(E,s.join(",")))}async function M(e){const{publicKeyCredentialRequestOptions:t}=e||{};try{i.next({visible:!0});const s=await S(t);return i.next({visible:!1}),s}catch(s){i.next({visible:!1}),g.next(s),console.error("[Error]",s);return}}N.pipe(k(w),p(async e=>Y(e))).subscribe(e=>{e&&(_.next({type:"add",data:e}),b.next(null))});b.pipe(v(D),p(()=>B())).subscribe(e=>w.next(e));async function B(){const{data:e,error:t}=await c.queryPasskeyAccount();if(e){const s=e.rows.map(a=>({...a,creatTimeStr:a.createTime?m.formatDateTime(a.createTime):"-",lastUsedStr:a.lastUsedTime?m.formatDateTime(a.lastUsedTime):"-"}));return{...e,rows:s}}return t&&u.send("toast","error",t),{total:-1,rows:[]}}function X(e,t){return new Promise(async s=>{const{verifyType:a,action:r,rowData:d,codeData:o,verifyData:n}=e;if(r==="add"){const{data:R,error:y}=await $({verifyType:a,action:"add",...o},n);if(y){t==null||t(y),s({data:null,error:y});return}s({data:R,error:null});return}const{data:T,error:f}=await K({verifyType:a,action:"delete",rowData:d,...o},n);if(f){t==null||t(f),s({data:null,error:f});return}s({data:T,error:null})})}async function $(e,t){const{assertionRequest:s,...a}=t||{};if(e.verifyType===3){const r=await M(s);return r?await c.startRegisterPasskey({...a,credential:JSON.stringify(r)}):void 0}return q({flowId:t.flowId,code:t.code,...e})}async function K(e,t){var s;try{const{action:a,verifyType:r,rowData:d,...o}=e;let n;return r===3&&(i.next({visible:!0}),n=await S((s=t.assertionRequest)==null?void 0:s.publicKeyCredentialRequestOptions),i.next({visible:!1})),H(V(r,{...d,...o},t,n))}catch{return i.next({visible:!1}),null}}async function Y([e,t]){if(e){const{flowId:s,options:a}=e;let r;try{i.next({visible:!0}),r=await A(a),i.next({visible:!1})}catch(n){i.next({visible:!1}),g.next(n),console.error("[Error]",n);return}const d=t.total<=0?1:j(t.rows),o=`${C()} #${d}`;return F({flowId:s,credential:JSON.stringify(r),displayName:o,deviceType:"WEB"})}}async function Z(e){return await c.verifyPasskey({verifyType:e.verifyType,action:e.action})}async function q(e){return await c.startRegisterPasskey(e)}async function F(e){const{data:t,error:s}=await c.finishedRegisterPasskey({...e});if(t)return t;s&&u.send("toast","error",s)}async function H(e){return await c.removePasskey({...e})}async function ee({successMsg:e}){const{data:t,error:s}=await L.codesMail({type:"MAIL_GENERIC_VERIFY_CODE"});return t?(u.send("toast","info",{message:e}),{data:t}):(s&&u.send("toast","error",s),{})}function V(e,t,s,a){return{credId:t.credId,userCode:t.userCode,flowId:s.flowId,code:s.code,mailCode:e===1?t.mailCode:null,otpCode:e===2?t.otpCode:null,credential:e===3?JSON.stringify(a):null}}function j(e){const t=e.sort((s,a)=>s.createTime-a.creatTime>0?1:-1).map(s=>{const r=(s.displayName.split("#")[1]||"").trim().match(/^\d+/gi);return r&&r.length>0?r[0]:null}).filter(Boolean);return t.length>0&&!isNaN(t[0])?Number(t[0])+1:1}const te={Set:"daad6c",Manage:"ddc3fc",SettingTitle:"0e2825",SettingDesc:"6e436d",Recommend:"660d4c",SecurityCrumb:"53688c",LearnMore:"d04845",Add:"3e4b76",Rename:"ee274a",Remove:"29dd98",PasskeyName:"97ff1a",CreateTime:"76d862",LastUsed:"1ae683",Action:"6b4541",EnableTitle:"d10614",EnableDesc:"0147f7",Fingerprint:"f5fd03",PasskeyItemTitle1:"cd607a",PasskeyItemDesc1:"444793",PasskeyItemTitle2:"14e4eb",PasskeyItemDesc2:"19802b",PasskeyItemTitle3:"9796ae",PasskeyItemDesc3:"36ba17",EnableBtn:"68735e",VerifyIdentity:"0dcd41",VerifyIdentityDesc:"1b548a",VerifyPasskey:"f987a8",Verify2fa:"8fcfa2",VerifyEmail:"b56baf",SecurityVerify:"46aba8",SecurityEmailWarning:"14b94a",SecurityEmailDesc:"c1025e",SecurityEmailSend:"8591a6",EmailHolder:"65487a",SendCode:"e337e3",Resend:"56e3f5",Security2faDesc:"7d24d3",RenameTitle:"57a1dc",PasskeyLabel:"65f8c7",ConfirmBtn:"be3f28",LimitTitle:"1442c2",LimitDesc:"0bc12e",LimitBtn:"2de045",RemovePasskeyDesc:"d1aa60",AddPasskeyDesc:"433bcc",NameChangeTips:"2cdc11",AddSuccessTips:"8fcef1",RemoveSuccessTips:"22d8a5",ExistTips:"8b6d08",EmailSend:"434f6d",AddFailedTips:"bd4408",NotSupported:"5a9d12",ErrorOtpTips:"b6f016",ErrorEmailTips:"e83555"};export{x as A,h as I,O as W,b as a,ee as b,U as c,Z as d,g as e,N as f,z as g,W as i,te as l,i as m,w as p,Q as s,_ as t,X as v};
//# sourceMappingURL=chunk-1a38ff2e.js.map

import{c as tt,a9 as Re,ce as ve,ac as me,bD as Ee,S as Ce,i as Se,s as Be,bg as nt,X as q,ad as X,b8 as ze,k as V,D as y,l as W,G as Z,o as L,p as k,E as A,r as C,q as O,H as ne,t as G,v as ie,w as m,I as J,$ as Ie,F as re,ae as le,B as K,C as Q,J as Y,K as H,O as Ve,Y as Me,aa as it,cU as st,a8 as Ne,b as We,cV as at,cW as ot,aw as lt,co as Oe,m as He,P as Ue,Q as je,aZ as Fe,Z as $e,af as rt,ag as dt,a6 as ct,a5 as ft,cs as ut,ct as pt,cq as mt,cX as _t}from"./chunk-19a327d5.js";import{P as qe}from"./chunk-c0d4337d.js";import{B as oe,a as _e,m as se,s as ue,f as he}from"./app-a93d0564.js";import{M as ht}from"./chunk-906442ac.js";import{E as wt,P as gt}from"./chunk-16c1dbfc.js";import{V as bt}from"./chunk-7d33b922.js";const de=new oe(""),ce=new oe(""),Xe=new _e;function vt(){de.next(""),ce.next("")}const Ze=tt([de,ce]).pipe(se(([t,e])=>t&&!xe(t,ye)&&e&&!Ye(e,ye)),ue(!1)),Et=Xe.pipe(Re(Ze.pipe(he(Boolean))),ve(()=>me(()=>et({email:de.getValue(),pwd:ce.getValue()})).pipe(se(({code:t})=>({loading:!1,data:t})),Ee(({data:t})=>{t&&we.next(ae.verification)}),ue({loading:!0,data:{}}))));function ye(t){return t}const P={Email:"7997eb",EmailError:"32c422",Password:"51d08c",PasswordError:"427ec7",Bind:"f3667b",EmailVerification:"594a3c",Confirm:"65a720",Back:"4d2f55",SendAgain:"5c2a90",BindNewEmail:"70a4ab",BindIntro:"1fc71e",EmailVerificationTips:"470c47",EmailFillIntro:"e2fae3"};function Ct(t){let e=t[10](P.Bind)+"",n;return{c(){n=y(e)},l(i){n=A(i,e)},m(i,a){ie(i,n,a)},p:Me,d(i){i&&C(n)}}}function St(t){let e,n,i=t[10](P.BindNewEmail)+"",a,f,p,d=(t[0]==="bind"?t[10](P.BindIntro):t[10](P.EmailFillIntro))+"",c,b,h,_,s,w,B,g,F,v,I,D,R,U;nt(t[19]);function z(o){t[20](o)}let l={haveIcon:!1,isError:t[8],placeholder:t[10](P.Email),disabled:t[7]};t[2]!==void 0&&(l.value=t[2]),_=new wt({props:l}),q.push(()=>X(_,"value",z)),_.$on("focus",t[11]("email_input_box")),_.$on("blur",t[12]("email_input_box"));function j(o){t[21](o)}let M={placeholder:t[10](P.Password),disabled:t[7],isError:t[6],isPasswordTips:t[4],isShowPasswordTips:t[3],isShowSpecialCharacters:4,innerWidth:t[5],placement:t[5]>640?"left":"right"};return t[1]!==void 0&&(M.value=t[1]),g=new gt({props:M}),q.push(()=>X(g,"value",j)),g.$on("focus",t[11]("password_input_box")),g.$on("blur",t[12]("password_input_box")),I=new ze({props:{disabled:!t[9],loading:t[7],newRadius:!0,type:"primary",class:"submit-btn mt32 wp100 f16 fw2",$$slots:{default:[Ct]},$$scope:{ctx:t}}}),I.$on("click",t[13]),{c(){e=V("div"),n=V("h1"),a=y(i),f=W(),p=V("div"),c=y(d),b=W(),h=V("div"),Z(_.$$.fragment),w=W(),B=V("div"),Z(g.$$.fragment),v=W(),Z(I.$$.fragment),this.h()},l(o){e=L(o,"DIV",{class:!0});var u=k(e);n=L(u,"H1",{class:!0});var r=k(n);a=A(r,i),r.forEach(C),f=O(u),p=L(u,"DIV",{class:!0});var T=k(p);c=A(T,d),T.forEach(C),b=O(u),h=L(u,"DIV",{class:!0});var $=k(h);ne(_.$$.fragment,$),$.forEach(C),w=O(u),B=L(u,"DIV",{class:!0});var x=k(B);ne(g.$$.fragment,x),x.forEach(C),v=O(u),ne(I.$$.fragment,u),u.forEach(C),this.h()},h(){G(n,"class","p0 f32 b"),G(p,"class","text f14 fw1 mt8 svelte-1sdn96"),G(h,"class","mt20"),G(B,"class","mt20"),G(e,"class","order-form svelte-1sdn96")},m(o,u){ie(o,e,u),m(e,n),m(n,a),m(e,f),m(e,p),m(p,c),m(e,b),m(e,h),J(_,h,null),m(e,w),m(e,B),J(g,B,null),m(e,v),J(I,e,null),D=!0,R||(U=Ie(window,"resize",t[19]),R=!0)},p(o,[u]){(!D||u&1)&&d!==(d=(o[0]==="bind"?o[10](P.BindIntro):o[10](P.EmailFillIntro))+"")&&re(c,d);const r={};u&256&&(r.isError=o[8]),u&128&&(r.disabled=o[7]),!s&&u&4&&(s=!0,r.value=o[2],le(()=>s=!1)),_.$set(r);const T={};u&128&&(T.disabled=o[7]),u&64&&(T.isError=o[6]),u&16&&(T.isPasswordTips=o[4]),u&8&&(T.isShowPasswordTips=o[3]),u&32&&(T.innerWidth=o[5]),u&32&&(T.placement=o[5]>640?"left":"right"),!F&&u&2&&(F=!0,T.value=o[1],le(()=>F=!1)),g.$set(T);const $={};u&512&&($.disabled=!o[9]),u&128&&($.loading=o[7]),u&33554432&&($.$$scope={dirty:u,ctx:o}),I.$set($)},i(o){D||(K(_.$$.fragment,o),K(g.$$.fragment,o),K(I.$$.fragment,o),D=!0)},o(o){Q(_.$$.fragment,o),Q(g.$$.fragment,o),Q(I.$$.fragment,o),D=!1},d(o){o&&C(e),Y(_),Y(g),Y(I),R=!1,U()}}}function Bt(t,e,n){let i,a,f,p,d,c,b;H(t,Et,r=>n(18,p=r)),H(t,ce,r=>n(1,d=r)),H(t,de,r=>n(2,c=r)),H(t,Ze,r=>n(9,b=r));let{LG:h=null}=e,{email:_}=e,{preCode:s}=e,{pwd:w}=e,{scene:B}=e,g=h||Ve("LG"),F=!1,v=!0,I=1200;function D(r){const{loading:T,data:$}=r||{};T===!1&&$&&n(15,s=$)}function R(r){n(14,_=r)}function U(r){n(16,w=r)}function z(r){return function(){r==="password_input_box"&&(n(3,F=!0),n(4,v=!1))}}function l(r){return function(){r==="password_input_box"&&n(4,v=!0),a||n(3,F=!1)}}function j(){Xe.next({LG:h})}function M(){n(5,I=window.innerWidth)}function o(r){c=r,de.set(c)}function u(r){d=r,ce.set(d)}return t.$$set=r=>{"LG"in r&&n(17,h=r.LG),"email"in r&&n(14,_=r.email),"preCode"in r&&n(15,s=r.preCode),"pwd"in r&&n(16,w=r.pwd),"scene"in r&&n(0,B=r.scene)},t.$$.update=()=>{t.$$.dirty&4&&n(8,i=xe(c,g)),t.$$.dirty&2&&n(6,a=Ye(d,g)),t.$$.dirty&262144&&n(7,f=p&&p.loading),t.$$.dirty&4&&R(c),t.$$.dirty&2&&U(d),t.$$.dirty&262144&&D(p)},[B,d,c,F,v,I,a,f,i,b,g,z,l,j,_,s,w,h,p,M,o,u]}class It extends Ce{constructor(e){super(),Se(this,e,Bt,St,Be,{LG:17,email:14,preCode:15,pwd:16,scene:0})}}const Ae=60,fe=new oe(""),pe=new oe(""),Je=new _e;function Vt(){fe.next(""),pe.next("")}const Ke=fe.pipe(se(t=>t.length===6)),Lt=Je.pipe(Re(Ke.pipe(he(Boolean))),ve(([{preCode:t}])=>me(()=>Gt({preCode:t,emailCode:fe.getValue()})).pipe(se(e=>({loading:!1,data:e})),Ee(({data:e})=>{e||pe.next("fail")}),ue({loading:!0,data:!1})))),ge=new _e,Qe=ge.pipe(ve(t=>me(()=>t.sended?Ne({code:t.code}):et(t)).pipe(We(({code:e})=>at(0,1e3).pipe(ot(n=>n-1,Ae),se(n=>({loading:!1,time:n,code:e})),lt(Ae))),ue({loading:!0,time:0,code:""}))),it(1)),kt=Qe.pipe(he(t=>!t.loading),se(t=>t.code),st());async function Gt({preCode:t,emailCode:e}){const{data:n,error:i}=await Oe.bindEmail({preCode:t,emailCode:e});return i?(He.send("toast","error",i),!1):n==null?void 0:n.success}function Pt(t){let e,n,i=t[1](P.SendAgain)+"",a,f,p;return{c(){e=V("div"),n=V("a"),a=y(i),this.h()},l(d){e=L(d,"DIV",{class:!0});var c=k(e);n=L(c,"A",{href:!0});var b=k(n);a=A(b,i),b.forEach(C),c.forEach(C),this.h()},h(){G(n,"href","javascript:void(0)"),G(e,"class","f16 mt8")},m(d,c){ie(d,e,c),m(e,n),m(n,a),f||(p=Ie(n,"click",t[11]),f=!0)},p(d,c){c&2&&i!==(i=d[1](P.SendAgain)+"")&&re(a,i)},d(d){d&&C(e),f=!1,p()}}}function Dt(t){let e,n,i,a=t[4].time+"",f,p;return{c(){e=V("div"),n=y("Resend in "),i=V("div"),f=y(a),p=y("s"),this.h()},l(d){e=L(d,"DIV",{class:!0});var c=k(e);n=A(c,"Resend in "),i=L(c,"DIV",{class:!0});var b=k(i);f=A(b,a),p=A(b,"s"),b.forEach(C),c.forEach(C),this.h()},h(){G(i,"class","f16 BLUE fw2 ml4"),G(e,"class","df aic f16 light-color mt8 svelte-v8h6oz")},m(d,c){ie(d,e,c),m(e,n),m(e,i),m(i,f),m(i,p)},p(d,c){c&16&&a!==(a=d[4].time+"")&&re(f,a)},d(d){d&&C(e)}}}function Tt(t){let e=t[6](P.Confirm)+"",n;return{c(){n=y(e)},l(i){n=A(i,e)},m(i,a){ie(i,n,a)},p:Me,d(i){i&&C(n)}}}function Ft(t){let e,n,i,a,f,p,d,c=t[1](P.Back)+"",b,h,_,s=t[6](P.EmailVerification)+"",w,B,g,F=t[6](P.EmailVerificationTips)+"",v,I,D,R,U,z,l,j,M,o,u,r,T;l=new bt({props:{status:t[3],explain:$t}}),l.$on("codeChange",t[8]),l.$on("input",t[9]);function $(S,E){return S[4]&&S[4].time?Dt:Pt}let x=$(t),N=x(t);return o=new ze({props:{disabled:!t[5],loading:t[2],newRadius:!0,type:"primary",class:"submit-btn mt32 wp100 f16 fw2",$$slots:{default:[Tt]},$$scope:{ctx:t}}}),o.$on("click",t[10]),{c(){e=V("div"),n=V("div"),i=V("div"),a=V("i"),f=y(""),p=W(),d=V("span"),b=y(c),h=W(),_=V("h1"),w=y(s),B=W(),g=V("div"),v=y(F),I=W(),D=V("h3"),R=y(t[0]),U=W(),z=V("div"),Z(l.$$.fragment),j=W(),N.c(),M=W(),Z(o.$$.fragment),this.h()},l(S){e=L(S,"DIV",{class:!0});var E=k(e);n=L(E,"DIV",{class:!0});var ee=k(n);i=L(ee,"DIV",{class:!0});var te=k(i);a=L(te,"I",{class:!0});var Le=k(a);f=A(Le,""),Le.forEach(C),te.forEach(C),p=O(ee),d=L(ee,"SPAN",{class:!0});var ke=k(d);b=A(ke,c),ke.forEach(C),ee.forEach(C),h=O(E),_=L(E,"H1",{class:!0});var Ge=k(_);w=A(Ge,s),Ge.forEach(C),B=O(E),g=L(E,"DIV",{class:!0});var Pe=k(g);v=A(Pe,F),Pe.forEach(C),I=O(E),D=L(E,"H3",{class:!0});var De=k(D);R=A(De,t[0]),De.forEach(C),U=O(E),z=L(E,"DIV",{class:!0});var Te=k(z);ne(l.$$.fragment,Te),Te.forEach(C),j=O(E),N.l(E),M=O(E),ne(o.$$.fragment,E),E.forEach(C),this.h()},h(){G(a,"class","iconfont light-color svelte-v8h6oz"),G(i,"class","arrow svelte-v8h6oz"),G(d,"class","light-color ml10 svelte-v8h6oz"),G(n,"class","df aic cp"),G(_,"class","p0 mt20 f32 b"),G(g,"class","light-color f14 fw1 mt20 svelte-v8h6oz"),G(D,"class","p0 mt8 T1 fw2 f20"),G(z,"class","mt20"),G(e,"class","verification-wrap svelte-v8h6oz")},m(S,E){ie(S,e,E),m(e,n),m(n,i),m(i,a),m(a,f),m(n,p),m(n,d),m(d,b),m(e,h),m(e,_),m(_,w),m(e,B),m(e,g),m(g,v),m(e,I),m(e,D),m(D,R),m(e,U),m(e,z),J(l,z,null),m(e,j),N.m(e,null),m(e,M),J(o,e,null),u=!0,r||(T=Ie(n,"click",t[7]),r=!0)},p(S,[E]){(!u||E&2)&&c!==(c=S[1](P.Back)+"")&&re(b,c),(!u||E&1)&&re(R,S[0]);const ee={};E&8&&(ee.status=S[3]),l.$set(ee),x===(x=$(S))&&N?N.p(S,E):(N.d(1),N=x(S),N&&(N.c(),N.m(e,M)));const te={};E&32&&(te.disabled=!S[5]),E&4&&(te.loading=S[2]),E&1048576&&(te.$$scope={dirty:E,ctx:S}),o.$set(te)},i(S){u||(K(l.$$.fragment,S),K(o.$$.fragment,S),u=!0)},o(S){Q(l.$$.fragment,S),Q(o.$$.fragment,S),u=!1},d(S){S&&C(e),Y(l),N.d(),Y(o),r=!1,T()}}}let $t="";function yt(t,e,n){let i,a,f,p,d,c,b;H(t,fe,l=>n(16,a=l)),H(t,kt,l=>n(14,f=l)),H(t,Lt,l=>n(15,p=l)),H(t,pe,l=>n(3,d=l)),H(t,Qe,l=>n(4,c=l)),H(t,Ke,l=>n(5,b=l));let{email:h}=e,{pwd:_}=e,{preCode:s}=e,{LG:w=null}=e;const B=Ue();let g=w||Ve("LG");je(()=>{ge.next({sended:!0,code:s})});function F(l){l&&n(12,s=l)}function v(l){const{loading:j,data:M}=l||{};j===!1&&M&&B("bindSuccess",{preCode:s,email:h,emailCode:a})}function I(){we.next(ae.form)}function D(l){fe.next(l.detail.value)}function R(l){pe.next("")}function U(){Je.next({preCode:s})}function z(){ge.next({email:h,pwd:_})}return t.$$set=l=>{"email"in l&&n(0,h=l.email),"pwd"in l&&n(13,_=l.pwd),"preCode"in l&&n(12,s=l.preCode),"LG"in l&&n(1,w=l.LG)},t.$$.update=()=>{t.$$.dirty&32768&&n(2,i=p&&p.loading),t.$$.dirty&32768&&v(p),t.$$.dirty&16384&&F(f)},[h,w,i,d,c,b,g,I,D,R,U,z,s,_,f,p]}class At extends Ce{constructor(e){super(),Se(this,e,yt,Ft,Be,{email:0,pwd:13,preCode:12,LG:1})}}function Rt(t){let e,n,i,a,f,p;function d(s){t[9](s)}function c(s){t[10](s)}function b(s){t[11](s)}var h=t[5][t[4]];function _(s){let w={scene:s[0],LG:s[6]};return s[1]!==void 0&&(w.email=s[1]),s[2]!==void 0&&(w.preCode=s[2]),s[3]!==void 0&&(w.pwd=s[3]),{props:w}}return h&&(e=Fe(h,_(t)),q.push(()=>X(e,"email",d)),q.push(()=>X(e,"preCode",c)),q.push(()=>X(e,"pwd",b)),e.$on("bindSuccess",t[12])),{c(){e&&Z(e.$$.fragment),f=$e()},l(s){e&&ne(e.$$.fragment,s),f=$e()},m(s,w){e&&J(e,s,w),ie(s,f,w),p=!0},p(s,w){const B={};if(w&1&&(B.scene=s[0]),!n&&w&2&&(n=!0,B.email=s[1],le(()=>n=!1)),!i&&w&4&&(i=!0,B.preCode=s[2],le(()=>i=!1)),!a&&w&8&&(a=!0,B.pwd=s[3],le(()=>a=!1)),h!==(h=s[5][s[4]])){if(e){rt();const g=e;Q(g.$$.fragment,1,0,()=>{Y(g,1)}),dt()}h?(e=Fe(h,_(s)),q.push(()=>X(e,"email",d)),q.push(()=>X(e,"preCode",c)),q.push(()=>X(e,"pwd",b)),e.$on("bindSuccess",s[12]),Z(e.$$.fragment),K(e.$$.fragment,1),J(e,f.parentNode,f)):e=null}else h&&e.$set(B)},i(s){p||(e&&K(e.$$.fragment,s),p=!0)},o(s){e&&Q(e.$$.fragment,s),p=!1},d(s){s&&C(f),e&&Y(e,s)}}}function zt(t){let e,n;return e=new ht({props:{visible:!0,style:"width: 480px;",$$slots:{default:[Rt]},$$scope:{ctx:t}}}),e.$on("close",t[7]),{c(){Z(e.$$.fragment)},l(i){ne(e.$$.fragment,i)},m(i,a){J(e,i,a),n=!0},p(i,[a]){const f={};a&16415&&(f.$$scope={dirty:a,ctx:i}),e.$set(f)},i(i){n||(K(e.$$.fragment,i),n=!0)},o(i){Q(e.$$.fragment,i),n=!1},d(i){Y(e,i)}}}function Mt(t,e,n){let i;H(t,we,v=>n(4,i=v));let{LG:a=null}=e,{scene:f="bind"}=e;const p=Ue(),d={[ae.form]:It,[ae.verification]:At};let c=a||Ve("LG"),b="",h="",_="";je(()=>(be.next("visible"),()=>{be.next("hidden")}));function s(){p("close",null)}function w(v){b=v,n(1,b)}function B(v){h=v,n(2,h)}function g(v){_=v,n(3,_)}function F(v){ct.call(this,t,v)}return t.$$set=v=>{"LG"in v&&n(8,a=v.LG),"scene"in v&&n(0,f=v.scene)},[f,b,h,_,i,d,c,s,a,w,B,g,F]}class Nt extends Ce{constructor(e){super(),Se(this,e,Mt,zt,Be,{LG:8,scene:0})}}async function Wt(t){const{LG:e,scene:n}=t,i=ft.create(Nt,{LG:e,scene:n});return new Promise(a=>{i.$on("bindSuccess",function(f){i.$destroy(),a(f.detail)}),i.$on("close",function(){a(null)})})}function Ye(t,e){if(t&&!qe.PASSWORD.test(t))return e(P.PasswordError)}function xe(t,e){if(t&&!qe.EMAIL.test(t))return e(P.EmailError)}async function et({email:t,pwd:e}){const{data:n,error:i}=await Oe.preBindEmail({email:t,pwd:e});return i?(He.send("toast","error",i),{}):n||{}}const be=new oe(""),Ot=be.pipe(he(t=>t==="hidden")),ae={form:"inputEmailForm",verification:"codeEmailVerifivation"},we=new oe(ae.form);Ot.subscribe(()=>{we.next(ae.form),vt(),Vt()});const Ht=new _e,Qt=Ht.pipe(We(t=>ut(Ut(t),t).pipe(se(({email:e})=>({loading:!1,data:e})),ue({loading:!0,data:""}),pt(()=>Ne({loading:!1,data:""})))));function Ut(t){const{LG:e}=t;return mt([{name:"verifyEmail",generateObservable(n,i){return me(()=>Wt({LG:e})).pipe(Ee(a=>{if(!a)throw new _t("cancel bind")}))}}])}export{Qt as b,Wt as o,Ht as s};
//# sourceMappingURL=chunk-992598c4.js.map

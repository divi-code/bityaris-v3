import{a1 as H,$ as N,j as E,t as D,a0 as G,I as T,c as J,p as K}from"./chunk-e0c46928.js";import{e as B,v as j,t as L,m as k}from"./chunk-65793be5.js";import{o as Q,F as X,a as g,m as _,f as Z,B as v,s as tt}from"./app-5c09a141.js";import{m as R}from"./chunk-ded14b26.js";import{S as et,i as at,s as nt,c as q,a as O,m as z,t as U,b as x,d as F,a5 as st,f as h,h as S,j as A,k as w,l as b,o as M,p as y,q as W,r as C,u as Y,v as m,z as P}from"./chunk-dd975def.js";import{au as rt,aV as ot}from"./chunk-8016f002.js";import{l as $}from"./chunk-83bbee6e.js";function it(t,e,a){return a===void 0&&(a=1/0),Q(function(n,s){var r=e;return X(n,s,function(o,i){return t(r,o,i)},a,function(o){r=o},!1,void 0,function(){return r=null})})}const{notifier$:Vt,poll$:At,context:I}=H(dt,{pollInterval:10*1e3,pollTimes:25,shouldStopPollingAction:ct});function lt(t){return!t||t==="NEW"||t==="WAITING_REVIEW"}function Wt(){const t=I==null?void 0:I.timer;t&&setTimeout(t)}function ct(t){return!lt(t==null?void 0:t.cardStatus)}async function dt({orderId:t,side:e}){var n;const{data:a}=await N.getOrderList({orderId:t,side:e});return((n=a==null?void 0:a.rows)==null?void 0:n[0])||{}}const ut=new g,Dt=ut.pipe(E(L),B(({fiat:t,digitalCurrency:e})=>N.postBindCardPlaceOrder({fiatCurrency:t,digitalCurrency:e,side:"buy",channelName:"Mercuryo"})),D(G),_(t=>{var e,a;return{url:(e=t==null?void 0:t.data)==null?void 0:e.url,orderId:(a=t==null?void 0:t.data)==null?void 0:a.orderId}}),Z(({url:t})=>!!t)),ft=new g,Gt=ft.pipe(it(mt,{cardId:"",cardsMap:{},number:1}),_(({cardId:t})=>t),j({bufferSize:1,refCount:!0}));function mt(t,e){const{cardsMap:a,number:n=1}=t,{side:s}=e;return T(()=>N.getPaymentList({pageNum:0,pageSize:1e3,side:s})).pipe(_(r=>{var o;return((o=r==null?void 0:r.data)==null?void 0:o.rows)||[]}),_(r=>r.reduce((o,i)=>{if((i==null?void 0:i.channelName)==="Mercuryo"){const u=i==null?void 0:i.id;o.cardsMap[u]=i,!a[u]&&n>1&&(o.cardId=u)}return o},{cardId:"",cardsMap:{}})),_(r=>({...r,number:n+1})))}function _t(t){let e=t[0]($.Confirm)+"",a;return{c(){a=S(e)},l(n){a=M(n,e)},m(n,s){Y(n,a,s)},p(n,s){s&1&&e!==(e=n[0]($.Confirm)+"")&&P(a,e)},d(n){n&&y(a)}}}function pt(t){let e,a,n=t[0]($.Notice)+"",s,r,o,i,u,d,f;return d=new J({props:{class:"wp100 mt24",type:"primary",newRadius:!0,$$slots:{default:[_t]},$$scope:{ctx:t}}}),d.$on("click",t[2]),{c(){e=h("div"),a=h("div"),s=S(n),r=A(),o=h("div"),i=S(t[1]),u=A(),q(d.$$.fragment),this.h()},l(l){e=w(l,"DIV",{class:!0});var c=b(e);a=w(c,"DIV",{class:!0});var p=b(a);s=M(p,n),p.forEach(y),r=W(c),o=w(c,"DIV",{class:!0});var V=b(o);i=M(V,t[1]),V.forEach(y),u=W(c),O(d.$$.fragment,c),c.forEach(y),this.h()},h(){C(a,"class","df jcc f1 lh24 fw2 f18 T2 b"),C(o,"class","content ph24 pv24 f14 fw2 T2 svelte-ffg34h"),C(e,"class","wp100 df aic fdc")},m(l,c){Y(l,e,c),m(e,a),m(a,s),m(e,r),m(e,o),m(o,i),m(e,u),z(d,e,null),f=!0},p(l,c){(!f||c&1)&&n!==(n=l[0]($.Notice)+"")&&P(s,n),(!f||c&2)&&P(i,l[1]);const p={};c&17&&(p.$$scope={dirty:c,ctx:l}),d.$set(p)},i(l){f||(U(d.$$.fragment,l),f=!0)},o(l){x(d.$$.fragment,l),f=!1},d(l){l&&y(e),F(d)}}}function yt(t){let e,a;return e=new rt({props:{visible:!0,style:"width: 480px",$$slots:{default:[pt]},$$scope:{ctx:t}}}),{c(){q(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,s){z(e,n,s),a=!0},p(n,[s]){const r={};s&19&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){a||(U(e.$$.fragment,n),a=!0)},o(n){x(e.$$.fragment,n),a=!1},d(n){F(e,n)}}}function $t(t,e,a){let{LG:n}=e,{content:s}=e;const r=st();function o(){r("close")}return t.$$set=i=>{"LG"in i&&a(0,n=i.LG),"content"in i&&a(1,s=i.content)},[n,s,o]}class gt extends et{constructor(e){super(),at(this,e,$t,yt,nt,{LG:0,content:1})}}new v({});new v(!0);const vt=new v(null),ht=new g,wt=new v({});ht.pipe(E(L),B(t=>bt(t))).subscribe(t=>wt.next(t));async function bt(t){const{data:e,error:a}=await R.getPaymentList(t);if(e)return e.rows;a&&k.send("toast","error",a)}const Ct=new g;new v(null);const It=new g,Tt=It.pipe(ot(({params:t,LG:e})=>T(()=>R.addPayment(t)).pipe(D(G),_(a=>{var n;return{loading:!1,data:{...a.data||{},cardId:(n=a.data)==null?void 0:n.id}}}),tt({loading:!0,data:{}}))),j({bufferSize:1,refCount:!0}));Ct.pipe(E(L),B(({params:t,LG:e})=>St(t,e))).subscribe();async function St(t,e){const{data:a,error:n}=await R.addPayment(t);a&&(a.status==="NEW"&&vt.next(a.id),a.status==="WAITING_REVIEW"&&K.create(gt,{LG:e,content:e($.YourCardName)})),n&&k.send("toast","error",n)}export{Dt as a,Gt as b,ft as c,Tt as d,It as e,vt as f,Vt as g,ut as l,it as m,At as o,Wt as s};
//# sourceMappingURL=chunk-2a04b230.js.map

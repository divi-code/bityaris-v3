var gn=function(e,t){return gn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},gn(e,t)};function Qn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");gn(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function mi(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function hr(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(s){a={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function gr(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function ot(e){return typeof e=="function"}function fc(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Jr=fc(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function hi(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var kn=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=mi(a),c=s.next();!c.done;c=s.next()){var u=c.value;u.remove(this)}}catch(v){t={error:v}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else a.remove(this);var d=this.initialTeardown;if(ot(d))try{d()}catch(v){o=v instanceof Jr?v.errors:[v]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var b=mi(f),y=b.next();!y.done;y=b.next()){var m=y.value;try{gi(m)}catch(v){o=o??[],v instanceof Jr?o=gr(gr([],hr(o)),hr(v.errors)):o.push(v)}}}catch(v){n={error:v}}finally{try{y&&!y.done&&(i=b.return)&&i.call(b)}finally{if(n)throw n.error}}}if(o)throw new Jr(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)gi(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&hi(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&hi(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();kn.EMPTY;function yc(e){return e instanceof kn||e&&"closed"in e&&ot(e.remove)&&ot(e.add)&&ot(e.unsubscribe)}function gi(e){ot(e)?e():e.unsubscribe()}var In={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},En={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=En.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,gr([e,t],hr(r))):setTimeout.apply(void 0,gr([e,t],hr(r)))},clearTimeout:function(e){var t=En.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function bc(e){En.setTimeout(function(){var t=In.onUnhandledError;if(t)t(e);else throw e})}function Ei(){}var io=function(e){Qn(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,yc(r)&&r.add(n)):n.destination=Ec,n}return t.create=function(r,n,i){return new hc(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(kn),vc=Function.prototype.bind;function Zr(e,t){return vc.call(e,t)}var mc=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){ir(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){ir(n)}else ir(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){ir(r)}},e}(),hc=function(e){Qn(t,e);function t(r,n,i){var o=e.call(this)||this,a;if(ot(r)||!r)a={next:r??void 0,error:n??void 0,complete:i??void 0};else{var s;o&&In.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return o.unsubscribe()},a={next:r.next&&Zr(r.next,s),error:r.error&&Zr(r.error,s),complete:r.complete&&Zr(r.complete,s)}):a=r}return o.destination=new mc(a),o}return t}(io);function ir(e){bc(e)}function gc(e){throw e}var Ec={closed:!0,next:Ei,error:gc,complete:Ei};function Sc(e){return e}function Pc(e){return ot(e==null?void 0:e.lift)}function Dn(e){return function(t){if(Pc(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Mn(e,t,r,n,i){return new Tc(e,t,r,n,i)}var Tc=function(e){Qn(t,e);function t(r,n,i,o,a,s){var c=e.call(this,r)||this;return c.onFinalize=a,c.shouldUnsubscribe=s,c._next=n?function(u){try{n(u)}catch(d){r.error(d)}}:e.prototype._next,c._error=o?function(u){try{o(u)}catch(d){r.error(d)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(io);function oo(e,t){return Dn(function(r,n){var i=0;r.subscribe(Mn(n,function(o){n.next(e.call(t,o,i++))}))})}function Nn(e,t){return Dn(function(r,n){var i=0;r.subscribe(Mn(n,function(o){return e.call(t,o,i++)&&n.next(o)}))})}function wc(e,t){return t===void 0&&(t=Sc),e=e??xc,Dn(function(r,n){var i,o=!0;r.subscribe(Mn(n,function(a){var s=t(a);(o||!e(i,s))&&(o=!1,i=s,n.next(a))}))})}function xc(e,t){return e===t}Array.prototype.toObject=function(e,t=r=>r){return this.reduce((r,n)=>(r[n[e]]=t(n),r),{})};EventTarget.prototype.subscribe=function(e,t){return this.addEventListener(e,t),()=>this.removeEventListener(e,t)};Map.prototype.toObject=function(e=t=>t){return Array.from(this.entries()).reduce((t,[r,n])=>(t[r]=e(n),t),{})};Map.prototype.toArray=function(e=t=>t){return Array.from(this.values(),e)};function ce(e){return typeof e=="function"}function Bc(e){return ce(e==null?void 0:e.lift)}function he(e){return function(t){if(Bc(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Sn=function(e,t){return Sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Sn(e,t)};function Fe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Sn(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Oc(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function s(d){try{u(n.next(d))}catch(f){a(f)}}function c(d){try{u(n.throw(d))}catch(f){a(f)}}function u(d){d.done?o(d.value):i(d.value).then(s,c)}u((n=n.apply(e,t||[])).next())})}function so(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(d){u=[6,d],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function wt(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ze(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(s){a={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function We(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function Pt(e){return this instanceof Pt?(this.v=e,this):new Pt(e)}function Rc(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(y){return function(m){return Promise.resolve(m).then(y,f)}}function s(y,m){n[y]&&(i[y]=function(v){return new Promise(function(E,S){o.push([y,v,E,S])>1||c(y,v)})},m&&(i[y]=m(i[y])))}function c(y,m){try{u(n[y](m))}catch(v){b(o[0][3],v)}}function u(y){y.value instanceof Pt?Promise.resolve(y.value.v).then(d,f):b(o[0][2],y)}function d(y){c("next",y)}function f(y){c("throw",y)}function b(y,m){y(m),o.shift(),o.length&&c(o[0][0],o[0][1])}}function Cc(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof wt=="function"?wt(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(a){return new Promise(function(s,c){a=e[o](a),i(s,c,a.done,a.value)})}}function i(o,a,s,c){Promise.resolve(c).then(function(u){o({value:u,done:s})},a)}}var ao=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function co(e){return ce(e==null?void 0:e.then)}function uo(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var en=uo(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Er(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var lt=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=wt(a),c=s.next();!c.done;c=s.next()){var u=c.value;u.remove(this)}}catch(v){t={error:v}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else a.remove(this);var d=this.initialTeardown;if(ce(d))try{d()}catch(v){o=v instanceof en?v.errors:[v]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var b=wt(f),y=b.next();!y.done;y=b.next()){var m=y.value;try{Si(m)}catch(v){o=o??[],v instanceof en?o=We(We([],ze(o)),ze(v.errors)):o.push(v)}}}catch(v){n={error:v}}finally{try{y&&!y.done&&(i=b.return)&&i.call(b)}finally{if(n)throw n.error}}}if(o)throw new en(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Si(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&Er(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&Er(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),lo=lt.EMPTY;function po(e){return e instanceof lt||e&&"closed"in e&&ce(e.remove)&&ce(e.add)&&ce(e.unsubscribe)}function Si(e){ce(e)?e():e.unsubscribe()}var fo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Qc={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,We([e,t],ze(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function yo(e){Qc.setTimeout(function(){throw e})}function Ft(){}function yr(e){e()}var Cr=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,po(r)&&r.add(n)):n.destination=Mc,n}return t.create=function(r,n,i){return new Ut(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(lt),kc=Function.prototype.bind;function tn(e,t){return kc.call(e,t)}var Ic=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){or(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){or(n)}else or(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){or(r)}},e}(),Ut=function(e){Fe(t,e);function t(r,n,i){var o=e.call(this)||this,a;if(ce(r)||!r)a={next:r??void 0,error:n??void 0,complete:i??void 0};else{var s;o&&fo.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return o.unsubscribe()},a={next:r.next&&tn(r.next,s),error:r.error&&tn(r.error,s),complete:r.complete&&tn(r.complete,s)}):a=r}return o.destination=new Ic(a),o}return t}(Cr);function or(e){yo(e)}function Dc(e){throw e}var Mc={closed:!0,next:Ft,error:Dc,complete:Ft},_n=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function pt(e){return e}function Nc(e){return e.length===0?pt:e.length===1?e[0]:function(t){return e.reduce(function(r,n){return n(r)},t)}}var xe=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,o=qc(t)?t:new Ut(t,r,n);return yr(function(){var a=i,s=a.operator,c=a.source;o.add(s?s.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Pi(r),new r(function(i,o){var a=new Ut({next:function(s){try{t(s)}catch(c){o(c),a.unsubscribe()}},error:o,complete:i});n.subscribe(a)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[_n]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Nc(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Pi(t),new t(function(n,i){var o;r.subscribe(function(a){return o=a},function(a){return i(a)},function(){return n(o)})})},e.create=function(t){return new e(t)},e}();function Pi(e){var t;return(t=e??fo.Promise)!==null&&t!==void 0?t:Promise}function _c(e){return e&&ce(e.next)&&ce(e.error)&&ce(e.complete)}function qc(e){return e&&e instanceof Cr||_c(e)&&po(e)}function bo(e){return ce(e[_n])}function vo(e){return Symbol.asyncIterator&&ce(e==null?void 0:e[Symbol.asyncIterator])}function mo(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ac(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ho=Ac();function go(e){return ce(e==null?void 0:e[ho])}function Eo(e){return Rc(this,arguments,function(){var t,r,n,i;return so(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Pt(t.read())];case 3:return r=o.sent(),n=r.value,i=r.done,i?[4,Pt(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Pt(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function So(e){return ce(e==null?void 0:e.getReader)}function Se(e){if(e instanceof xe)return e;if(e!=null){if(bo(e))return Fc(e);if(ao(e))return Uc(e);if(co(e))return Lc(e);if(vo(e))return Po(e);if(go(e))return jc(e);if(So(e))return Vc(e)}throw mo(e)}function Fc(e){return new xe(function(t){var r=e[_n]();if(ce(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Uc(e){return new xe(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Lc(e){return new xe(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,yo)})}function jc(e){return new xe(function(t){var r,n;try{for(var i=wt(e),o=i.next();!o.done;o=i.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function Po(e){return new xe(function(t){zc(e,t).catch(function(r){return t.error(r)})})}function Vc(e){return Po(Eo(e))}function zc(e,t){var r,n,i,o;return Oc(this,void 0,void 0,function(){var a,s;return so(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=Cc(e),c.label=1;case 1:return[4,r.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(a=n.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),i={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function de(e,t,r,n,i){return new Wc(e,t,r,n,i)}var Wc=function(e){Fe(t,e);function t(r,n,i,o,a,s){var c=e.call(this,r)||this;return c.onFinalize=a,c.shouldUnsubscribe=s,c._next=n?function(u){try{n(u)}catch(d){r.error(d)}}:e.prototype._next,c._error=o?function(u){try{o(u)}catch(d){r.error(d)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(Cr),$c=function(e){Fe(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(lt),Pn={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Pn.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,We([e,t],ze(r))):setInterval.apply(void 0,We([e,t],ze(r)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Hc=function(e){Fe(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var o=this.id,a=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(a,o,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),Pn.setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Pn.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,o;try{this.work(r)}catch(a){i=!0,o=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,i=r.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Er(o,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}($c),qn={now:function(){return(qn.delegate||Date).now()},delegate:void 0},Ti=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=qn.now,e}(),Xc=function(e){Fe(t,e);function t(r,n){n===void 0&&(n=Ti.now);var i=e.call(this,r,n)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var i;this._active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(Ti),Bt=new Xc(Hc),Yc=Bt;function To(e){return e&&ce(e.schedule)}function Gc(e){return e instanceof Date&&!isNaN(e)}function An(e,t,r){e===void 0&&(e=0),r===void 0&&(r=Yc);var n=-1;return t!=null&&(To(t)?r=t:n=t),new xe(function(i){var o=Gc(e)?+e-r.now():e;o<0&&(o=0);var a=0;return r.schedule(function(){i.closed||(i.next(a++),0<=n?this.schedule(void 0,n):i.complete())},o)})}function Fn(e){return e[e.length-1]}function wo(e){return ce(Fn(e))?e.pop():void 0}function Qr(e){return To(Fn(e))?e.pop():void 0}function Kc(e,t){return typeof Fn(e)=="number"?e.pop():t}function Ve(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!i)return o}var Jc=Array.isArray,Zc=Object.getPrototypeOf,eu=Object.prototype,tu=Object.keys;function ru(e){if(e.length===1){var t=e[0];if(Jc(t))return{args:t,keys:null};if(nu(t)){var r=tu(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function nu(e){return e&&typeof e=="object"&&Zc(e)===eu}function xo(e,t){return t===void 0&&(t=0),he(function(r,n){r.subscribe(de(n,function(i){return Ve(n,e,function(){return n.next(i)},t)},function(){return Ve(n,e,function(){return n.complete()},t)},function(i){return Ve(n,e,function(){return n.error(i)},t)}))})}function Bo(e,t){return t===void 0&&(t=0),he(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function iu(e,t){return Se(e).pipe(Bo(t),xo(t))}function ou(e,t){return Se(e).pipe(Bo(t),xo(t))}function su(e,t){return new xe(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function au(e,t){return new xe(function(r){var n;return Ve(r,t,function(){n=e[ho](),Ve(r,t,function(){var i,o,a;try{i=n.next(),o=i.value,a=i.done}catch(s){r.error(s);return}a?r.complete():r.next(o)},0,!0)}),function(){return ce(n==null?void 0:n.return)&&n.return()}})}function Oo(e,t){if(!e)throw new Error("Iterable cannot be null");return new xe(function(r){Ve(r,t,function(){var n=e[Symbol.asyncIterator]();Ve(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function cu(e,t){return Oo(Eo(e),t)}function uu(e,t){if(e!=null){if(bo(e))return iu(e,t);if(ao(e))return su(e,t);if(co(e))return ou(e,t);if(vo(e))return Oo(e,t);if(go(e))return au(e,t);if(So(e))return cu(e,t)}throw mo(e)}function kr(e,t){return t?uu(e,t):Se(e)}function l(e,t){return he(function(r,n){var i=0;r.subscribe(de(n,function(o){n.next(e.call(t,o,i++))}))})}var lu=Array.isArray;function pu(e,t){return lu(t)?e.apply(void 0,We([],ze(t))):e(t)}function du(e){return l(function(t){return pu(e,t)})}function fu(e,t){return e.reduce(function(r,n,i){return r[n]=t[i],r},{})}function B(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e),n=wo(e),i=ru(e),o=i.args,a=i.keys;if(o.length===0)return kr([],r);var s=new xe(yu(o,r,a?function(c){return fu(a,c)}:pt));return n?s.pipe(du(n)):s}function yu(e,t,r){return r===void 0&&(r=pt),function(n){wi(t,function(){for(var i=e.length,o=new Array(i),a=i,s=i,c=function(d){wi(t,function(){var f=kr(e[d],t),b=!1;f.subscribe(de(n,function(y){o[d]=y,b||(b=!0,s--),s||n.next(r(o.slice()))},function(){--a||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function wi(e,t,r){e?Ve(r,e,t):t()}function bu(e,t,r,n,i,o,a,s){var c=[],u=0,d=0,f=!1,b=function(){f&&!c.length&&!u&&t.complete()},y=function(v){return u<n?m(v):c.push(v)},m=function(v){o&&t.next(v),u++;var E=!1;Se(r(v,d++)).subscribe(de(t,function(S){i==null||i(S),o?y(S):t.next(S)},function(){E=!0},void 0,function(){if(E)try{u--;for(var S=function(){var w=c.shift();a?Ve(t,a,function(){return m(w)}):m(w)};c.length&&u<n;)S();b()}catch(w){t.error(w)}}))};return e.subscribe(de(t,y,function(){f=!0,b()})),function(){s==null||s()}}function Un(e,t,r){return r===void 0&&(r=1/0),ce(t)?Un(function(n,i){return l(function(o,a){return t(n,o,i,a)})(Se(e(n,i)))},r):(typeof t=="number"&&(r=t),he(function(n,i){return bu(n,i,e,r)}))}function vu(e,t,r,n,i){return function(o,a){var s=r,c=t,u=0;o.subscribe(de(a,function(d){var f=u++;c=s?e(c,d,f):(s=!0,d),n&&a.next(c)},i&&function(){s&&a.next(c),a.complete()}))}}function dt(e){return e===void 0&&(e=1/0),Un(pt,e)}function mu(){return dt(1)}var hu=uo(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ue=function(e){Fe(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new xi(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new hu},t.prototype.next=function(r){var n=this;yr(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=wt(n.currentObservers),s=a.next();!s.done;s=a.next()){var c=s.value;c.next(r)}}catch(u){i={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;yr(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;yr(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,a=i.isStopped,s=i.observers;return o||a?lo:(this.currentObservers=null,s.push(r),new lt(function(){n.currentObservers=null,Er(s,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,a=n.isStopped;i?r.error(o):a&&r.complete()},t.prototype.asObservable=function(){var r=new xe;return r.source=this,r},t.create=function(r,n){return new xi(r,n)},t}(xe),xi=function(e){Fe(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:lo},t}(ue);function Ln(e,t){return t===void 0&&(t=Bt),he(function(r,n){var i=null,o=null,a=null,s=function(){if(i){i.unsubscribe(),i=null;var u=o;o=null,n.next(u)}};function c(){var u=a+e,d=t.now();if(d<u){i=this.schedule(void 0,u-d),n.add(i);return}s()}r.subscribe(de(n,function(u){o=u,a=t.now(),i||(i=t.schedule(c,e),n.add(i))},function(){s(),n.complete()},void 0,function(){o=i=null}))})}function Tn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return mu()(kr(e,Qr(e)))}var jn=new xe(function(e){return e.complete()});function Ke(e){return e<=0?function(){return jn}:he(function(t,r){var n=0;t.subscribe(de(r,function(i){++n<=e&&(r.next(i),e<=n&&r.complete())}))})}function gu(){return he(function(e,t){e.subscribe(de(t,Ft))})}function qt(e){return l(function(){return e})}function Ro(e,t){return t?function(r){return Tn(t.pipe(Ke(1),gu()),r.pipe(Ro(e)))}:Un(function(r,n){return Se(e(r,n)).pipe(Ke(1),qt(r))})}function Ot(e,t){t===void 0&&(t=Bt);var r=An(e,t);return Ro(function(){return r})}function Ie(e,t){return t===void 0&&(t=pt),e=e??Eu,he(function(r,n){var i,o=!0;r.subscribe(de(n,function(a){var s=t(a);(o||!e(i,s))&&(o=!1,i=s,n.next(a))}))})}function Eu(e,t){return e===t}function h(e,t){return he(function(r,n){var i=0;r.subscribe(de(n,function(o){return e.call(t,o,i++)&&n.next(o)}))})}function Su(e,t){return function(r,n){return!e.call(t,r,n)}}function Pu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.length;if(r===0)throw new Error("list of properties cannot be empty.");return l(function(n){for(var i=n,o=0;o<r;o++){var a=i==null?void 0:i[e[o]];if(typeof a<"u")i=a;else return}return i})}var Oe=function(e){Fe(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(ue),V=function(e){Fe(t,e);function t(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=qn);var o=e.call(this)||this;return o._bufferSize=r,o._windowTime=n,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,r),o._windowTime=Math.max(1,n),o}return t.prototype.next=function(r){var n=this,i=n.isStopped,o=n._buffer,a=n._infiniteTimeWindow,s=n._timestampProvider,c=n._windowTime;i||(o.push(r),!a&&o.push(s.now()+c)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,o=i._infiniteTimeWindow,a=i._buffer,s=a.slice(),c=0;c<s.length&&!r.closed;c+=o?1:2)r.next(s[c]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,o=r._buffer,a=r._infiniteTimeWindow,s=(a?1:2)*n;if(n<1/0&&s<o.length&&o.splice(0,o.length-s),!a){for(var c=i.now(),u=0,d=1;d<o.length&&o[d]<=c;d+=2)u=d;u&&o.splice(0,u+1)}},t}(ue);function Tu(e){return he(function(t,r){var n,i=!1,o,a=function(){n=t.subscribe(de(r,void 0,void 0,function(s){o||(o=new ue,Se(e(o)).subscribe(de(r,function(){return n?a():i=!0}))),o&&o.next(s)})),i&&(n.unsubscribe(),n=null,i=!1,a())};a()})}function wu(e,t){return e===void 0&&(e=0),t===void 0&&(t=Bt),e<0&&(e=0),An(e,e,t)}function H(e,t){return he(vu(e,t,arguments.length>=2,!0))}function ft(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new ue}:t,n=e.resetOnError,i=n===void 0?!0:n,o=e.resetOnComplete,a=o===void 0?!0:o,s=e.resetOnRefCountZero,c=s===void 0?!0:s;return function(u){var d,f,b,y=0,m=!1,v=!1,E=function(){f==null||f.unsubscribe(),f=void 0},S=function(){E(),d=b=void 0,m=v=!1},w=function(){var T=d;S(),T==null||T.unsubscribe()};return he(function(T,P){y++,!v&&!m&&E();var x=b=b??r();P.add(function(){y--,y===0&&!v&&!m&&(f=rn(w,c))}),x.subscribe(P),!d&&y>0&&(d=new Ut({next:function(O){return x.next(O)},error:function(O){v=!0,E(),f=rn(S,i,O),x.error(O)},complete:function(){m=!0,E(),f=rn(S,a),x.complete()}}),Se(T).subscribe(d))})(u)}}function rn(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var i=new Ut({next:function(){i.unsubscribe(),e()}});return Se(t.apply(void 0,We([],ze(r)))).subscribe(i)}}function ie(e,t,r){var n,i,o,a,s=!1;return e&&typeof e=="object"?(n=e.bufferSize,a=n===void 0?1/0:n,i=e.windowTime,t=i===void 0?1/0:i,o=e.refCount,s=o===void 0?!1:o,r=e.scheduler):a=e??1/0,ft({connector:function(){return new V(a,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}function Y(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e);return he(function(n,i){(r?Tn(e,n,r):Tn(e,n)).subscribe(i)})}function Je(e,t){return he(function(r,n){var i=null,o=0,a=!1,s=function(){return a&&!i&&n.complete()};r.subscribe(de(n,function(c){i==null||i.unsubscribe();var u=0,d=o++;Se(e(c,d)).subscribe(i=de(n,function(f){return n.next(t?t(c,f,d,u++):f)},function(){i=null,s()}))},function(){a=!0,s()}))})}function xu(e,t){return ce(t)?Je(function(){return e},t):Je(function(){return e})}function Bu(e){return he(function(t,r){Se(e).subscribe(de(r,function(){return r.complete()},Ft)),!r.closed&&t.subscribe(r)})}function Vn(e,t,r){var n=ce(e)||t||r?{next:e,error:t,complete:r}:e;return n?he(function(i,o){var a;(a=n.subscribe)===null||a===void 0||a.call(n);var s=!0;i.subscribe(de(o,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),o.next(c)},function(){var c;s=!1,(c=n.complete)===null||c===void 0||c.call(n),o.complete()},function(c){var u;s=!1,(u=n.error)===null||u===void 0||u.call(n,c),o.error(c)},function(){var c,u;s&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):pt}var Co={leading:!0,trailing:!1};function Ou(e,t){return t===void 0&&(t=Co),he(function(r,n){var i=t.leading,o=t.trailing,a=!1,s=null,c=null,u=!1,d=function(){c==null||c.unsubscribe(),c=null,o&&(y(),u&&n.complete())},f=function(){c=null,u&&n.complete()},b=function(m){return c=Se(e(m)).subscribe(de(n,d,f))},y=function(){if(a){a=!1;var m=s;s=null,n.next(m),!u&&b(m)}};r.subscribe(de(n,function(m){a=!0,s=m,!(c&&!c.closed)&&(i?y():b(m))},function(){u=!0,!(o&&a&&c&&!c.closed)&&n.complete()}))})}function ge(e,t,r){t===void 0&&(t=Bt),r===void 0&&(r=Co);var n=An(e,t);return Ou(function(){return n},r)}function we(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=wo(e);return he(function(n,i){for(var o=e.length,a=new Array(o),s=e.map(function(){return!1}),c=!1,u=function(f){Se(e[f]).subscribe(de(i,function(b){a[f]=b,!c&&!s[f]&&(s[f]=!0,(c=s.every(pt))&&(s=null))},Ft))},d=0;d<o;d++)u(d);n.subscribe(de(i,function(f){if(c){var b=We([f],ze(a));i.next(r?r.apply(void 0,We([],ze(b))):b)}}))})}function F(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Qr(e),n=Kc(e,1/0),i=e;return i.length?i.length===1?Se(i[0]):dt(n)(kr(i,r)):jn}function Qo(e,t,r){return[h(t,r)(Se(e)),h(Su(t,r))(Se(e))]}const G=new ue,N=new ue;addEventListener("message",({data:e})=>G.next(e));N.subscribe(e=>postMessage(e));let ko=!1;G.subscribe(e=>{e.type==="ty-ready"&&(ko=!0)});const br=[];function Ir(e,t){br.push({event:e,params:t})}const Ru=wu(150);Ru.pipe(h(()=>ko&&br.length>0)).subscribe(()=>{const{event:e,params:t}=br[0];N.next({type:"et-track",data:{event:e,params:t}}),br.shift()});class Cu extends ue{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.next)===null||n===void 0||n.call(r,t)}error(t){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.error)===null||n===void 0||n.call(r,t)}complete(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)}_subscribe(t){var r,n;return(n=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&n!==void 0?n:lt.EMPTY}}const Qu={url:"",pingPongInterval:3e3,pingPongTimeout:1e4,deserializer:e=>JSON.parse(e.data),serializer:e=>JSON.stringify(e)},ku="WebsocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }";class Iu extends Cu{constructor(t){super(),this.idCounter=1,this.url=null,this.isReset=!0,this._socket=null,this.idCounter=1,this.url=null,this.isReset=!0,this._socket=null,this._config=Object.assign({},Qu,t),this._output=new ue,this._heartbeatSuccessObserver=new ue,this._heartbeatSuccessObserver.pipe(ge(1e4)).subscribe(r=>t.tyObserver.next(r)),this.destination=new V}_resetState(){this.idCounter=1,this.isReset=!0,this._socket=null,this.source||(this.destination=new V),this._output=new ue}send(t){const{_socket:r}=this,{tyObserver:n}=this._config;if(!r||r.readyState!==1)return jn;const i=this.idCounter++;return this.next(Object.assign(Object.assign({},t),{id:i})),this._output.pipe(h(o=>o.id===i),Ke(1),l(o=>(o.error&&n.next(Ge("ws_error",Date.now(),r==null?void 0:r.guid,JSON.stringify(o.error))),o)))}_connectSocket(t){const{WebSocketCtor:r,openingObserver:n,tyObserver:i,protocol:o,binaryType:a}=this._config;n&&n.next();const s=this._output;let c=null;const u=Date.now();try{c=o?new r(t,o):new r(t),c.guid=Math.floor(Math.random()*1e4),this._socket=c,a&&(this._socket.binaryType=a)}catch(f){i.next(Ge("ws_open_fail",u)),s.error(f);return}const d=new lt(()=>{this._socket=null,c&&c.readyState===1&&c.close()});c.onopen=f=>{const{_socket:b}=this;if(i.next(Ge("ws_open_success",u,b.guid)),!b){c.close(),this._resetState();return}const{openedObserver:y}=this._config;y&&y.next();const m=this.destination;this.destination=new Cr({next:v=>{if(c.readyState===1)try{const{serializer:E}=this._config;v.id===void 0&&(v.id=this.idCounter++);const S=E(v);v.method!=="server.ping"&&v.method!=="tick.subscribe"&&i.next(Ge("ws_subscribe",u,c.guid,S)),c.send(S)}catch(E){this.destination.error(E)}},error:v=>{const{closingObserver:E}=this._config;E&&E.next(void 0),v&&v.code?c.close(v.code,v.reason):s.error(new TypeError(ku)),this._resetState()},complete:()=>{const{closingObserver:v}=this._config;v&&v.next(void 0),c.close(),this._resetState()}}),m&&m instanceof V&&d.add(m.subscribe(this.destination)),this._startPingPong()},c.onerror=f=>{var b,y;const m=f.currentTarget;i.next(Ge("ws_error",u,m==null?void 0:m.guid)),!(((b=this===null||this===void 0?void 0:this._socket)===null||b===void 0?void 0:b.readyState)<2&&((y=this===null||this===void 0?void 0:this._socket)===null||y===void 0?void 0:y.guid)!==(m==null?void 0:m.guid))&&(this._resetState(),s.error(f))},c.onclose=f=>{var b,y;const m=f.currentTarget;if(i.next(Ge("ws_close",u,m==null?void 0:m.guid,JSON.stringify({code:f==null?void 0:f.code}))),((b=this===null||this===void 0?void 0:this._socket)===null||b===void 0?void 0:b.readyState)<2&&((y=this===null||this===void 0?void 0:this._socket)===null||y===void 0?void 0:y.guid)!==(m==null?void 0:m.guid))return;this._resetState();const{closedObserver:v}=this._config;v&&v.next(),s.error(f)},c.onmessage=f=>{var b,y;try{const m=f.currentTarget;if(((b=this===null||this===void 0?void 0:this._socket)===null||b===void 0?void 0:b.readyState)<2&&((y=this===null||this===void 0?void 0:this._socket)===null||y===void 0?void 0:y.guid)!==(m==null?void 0:m.guid))return;const{deserializer:v}=this._config,E=v(f),S=Object.assign({},E,{guid:m==null?void 0:m.guid});s.next(S)}catch(m){s.error(m)}}}_startPingPong(){const{_socket:t,_output:r}=this;if(!t||t.readyState!==1)return;const n=Date.now(),i=setTimeout(()=>{const{pingPongTimeoutObserver:a,tyObserver:s}=this._config;a&&a.next(),t&&t.readyState<2&&(t.close(),r.error("timeout")),s.next(Ge("ws_heartbeat_timeout",n,t.guid))},this._config.pingPongTimeout);r.pipe(Ke(1)).subscribe(()=>{clearTimeout(i)});const o=this.idCounter++;r.pipe(h(a=>a.id===o),Ke(1)).subscribe(()=>{const{delayObserver:a,pingPongInterval:s}=this._config;a&&a.next(Date.now()-n),this._heartbeatSuccessObserver.next(Ge("ws_heartbeat_success",n)),setTimeout(()=>this._startPingPong(),s)}),this.next({method:"server.ping",params:[],id:o})}_subscribe(t){const{source:r}=this;if(r)return r.subscribe(t);if(this.isReset){this.isReset=!1;const{_config:n}=this,{urlObservable:i}=n,o=this.url||n.url;o?this._connectSocket(o):i&&i.pipe(Ke(1)).subscribe(a=>{this.url=a,this._connectSocket(a)})}return this._output.subscribe(t),t.add(()=>{const{_socket:n}=this;this._output.observers.length===0&&(n&&(n.readyState===1||n.readyState===0)&&n.close(),this._resetState())}),t}unsubscribe(){const{_socket:t}=this;t&&t.readyState===1&&t.close(),this._resetState(),super.unsubscribe()}}function Ge(e,t,r,n){const i=Date.now();return["ws_close","ws_error","ws_open_success","ws_subscribe","ws_heartbeat_timeout"].includes(e)&&Ir("ws_debug",{phase:e,guid:r,start:t,content:n,end:i,duration:i-t}),{phase:e,start:t,end:i,duration:i-t,guid:r}}const Io=new ue;Io.subscribe(e=>N.next({type:"tingyun-event",data:e}));const Do=new V(1),Mo=new ue,No=new ue,at=new ue,_o=new ue,qo=new ue,Ao=F(No.pipe(qt("Opening")),at.pipe(qt("Opened")),_o.pipe(qt("Closing")),qo.pipe(qt("Closed"))),Du={WebSocketCtor:WebSocket,urlObservable:Do,openingObserver:No,openedObserver:at,closingObserver:_o,closedObserver:qo,delayObserver:Mo,tyObserver:Io},z=new Iu(Du),re=z.pipe(Tu(e=>e.pipe(Ot(2e3))));re.subscribe();Mo.subscribe(e=>N.next({type:"network-delay",data:{delay:e}}));function Mu(e){Do.next(e)}const Nu=re.pipe(h(e=>!!e.position_info),l(e=>e.position_info));Nu.pipe(H((e,t)=>{const{posSide:r="",symbol:n}=t,i=r?n+r:n;return e.set(i,t),e},new Map));var _u=20,qu=1,ct=1e6,Bi=1e6,Au=-7,Fu=21,Uu=!1,Lt="[big.js] ",yt=Lt+"Invalid ",Dr=yt+"decimal places",Lu=yt+"rounding mode",Fo=Lt+"Division by zero",K={},Ae=void 0,ju=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Uo(){function e(t){var r=this;if(!(r instanceof e))return t===Ae?Uo():new e(t);if(t instanceof e)r.s=t.s,r.e=t.e,r.c=t.c.slice();else{if(typeof t!="string"){if(e.strict===!0&&typeof t!="bigint")throw TypeError(yt+"value");t=t===0&&1/t<0?"-0":String(t)}Vu(r,t)}r.constructor=e}return e.prototype=K,e.DP=_u,e.RM=qu,e.NE=Au,e.PE=Fu,e.strict=Uu,e.roundDown=0,e.roundHalfUp=1,e.roundHalfEven=2,e.roundUp=3,e}function Vu(e,t){var r,n,i;if(!ju.test(t))throw Error(yt+"number");for(e.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),i=t.length,n=0;n<i&&t.charAt(n)=="0";)++n;if(n==i)e.c=[e.e=0];else{for(;i>0&&t.charAt(--i)=="0";);for(e.e=r-n-1,e.c=[],r=0;n<=i;)e.c[r++]=+t.charAt(n++)}return e}function bt(e,t,r,n){var i=e.c;if(r===Ae&&(r=e.constructor.RM),r!==0&&r!==1&&r!==2&&r!==3)throw Error(Lu);if(t<1)n=r===3&&(n||!!i[0])||t===0&&(r===1&&i[0]>=5||r===2&&(i[0]>5||i[0]===5&&(n||i[1]!==Ae))),i.length=1,n?(e.e=e.e-t+1,i[0]=1):i[0]=e.e=0;else if(t<i.length){if(n=r===1&&i[t]>=5||r===2&&(i[t]>5||i[t]===5&&(n||i[t+1]!==Ae||i[t-1]&1))||r===3&&(n||!!i[0]),i.length=t,n){for(;++i[--t]>9;)if(i[t]=0,t===0){++e.e,i.unshift(1);break}}for(t=i.length;!i[--t];)i.pop()}return e}function Rt(e,t,r){var n=e.e,i=e.c.join(""),o=i.length;if(t)i=i.charAt(0)+(o>1?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)i="0"+i;i="0."+i}else if(n>0)if(++n>o)for(n-=o;n--;)i+="0";else n<o&&(i=i.slice(0,n)+"."+i.slice(n));else o>1&&(i=i.charAt(0)+"."+i.slice(1));return e.s<0&&r?"-"+i:i}K.abs=function(){var e=new this.constructor(this);return e.s=1,e};K.cmp=function(e){var t,r=this,n=r.c,i=(e=new r.constructor(e)).c,o=r.s,a=e.s,s=r.e,c=e.e;if(!n[0]||!i[0])return n[0]?o:i[0]?-a:0;if(o!=a)return o;if(t=o<0,s!=c)return s>c^t?1:-1;for(a=(s=n.length)<(c=i.length)?s:c,o=-1;++o<a;)if(n[o]!=i[o])return n[o]>i[o]^t?1:-1;return s==c?0:s>c^t?1:-1};K.div=function(e){var t=this,r=t.constructor,n=t.c,i=(e=new r(e)).c,o=t.s==e.s?1:-1,a=r.DP;if(a!==~~a||a<0||a>ct)throw Error(Dr);if(!i[0])throw Error(Fo);if(!n[0])return e.s=o,e.c=[e.e=0],e;var s,c,u,d,f,b=i.slice(),y=s=i.length,m=n.length,v=n.slice(0,s),E=v.length,S=e,w=S.c=[],T=0,P=a+(S.e=t.e-e.e)+1;for(S.s=o,o=P<0?0:P,b.unshift(0);E++<s;)v.push(0);do{for(u=0;u<10;u++){if(s!=(E=v.length))d=s>E?1:-1;else for(f=-1,d=0;++f<s;)if(i[f]!=v[f]){d=i[f]>v[f]?1:-1;break}if(d<0){for(c=E==s?i:b;E;){if(v[--E]<c[E]){for(f=E;f&&!v[--f];)v[f]=9;--v[f],v[E]+=10}v[E]-=c[E]}for(;!v[0];)v.shift()}else break}w[T++]=d?u:++u,v[0]&&d?v[E]=n[y]||0:v=[n[y]]}while((y++<m||v[0]!==Ae)&&o--);return!w[0]&&T!=1&&(w.shift(),S.e--,P--),T>P&&bt(S,P,r.RM,v[0]!==Ae),S};K.eq=function(e){return this.cmp(e)===0};K.gt=function(e){return this.cmp(e)>0};K.gte=function(e){return this.cmp(e)>-1};K.lt=function(e){return this.cmp(e)<0};K.lte=function(e){return this.cmp(e)<1};K.minus=K.sub=function(e){var t,r,n,i,o=this,a=o.constructor,s=o.s,c=(e=new a(e)).s;if(s!=c)return e.s=-c,o.plus(e);var u=o.c.slice(),d=o.e,f=e.c,b=e.e;if(!u[0]||!f[0])return f[0]?e.s=-c:u[0]?e=new a(o):e.s=1,e;if(s=d-b){for((i=s<0)?(s=-s,n=u):(b=d,n=f),n.reverse(),c=s;c--;)n.push(0);n.reverse()}else for(r=((i=u.length<f.length)?u:f).length,s=c=0;c<r;c++)if(u[c]!=f[c]){i=u[c]<f[c];break}if(i&&(n=u,u=f,f=n,e.s=-e.s),(c=(r=f.length)-(t=u.length))>0)for(;c--;)u[t++]=0;for(c=t;r>s;){if(u[--r]<f[r]){for(t=r;t&&!u[--t];)u[t]=9;--u[t],u[r]+=10}u[r]-=f[r]}for(;u[--c]===0;)u.pop();for(;u[0]===0;)u.shift(),--b;return u[0]||(e.s=1,u=[b=0]),e.c=u,e.e=b,e};K.mod=function(e){var t,r=this,n=r.constructor,i=r.s,o=(e=new n(e)).s;if(!e.c[0])throw Error(Fo);return r.s=e.s=1,t=e.cmp(r)==1,r.s=i,e.s=o,t?new n(r):(i=n.DP,o=n.RM,n.DP=n.RM=0,r=r.div(e),n.DP=i,n.RM=o,this.minus(r.times(e)))};K.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e};K.plus=K.add=function(e){var t,r,n,i=this,o=i.constructor;if(e=new o(e),i.s!=e.s)return e.s=-e.s,i.minus(e);var a=i.e,s=i.c,c=e.e,u=e.c;if(!s[0]||!u[0])return u[0]||(s[0]?e=new o(i):e.s=i.s),e;if(s=s.slice(),t=a-c){for(t>0?(c=a,n=u):(t=-t,n=s),n.reverse();t--;)n.push(0);n.reverse()}for(s.length-u.length<0&&(n=u,u=s,s=n),t=u.length,r=0;t;s[t]%=10)r=(s[--t]=s[t]+u[t]+r)/10|0;for(r&&(s.unshift(r),++c),t=s.length;s[--t]===0;)s.pop();return e.c=s,e.e=c,e};K.pow=function(e){var t=this,r=new t.constructor("1"),n=r,i=e<0;if(e!==~~e||e<-Bi||e>Bi)throw Error(yt+"exponent");for(i&&(e=-e);e&1&&(n=n.times(t)),e>>=1,!!e;)t=t.times(t);return i?r.div(n):n};K.prec=function(e,t){if(e!==~~e||e<1||e>ct)throw Error(yt+"precision");return bt(new this.constructor(this),e,t)};K.round=function(e,t){if(e===Ae)e=0;else if(e!==~~e||e<-ct||e>ct)throw Error(Dr);return bt(new this.constructor(this),e+this.e+1,t)};K.sqrt=function(){var e,t,r,n=this,i=n.constructor,o=n.s,a=n.e,s=new i("0.5");if(!n.c[0])return new i(n);if(o<0)throw Error(Lt+"No square root");o=Math.sqrt(n+""),o===0||o===1/0?(t=n.c.join(""),t.length+a&1||(t+="0"),o=Math.sqrt(t),a=((a+1)/2|0)-(a<0||a&1),e=new i((o==1/0?"5e":(o=o.toExponential()).slice(0,o.indexOf("e")+1))+a)):e=new i(o+""),a=e.e+(i.DP+=4);do r=e,e=s.times(r.plus(n.div(r)));while(r.c.slice(0,a).join("")!==e.c.slice(0,a).join(""));return bt(e,(i.DP-=4)+e.e+1,i.RM)};K.times=K.mul=function(e){var t,r=this,n=r.constructor,i=r.c,o=(e=new n(e)).c,a=i.length,s=o.length,c=r.e,u=e.e;if(e.s=r.s==e.s?1:-1,!i[0]||!o[0])return e.c=[e.e=0],e;for(e.e=c+u,a<s&&(t=i,i=o,o=t,u=a,a=s,s=u),t=new Array(u=a+s);u--;)t[u]=0;for(c=s;c--;){for(s=0,u=a+c;u>c;)s=t[u]+o[c]*i[u-c-1]+s,t[u--]=s%10,s=s/10|0;t[u]=s}for(s?++e.e:t.shift(),c=t.length;!t[--c];)t.pop();return e.c=t,e};K.toExponential=function(e,t){var r=this,n=r.c[0];if(e!==Ae){if(e!==~~e||e<0||e>ct)throw Error(Dr);for(r=bt(new r.constructor(r),++e,t);r.c.length<e;)r.c.push(0)}return Rt(r,!0,!!n)};K.toFixed=function(e,t){var r=this,n=r.c[0];if(e!==Ae){if(e!==~~e||e<0||e>ct)throw Error(Dr);for(r=bt(new r.constructor(r),e+r.e+1,t),e=e+r.e+1;r.c.length<e;)r.c.push(0)}return Rt(r,!1,!!n)};K[Symbol.for("nodejs.util.inspect.custom")]=K.toJSON=K.toString=function(){var e=this,t=e.constructor;return Rt(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])};K.toNumber=function(){var e=Number(Rt(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(e.toString()))throw Error(Lt+"Imprecise conversion");return e};K.toPrecision=function(e,t){var r=this,n=r.constructor,i=r.c[0];if(e!==Ae){if(e!==~~e||e<1||e>ct)throw Error(yt+"precision");for(r=bt(new n(r),e,t);r.c.length<e;)r.c.push(0)}return Rt(r,e<=r.e||r.e<=n.NE||r.e>=n.PE,!!i)};K.valueOf=function(){var e=this,t=e.constructor;if(t.strict===!0)throw Error(Lt+"valueOf disallowed");return Rt(e,e.e<=t.NE||e.e>=t.PE,!0)};var g=Uo();const p={floor(e,t,r=0){if(isNaN(e))return"";const n=e<0?-1:1;return g(e).abs().times(g(10).pow(-r)).round(t,0).times(n).toFixed(t)},ceil(e,t,r=0){if(isNaN(e))return"";const n=e<0?-1:1;return g(e).abs().times(g(10).pow(-r)).round(t,3).times(n).toFixed(t)},roundPriceEp(e,t){return Number(g(e).div(t).round().times(t))},delimit(e){const t=String(e);let r="(\\d)(?=(\\d{3})+\\.)";return t.indexOf(".")<0&&(r="(\\d)(?=(\\d{3})+$)"),t.replace(new RegExp(r,"g"),"$1,")},pad(e){return(e<10?"0":"")+String(e)},priceToEp(e,t=4){if(isNaN(e)||e==="")return 0;const r=g(10).pow(t);return Number(g(String(e).trim()).times(r))},abbreviateNumber(e,t=2){const r=e.toString();if(g(e).lt(1e3))return this.floor(r,t);const n=[{number:1e3,unit:"K"},{number:1e6,unit:"M"},{number:1e9,unit:"B"},{number:1e12,unit:"T"},{number:1e15,unit:"P"},{number:1e18,unit:"E"}];let i;for(i=n.length-1;i>0&&!g(e).gte(n[i].number);i--);const o=n[i];if(!o)return r;const{number:a,unit:s}=o;return this.floor((Number(e)/a).toString().replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1"),t)+s},startWithNumber(e){return/^\d/.test(e)},parseInt(e){const t={K:1e3,M:1e6,B:1e9,T:1e12,P:1e15,E:1e18},r=Object.keys(t).find(n=>e.endsWith(n));return r?parseInt(e.slice(0,-1))*t[r]:parseInt(e)},trimEnd0(e){const t=e.split(".");if(t.length<1||t.length<2)return e;const r=t[0],n=t[1].replace(/0+$/,"");return n===""?r:[r,n].join(".")}};function se(e,t){return Ee(g(e).minus(t))}function W(e,t){return Ee(g(e).plus(t))}function Sr(...e){return e.length<1?"0":Ee(e.reduce((t,r)=>g(t).plus(r),g(0)))}function be(e,t){return Ee(g(e).times(t))}function Ze(e,t,r=-1,n=1){return r===-1?Ee(g(e).div(t)):Qe(g(e).div(t),r,n)}function Lo(e,...t){return t.length===0?Ee(e):Ee(t.reduce((r,n)=>r.gt(n)?g(n):r,g(e)))}function Pr(e,...t){return t.length===0?Ee(e):Ee(t.reduce((r,n)=>r.gt(n)?r:g(n),g(e)))}function Ce(e,t){return g(e).gt(t)}function st(e,t){return g(e).lte(t)}function zu(e,t){return g(e).eq(t)}function ut(e,t=!1){const r=g(10).pow(g(e).toNumber());return t?Ee(r):r}function Qe(e,t=8,r=1){return g(e).round(t,r).toFixed(t)}function Ee(e){const t=g(e).abs().toString(),r=g(e).gte(0)?"":"-";if(!/e/.test(t))return r+t;const n=Number(t.match(/\d+$/)[0]),i=t.match(/^[\d\.]+/)[0].replace(/\./,"");return/e-/.test(t)?r+i.padStart(n+i.length,"0").replace(/^0/,"0."):i.length<n?r+i.padEnd(n+1,"0"):r+i.substring(0,n+1)+"."+i.substring(n+1)}function tt(e,t="symbol"){return e.reduce((r,n)=>r.set(n[t],n),new Map)}const $e=new V(1),Mr=new V(1),Wu=new V(1),De=new V(1),Ue=new V(1),jo=new V(1),$u=new V(1),zn=new V(1),Nr=new V(1),Vo=new V(1),_r=new Oe(Gu()),rt=new Oe(!1),Wn=new Oe(6e-4),zo=new V(1),Wo=zo.pipe(l(e=>e.reduce((t,r)=>t.set("id_"+r.index_id,r),new Map))),qr=Ue.pipe(l(e=>e.map(t=>Object.assign(Object.assign({},t),{baseQtyScale:0,baseQtyFactor:1,quoteQtyScale:0,quoteQtyFactor:1})))),Hu=jo.pipe(l(e=>tt(e,"symbol")),ie(1)),vt=$e.pipe(l(e=>tt(e,"symbol")),ie(1)),le=$e.pipe(l(e=>tt(e,"currency")),ie(1)),Ar=le.pipe(h(e=>e.has("PT")),l(e=>e.get("PT")),ie(1)),He=De.pipe(l(e=>tt(e,"symbol")),ie(1)),$o=De.pipe(l(e=>tt(e,"indexSymbol")),ie(1)),Xu=De.pipe(l(e=>tt(e,"markSymbol")),ie(1)),$n=Ue.pipe(l(e=>tt(e,"symbol")),ie(1));zn.pipe(l(e=>tt(e,"currency")),ie(1));const Yu=De.pipe(l(e=>e.reduce((t,r)=>t.includes(r.settleCurrency)?t:[...t,r.settleCurrency],[]))),Ho=Yu.pipe(l(e=>[...e,"PT"]));$e.subscribe(e=>{Mr.next(e.filter(t=>!!t.inAssetsDisplay).map(t=>t.symbol)),Wu.next(e.filter(t=>!t.inAssetsDisplay).map(t=>t.symbol))});function Gu(){return{spot:0}}const Ku=le.pipe(h(e=>e.has("BTC")),l(e=>e.get("BTC")),Y(null)),Ju=G.pipe(h(e=>e.type==="assets"),l(e=>e.data)),Zu=B([Ju,Ku]).pipe(h(([e,t])=>!!e&&!!t),l(([e,t])=>tl(e,t))),el={SPOT:"spot",SPOT_STRATEGY:"spotStrategy",SPOT_MARGIN:"spotMargin",CONTRACT:"contract",CONTRACT_STRATEGY:"contractStrategy",COPY_TRADE:"copyTrade",FIAT:"fiat",WM:"investment",LAUNCH_POOL:"investment",LENDING:"lending",UTA_TRADE:"trading",UTA_FUND:"funding"},sr={spotAll:["spot","spotStrategy"],contractAll:["contract","copyTrade","contractStrategy"],tradingAll:["trading","spotStrategy"],tradingBot:["spotStrategy","contractStrategy"]};function tl(e,t){const r=nn(e.btcTotalAssets,e.usdTotalAssets,e.usdtTotalAssets,e.localCcyTotalAssets,t.valuePrecision),n=e.details.reduce((a,s)=>{const c=el[s.walletType];let{btcTotalAssets:u,usdTotalAssets:d,usdtTotalAssets:f,localCcyTotalAssets:b}=s;if(a.has(c)){const y=a.get(c);u=W(u,y.btcEv),d=W(d,y.usdEv),f=W(f,y.usdtEv),b=W(b,y.moneyEv)}return a.set(c,{btcEv:u,usdEv:d,usdtEv:f,moneyEv:b})},new Map).toObject(),i=Object.assign(Object.assign({},n),{spotAll:ar(sr.spotAll,n),contractAll:ar(sr.contractAll,n),tradingAll:ar(sr.tradingAll,n),tradingBot:ar(sr.tradingBot,n)}),o=nn(0,0,0,0,t.valuePrecision);return Object.assign(Object.assign({},r),{localCurrency:e.localCurrency,details:Object.assign({spot:o,contract:o,contractStrategy:o,copyTrade:o,fiat:o,lending:o,spotStrategy:o,spotMargin:o,trading:o,funding:o,investment:o,spotAll:o,contractAll:o,tradingAll:o,tradingBot:o},Object.keys(i).reduce((a,s)=>Object.assign(Object.assign({},a),{[s]:nn(i[s].btcEv,i[s].usdEv,i[s].usdtEv,i[s].moneyEv,t.valuePrecision)}),{}))})}function ar(e,t){return e.reduce((r,n)=>{const i=t[n];return i?{btcEv:W(r.btcEv,i.btcEv),usdEv:W(r.usdEv,i.usdEv),usdtEv:W(r.usdtEv,i.usdtEv),moneyEv:W(r.moneyEv,i.moneyEv)}:r},{btcEv:0,usdEv:0,usdtEv:0,moneyEv:0})}function nn(e,t,r,n,i){return{btcEv:e,btc:cr(e||0,i),usdEv:t,usd:cr(t||0,2),money:cr(n||0,2),usdtEv:r,usdt:cr(r||0,2)}}function cr(e,t=8){return p.delimit(p.floor(e||0,t,0))}function rl(){Zu.pipe(ge(300,Bt,{leading:!1,trailing:!0}),l(e=>({type:"assets",data:{assets:e}}))).subscribe(e=>N.next(e))}function Me(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function Fr(e,t){return e.hasOwnProperty("accounts_p1")?!![e.accounts_p1,e.positions_p1].find(r=>r&&r[0]&&r[0].userID===t):!![e.accounts,e.positions].find(r=>r&&r[0]&&r[0].userID===t)}function Xo(e){var t,r,n,i;return e.accounts_p1?((t=e.accounts_p1[0])===null||t===void 0?void 0:t.userID)||((r=e.positions_p1[0])===null||r===void 0?void 0:r.userID):((n=e.accounts[0])===null||n===void 0?void 0:n.userID)||((i=e.positions[0])===null||i===void 0?void 0:i.userID)}function Tr(e){return e.wallets.length>0?e.wallets[0].userID:e.orders.closed.length>0?e.orders.closed[0].userID:e.orders.open.length>0?e.orders.open[0].userID:e.orders.fills.length>0?e.orders.fills[0].userID:""}const Yo=G.pipe(h(e=>e.type==="token-update"),l(e=>e),ie(1));Yo.subscribe();const jt=G.pipe(h(e=>e.type==="user-logout")),Go=Ao.pipe(h(e=>e==="Opened"),Je(()=>Yo),h(e=>!!e.token),Je(({token:e,platform:t="PC"})=>z.send({method:"user.auth",params:[t,e]})),ft()),nl=Go.pipe(h(e=>e.error),Vn(e=>{N.next({type:"auth-error",error:e.error}),console.warn("user.auth error:",e.error)}),ft()),Pe=Go.pipe(h(e=>!e.error)),fe=F(nl,jt),Hn=new Oe(!1);Pe.subscribe(()=>Hn.next(!0));fe.subscribe(()=>Hn.next(!1));const Ne=new Oe(0),Ct=new Oe([]),Xn=Ct.pipe(l(e=>e.map(t=>t.userId))),Ko=Ct.pipe(l(e=>e.filter(Zo).map(t=>t.userId))),Yn=Ct.pipe(l(e=>e.filter(Jo).map(t=>t.userId))),Ur=Ct.pipe(l(e=>e.filter(t=>Zo(t)||Jo(t)).map(t=>t.userId))),il=Ct.pipe(l(e=>e.filter(ol).map(t=>t.userId)));G.pipe(h(e=>e.type==="sub-users-subscribe")).subscribe(e=>{Ne.next(e.users.main.userId),Ct.next(e.users.subs)});function Jo(e){return e.userBizType==="CT_FOLLOWER"}function Zo(e){return e.userBizType==="BOT_TRADE_ACCOUNT"&&["CONTRACT","CONTRACT_MARTINGALE","CONTRACT_SIGNAL"].includes(e.botType)}function ol(e){return e.userBizType==="BOT_TRADE_ACCOUNT"&&e.botType==="SPOT"}Pe.subscribe(()=>z.next({method:"service.subscribe",params:["service.account"]}));const es=re.pipe(h(e=>e.msgType==="account.user.common"&&e.payload&&!!e.payload[0]),l(e=>e.payload[0]));B([Pe,Ur]).pipe(h(([,e])=>e.length>0)).subscribe(([,e])=>{const t=ts(e);z.next({method:"aop_v1.subscribe",params:t}),z.next({method:"aop_p1.subscribe",params:t})});function ts(e,t=!1){return[0,t,!0,e,!0]}const rs=re.pipe(h(e=>!!e.accounts&&!!e.orders&&!!e.positions),we(Ne),h(([e,t])=>!Fr(e,t)),l(([e])=>(e.accounts=is(e.accounts),e.positions=os(e.positions,e.accounts),{userId:Xo(e),data:Object.assign({},e)}))),ns=re.pipe(h(e=>!!e.accounts_p1&&!!e.orders_p1&&!!e.positions_p1),we(Ne),h(([e,t])=>!Fr(e,t)),l(([e])=>{const{accounts_p1:t,orders_p1:r,positions_p1:n,events_p1:i}=e,o=Me(e,["accounts_p1","orders_p1","positions_p1","events_p1"]),a=is(t);return{userId:Xo(e),data:Object.assign(Object.assign({},o),{accounts:a,orders:r,positions:os(n,a),events:i})}}));function is(e){return e.forEach(t=>{t.tradeLevel=t.tradeLevel||0}),e}function os(e,t){return e.map(r=>{const n=t.find(i=>i.accountID===r.accountID);return n&&(r.tradeLevel=n.tradeLevel),r})}let vr=0;Pe.pipe(we(Ne),h(([,e])=>!!e)).subscribe(([,e])=>{vr=Date.now();const t=ts(e,!0);z.next({method:"aop_v1.subscribe",params:t}),z.next({method:"aop_p1.subscribe",params:t})});const Vt=re.pipe(h(e=>!!e.accounts&&!!e.orders&&!!e.positions),we(Ne),h(([e,t])=>!t||Fr(e,t)),l(([e])=>(e.accounts=ss(e.accounts),e.positions=as(e.positions,e.accounts),e))),Qt=re.pipe(h(e=>!!e.accounts_p1&&!!e.orders_p1&&!!e.positions_p1),we(Ne),h(([e,t])=>!t||Fr(e,t)),l(e=>{var[t]=e,{accounts_p1:r,orders_p1:n,positions_p1:i,events_p1:o}=t,a=Me(t,["accounts_p1","orders_p1","positions_p1","events_p1"]);const s=ss(r);return Object.assign(Object.assign({},a),{accounts:s,orders:n,positions:as(i,s),events:o})}));function ss(e){return e.forEach(t=>{t.tradeLevel=t.tradeLevel||0}),e}function as(e,t){return e.map(r=>{const n=t.find(i=>i.accountID===r.accountID);return n&&(r.tradeLevel=n.tradeLevel),r})}F(Vt,Qt).subscribe(sl);function sl(e){const{accounts:t,positions:r,sequence:n,timestamp:i,type:o,version:a,guid:s=""}=e,c=t.map(al),u=r.filter(y=>y.size>0).map(cl),d=(e.orders.open||[]).map(ul),f=Date.now()-vr,b=Date.now()-vr;Ir("aop_debug",{guid:s,as:c,ps:u,os:d,sequence:n,timestamp:i,type:o,version:a,subTime:vr,delayV1:f,delayP1:b})}function al(e){const{currency:t,accountID:r,accountBalanceRv:n,accountBalanceEv:i,bonusBalanceRv:o,bonusBalanceEv:a,totalUsedBalanceRv:s,totalUsedBalanceEv:c,unrealisedPnlRv:u,unrealisedPnlEv:d,tradeLevel:f}=e;return t==="USDT"?{currency:t,accountID:r,accountBalanceRv:n,bonusBalanceRv:o,totalUsedBalanceRv:s,unrealisedPnlRv:u,tradeLevel:f}:{currency:t,accountID:r,accountBalanceEv:i,bonusBalanceEv:a,totalUsedBalanceEv:c,unrealisedPnlEv:d,tradeLevel:f}}function cl(e){const t={symbol:e.symbol,size:e.size,currency:e.currency,freeQty:e.freeQty},r=!!e.leverageRr;return Object.assign(t,r?{leverageRr:e.leverageRr,unrealisedPnlRv:e.unrealisedPnlRv,liquidationPriceRp:e.liquidationPriceRp,assignedPosBalanceRv:e.assignedPosBalanceRv}:{leverageEr:e.leverageEr,unrealisedPnlEv:e.unrealisedPnlEv,liquidationPriceEp:e.liquidationPriceEp,assignedPosBalanceEv:e.assignedPosBalanceEv})}function ul(e){return{symbol:e.symbol,orderID:e.orderID,cumQty:e.cumQty,orderQty:e.orderQty,curPosSide:e.curPosSide,ordStatus:e.ordStatus,ordType:e.ordType}}const cs=Vt.pipe(h(e=>!!e.orders)),us=cs.pipe(h(e=>e.type==="snapshot")),ls=cs.pipe(h(e=>e.type==="incremental")),ps=Qt.pipe(h(e=>!!e.orders)),ds=ps.pipe(h(e=>e.type==="snapshot"),l(ys)),fs=ps.pipe(h(e=>e.type==="incremental"),l(ys)),Lr=F(us,ds),nt=F(ls,fs);nt.subscribe(e=>N.next({type:"incremental-order",data:{incremental:!0,aop:e}}));function ys(e){var{orders:t}=e,r=Me(e,["orders"]);const n=ll(t.closed),i=dl(t.open),o=pl(t.fills);return Object.assign(Object.assign({},r),{orders:{closed:n,open:i,fills:o}})}function ll(e){return e.map(t=>Object.assign(Object.assign({},t),{accountID:t.accountID,action:t.action,actionTimeNs:t.actionTimeNs,bonusChangedAmountEv:Number(t.bonusChangedAmountRv||0),clOrdID:t.clOrdID,closedPnlEv:Number(t.closedPnlRv||0),closedSize:t.closedSize,code:t.code,cumQty:t.cumQty,cumValueEv:Number(t.cumValueRv||0),curPosSide:t.curPosSide,currency:t.currency,cxlRejReason:t.cxlRejReason,displayQty:t.displayQty,execStatus:t.execStatus,leavesQty:t.leavesQty,leavesValueEv:Number(t.leavesValueRv||0),ordStatus:t.ordStatus,ordType:t.ordType,orderID:t.orderID,orderQty:Number(t.orderQty||0),pegOffsetValueEp:Number(t.pegOffsetValueRp||0),priceEp:Number(t.priceRp||0),side:t.side,stopLossEp:Number(t.stopLossRp||0),stopPxEp:Number(t.stopPxRp||0),symbol:t.symbol,takeProfitEp:Number(t.takeProfitRp||0),timeInForce:t.timeInForce,curPosTerm:t.curPosTerm,posSide:t.posSide}))}function pl(e){return e.map(t=>Object.assign(Object.assign({},t),{accountID:t.accountID,bonusChangedAmountEv:t.bonusChangedAmountRv,currency:t.currency,execFeeEv:t.execFeeRv,ptFeeEv:t.ptFeeRv,ptPriceEp:t.ptPriceRp,execID:t.execID,execPriceEp:t.execPriceRp,execQty:Number(t.execQty||0),execSeq:t.execSeq,execStatus:t.execStatus,execValueEv:t.execValueRv,ordType:t.ordType,orderID:t.orderID,orderQty:Number(t.orderQty||0),priceEp:Number(t.priceRp||0),side:t.side,symbol:t.symbol,tradeType:t.tradeType,transactTimeNs:t.transactTimeNs,userID:t.userID,curPosTerm:t.curPosTerm,posSide:t.posSide}))}function dl(e){return e.map(t=>Object.assign(Object.assign({},t),{accountID:t.accountID,action:t.action,actionTimeNs:t.actionTimeNs,bonusChangedAmountEv:Number(t.bonusChangedAmountRv||0),clOrdID:t.clOrdID,closedPnlEv:Number(t.closedPnlRv||0),closedSize:t.closedSize,code:t.code,cumQty:t.cumQty,cumValueEv:Number(t.cumValueRv||0),curPosSide:t.curPosSide,currency:t.currency,cxlRejReason:t.cxlRejReason,displayQty:t.displayQty,execStatus:t.execStatus,leavesQty:Number(t.leavesQty||0),leavesValueEv:Number(t.leavesValueRv||0),ordStatus:t.ordStatus,ordType:t.ordType,orderID:t.orderID,orderQty:Number(t.orderQty||0),pegOffsetValueEp:Number(t.pegOffsetValueRp||0),pegOffsetProportionEr:Number(t.pegOffsetProportionRr||0),priceEp:Number(t.priceRp||0),side:t.side,slTrigger:t.slTrigger,stopLossEp:Number(t.stopLossRp||0),stopPxEp:Number(t.stopPxRp||0),stopDirection:t.stopDirection,symbol:t.symbol,takeProfitEp:Number(t.takeProfitRp||0),timeInForce:t.timeInForce,tpTrigger:t.tpTrigger,trigger:t.trigger,transactTimeNs:t.transactTimeNs,userID:t.userID,curPosTerm:t.curPosTerm,posSide:t.posSide,execQty:Number(t.execQty||0),execInst:t.execInst,pegPriceType:t.pegPriceType,actionBy:t.actionBy}))}const fl={New:"orderSubmitted",PartiallyFilled:"orderFilled",Filled:"orderFilled",Canceled:"orderCanceled"},yl={Untriggered:"orderSubmitted",New:"orderTriggered",PartiallyFilled:"orderFilled",Filled:"orderFilled",Deactivated:"orderCanceled",Canceled:"orderCanceled"},bl=nt.pipe(l(({orders:{open:e,closed:t}})=>[...t,...e]));bl.pipe(l(e=>e.map(vl).filter(Boolean)));function vl(e){return["New","Replace","Cancel"].indexOf(e.action)>-1?["Market","Limit"].indexOf(e.ordType)>-1?fl[e.ordStatus]:["Stop","StopLimit","LimitIfTouched","MarketIfTouched"].indexOf(e.ordType)>-1?yl[e.ordStatus]:"":""}function bs(e){const t=e.pipe(h(i=>!!i.orders)),r=t.pipe(h(i=>i.type==="snapshot"),l(i=>i.orders)),n=t.pipe(h(i=>i.type==="incremental"),l(i=>i.orders));return{orders$:t,snapshotOrders$:r,incrementalOrders$:n}}Pe.subscribe(()=>z.next({method:"wo.subscribe",params:[]}));const Gn=re.pipe(h(e=>!!e.wallets&&!!e.orders)),{orders$:P0,snapshotOrders$:jr,incrementalOrders$:mt}=bs(Gn);mt.subscribe(e=>N.next({type:"incremental-order",data:{incremental:!0,wo:e}}));const ml={New:"orderSubmitted",PartiallyFilled:"orderFilled",Filled:"orderFilled",Canceled:"orderCanceled"},hl={Untriggered:"orderSubmitted",New:"orderTriggered",PartiallyFilled:"orderFilled",Filled:"orderFilled",Deactivated:"orderCanceled",Canceled:"orderCanceled"};mt.pipe(l(e=>{const t=[...e.open,...e.closed,...e.fills];return Object.values(t.toObject("orderID")).map(gl).filter(Boolean)}));function gl(e){return["New","Replace","Cancel"].indexOf(e.action)>-1?["Market","Limit"].indexOf(e.ordType)>-1?ml[e.ordStatus]:["Stop","StopLimit","LimitIfTouched","MarketIfTouched"].indexOf(e.ordType)>-1?hl[e.ordStatus]:"":""}const vs=new V(1),Xe=new V(1),ke=new V(1),El=G.pipe(h(e=>e.type==="state-symbol"));B([El,Ue,Nr,De]).subscribe(([e,t,r,n])=>{const{tradeType:i,symbol:o,mode:a}=e;if(i==="Spot"){const s=(a==="Margin"?r:t).find(c=>c.symbol===o);if(!s)return;Xe.next(s),ke.next(s);return}if(["Perpetual","PerpetualV2"].indexOf(i)>-1){const s=n.find(c=>c.symbol===o);if(!s)return;vs.next(s),ke.next(s)}});const Sl=G.pipe(h(e=>e.type==="order-book-depth"),l(e=>e.depth),Y(10)),Pl=new Oe(30),ms=G.pipe(h(e=>e.type==="order-book-type"),l(e=>e.percentType),Y("Stack")),Tl=G.pipe(h(e=>e.type==="book-step-size"&&["Perpetual","PerpetualV2"].indexOf(e.tradeType)>-1),l(e=>e.stepSizeEx),Y(0)),wl=G.pipe(h(e=>e.type==="book-step-size"&&e.tradeType==="Spot"),l(e=>e.stepSizeEx),Y(0)),Kn=G.pipe(h(e=>e.type==="contract-qty-type"),l(e=>e.qtyType),Y("ByCont"),ie(1)),hs=B([ke,Tl,wl]).pipe(l(xl),Ie());function xl([e,t,r]){return e.type==="Spot"?r:["Perpetual","PerpetualV2"].indexOf(e.type)>-1?t:0}const Bl=re.pipe(h(e=>!!e.book||!!e.orderbook_p),l(e=>{const{orderbook_p:t,book:r}=e,n=Me(e,["orderbook_p","book"]);return Object.assign(Object.assign({},n),{book:r||{asks:Oi(t.asks),bids:Oi(t.bids)}})}));function Oi(e){return e.map(t=>t.map(r=>Number(r)))}function Ri(e,t){return[...e.keys()].sort(t==="Bid"?Ol:Rl)}function Ol(e,t){return t-e}function Rl(e,t){return e-t}const Cl=ke.pipe(Ie(),l(Il)),gs=B([Bl,ke]).pipe(h(([e,t])=>e.symbol===t.symbol),l(e=>e[0])),Ql=gs.pipe(h(e=>e.type==="snapshot"),l(Dl)),kl=gs.pipe(h(e=>e.type==="incremental"),l(Ml)),Jn=F(Cl,Ql,kl).pipe(Y(e=>e),H((e,t)=>t(e),Nl()),l(_l));function Il(e){return function(t){const{bids:r,asks:n}=t;return r.clear(),n.clear(),{tradePair:e,bids:r,asks:n}}}function Dl(e){return function(t){const{tradePair:r,bids:n,asks:i}=t;n.clear(),i.clear();const{book:o}=e;return wr(n,o.bids),wr(i,o.asks),{tradePair:r,bids:n,asks:i}}}function Ml(e){return function(t){const{tradePair:r,bids:n,asks:i}=t,{book:o}=e;return wr(n,o.bids),wr(i,o.asks),Al(n,o.asks),Fl(i,o.bids),{tradePair:r,bids:n,asks:i}}}function Nl(){return{tradePair:null,bids:new Map,asks:new Map}}function _l({tradePair:e,bids:t,asks:r}){return{tradePair:e,bids:t,bidPriceEps:Ri(t,"Bid"),asks:r,askPriceEps:Ri(r,"Ask")}}function wr(e,t){t.forEach(r=>ql(e,r))}function ql(e,t){if(t[1]===0){e.delete(t[0]);return}e.set(t[0],t[1])}function Al(e,t){if(t.length>0){const r=Math.min(...Es(t));[...e.keys()].filter(n=>n>=r).forEach(n=>e.delete(n))}}function Fl(e,t){if(t.length>0){const r=Math.max(...Es(t));[...e.keys()].filter(n=>n<=r).forEach(n=>e.delete(n))}}function Es(e){return e.filter(t=>t[1]>0).map(t=>t[0])}const Ul=450;function xr(e,t){e.forEach(r=>r.percent=(r.total*100/t).toFixed(2))}function Ci(e,t){e.forEach(r=>r.percent=(r.total*100/t).toFixed(2))}function Br(e,t,r,n,i){e.forEach((o,a)=>{const{size:s}=o,c=r.get(a),u=n.get(a)||0,d=i.get(a),f=Ll(d,s-c,Ul>t-u);r.set(a,s),f!==d&&(i.set(a,f),n.set(a,t)),o.ss=f})}function Ll(e,t,r){if(e===void 0)return 0;if(t===0||r&&(t>0&&(e===1||e===2)||t<0&&(e===3||e===4)))return e;if(e===0){if(t>0)return 1;if(t<0)return 3}if(e===1){if(t>0)return 2;if(t<0)return 3}if(e===2){if(t>0)return 1;if(t<0)return 3}if(e===3){if(t>0)return 1;if(t<0)return 4}if(e===4){if(t>0)return 1;if(t<0)return 3}return e}function jl(e,t,r,n,i,o,a){const{symbol:s,pricePrecision:c,quoteQtyScale:u,baseQtyPrecision:d,baseQtyScale:f,quoteQtyPrecision:b}=e,y=r.map((O,k)=>Qi(O,t.get(O),k,"bid",c,u,d,f)),m=i.map((O,k)=>Qi(O,n.get(O),k,"ask",c,u,d,f)),v=Date.now(),{bidSizeCache:E,askSizeCache:S,bidTimeCache:w,askTimeCache:T,bidStatusCache:P,askStatusCache:x}=o;return Br(y,v,E,w,P),Br(m,v,S,T,x),a==="Stack"&&Vl(y,m,d,f),a==="Each"&&zl(y,m,u,f,b),{reset:!1,symbol:s,bids:y,asks:m,bid1Ep:y.length>0?y[0].priceEp:0,ask1Ep:m.length>0?m[0].priceEp:0}}function Qi(e,t,r,n,i,o,a,s){return{priceEp:e,price:p.floor(e,i,o),size:t,sizeStr:p.abbreviateNumber(p.floor(t,a,s),a),total:0,totalStr:"0",percent:"0",[n]:!0,odd:r%2!==0,ss:0,rowSize:t}}function ki(e,t,r,n){const i=e+t.size;return t.total=i,t.totalStr=p.abbreviateNumber(p.floor(i,r,n),r),i}function Vl(e,t,r,n){const i=e.reduce((s,c)=>ki(s,c,r,n),0),o=t.reduce((s,c)=>ki(s,c,r,n),0),a=Math.max(i,o);xr(e,a),xr(t,a)}function Ii(e,t,r,n,i){const o=t.priceEp*t.size;t.total=o;const a=p.floor(o,i,r+n);return t.totalStr=p.delimit(a),Math.max(e,o)}function zl(e,t,r,n,i){const o=e.reduce((c,u)=>Ii(c,u,r,n,i),0),a=t.reduce((c,u)=>Ii(c,u,r,n,i),0),s=Math.max(o,a);Ci(e,s),Ci(t,s)}var te;(function(e){e.Cont="ByCont",e.Base="ByValue",e.Coin="ByCoin"})(te||(te={}));function Wl(e,t,r,n,i,o,a){const{symbol:s,contractSide:c,contractSize:u,valuePrecision:d,contractSizePrecision:f}=e,b=r.map((x,O)=>Di(x,t.get(x),O,"bid",a,e)),y=i.map((x,O)=>Di(x,n.get(x),O,"ask",a,e)),m=Date.now(),{bidSizeCache:v,askSizeCache:E,bidTimeCache:S,askTimeCache:w,bidStatusCache:T,askStatusCache:P}=o;return Br(b,m,v,S,T),Br(y,m,E,w,P),$l(b,y,a,c,u,d,f),{reset:!1,symbol:s,bids:b,asks:y,bid1Ep:b.length>0?b[0].priceEp:0,ask1Ep:y.length>0?y[0].priceEp:0}}function Di(e,t,r,n,i,o){const{pricePrecision:a,priceScale:s,contractSide:c,contractSize:u,valuePrecision:d,contractSizePrecision:f,qtyPrecision:b,priceFactor:y}=o,m=Xl(t,e,i,c,u,y),v=Hl(m,i,d,f,b);return{priceEp:e,price:p.floor(e,a,s),size:m,sizeStr:v,total:0,totalStr:"0",percent:"0",[n]:!0,odd:r%2!==0,ss:0,rowSize:t}}function $l(e,t,r,n,i,o,a){const s=e.reduce((d,f)=>Mi(d,f,r,n,i,o,a),0),c=t.reduce((d,f)=>Mi(d,f,r,n,i,o,a),0),u=Math.max(s,c);xr(e,u),xr(t,u)}function Mi(e,t,r,n,i,o,a){const s=Number(g(t.size).plus(e));let c=2;return r===te.Cont&&(c=s>1e3?2:0),r===te.Base&&(c=o),r===te.Coin&&(c=s>1e3?2:a),t.total=s,t.totalStr=p.abbreviateNumber(s,c),s}function Hl(e,t,r,n,i){if(t===te.Cont){const o=e>1e3?2:i;return p.abbreviateNumber(e,o)}if(t===te.Base)return p.abbreviateNumber(e,r);if(t===te.Coin){const o=e>1e3?2:n;return p.abbreviateNumber(e,o)}return"0"}function Xl(e,t,r,n,i,o){return r===te.Cont?e:r===te.Base?Yl(e,n,i,t,o):r===te.Coin?Number(g(e).times(i)):0}function Yl(e,t,r,n,i=0){const o=g(e).times(r);return Number(t>0?o.times(n).div(i):o.times(i).div(n))}const Ss=ke.pipe(l(({symbol:e})=>({reset:!0,symbol:e,bids:[],asks:[],bid1Ep:0,ask1Ep:0}))),Ps=ke.pipe(l(({symbol:e})=>({symbol:e,bidSizeCache:new Map,askSizeCache:new Map,bidTimeCache:new Map,askTimeCache:new Map,bidStatusCache:new Map,askStatusCache:new Map}))),Gl=B([Jn,Sl,hs]).pipe(l(Ts),h(Boolean)),Kl=B([Gl,Ps,ms,Kn]).pipe(h(([e,t])=>e.tradePair.symbol===t.symbol),l(ws));F(Ss,Kl);const Jl=B([Jn,Pl,hs]).pipe(l(Ts),h(Boolean)),Zl=B([Jl,Ps,ms,Kn]).pipe(h(([e,t])=>e.tradePair.symbol===t.symbol),l(ws));F(Ss,Zl);function Ts([e,t,r]){const{tradePair:n}=e;if(n===null)return null;const i=r===0?tp(n):r,[o,a]=Ni(e.bids,e.bidPriceEps,t,i,"Bid"),[s,c]=Ni(e.asks,e.askPriceEps,t,i,"Ask");return{tradePair:n,bidCache:o,bidPriceEps:a,askCache:s,askPriceEps:c}}function ws([{tradePair:e,bidCache:t,bidPriceEps:r,askCache:n,askPriceEps:i},o,a,s]){return e.type==="Spot"?jl(e,t,r,n,i,o,a):["Perpetual","PerpetualV2"].indexOf(e.type)>-1?Wl(e,t,r,n,i,o,s):null}function Ni(e,t,r,n,i){const o=new Map;for(let a=0,s=t.length;a<s;a++){const c=t[a],u=ep(c,n,i);if(o.size===r&&!o.has(u))break;const d=(o.get(u)||0)+e.get(c);o.set(u,d)}return[o,[...o.keys()]]}function ep(e,t,r){const n=g(e).mod(t),i=g(e).minus(n);return Number(n.eq(0)?e:r==="Bid"?i:i.plus(t))}function tp(e){return e&&["Perpetual","PerpetualV2"].indexOf(e.type)>-1?e.tickSizeEp:e&&e.type==="Spot"?e.quoteTickSizeEv:0}const _={toValueUnit(e){return Et(e)||e.contractSide>0?e.settleCurrency:e.contractUnderlyingAssets},toValueQuantity(e,t,r){return Et(e)?sn(r)?"-":p.floor(g(t).mul(r),4):e.contractSide>0?sn(r)?"-":p.floor(g(t).mul(e.contractSize).mul(r),2):p.floor(g(t).mul(e.contractSize),2)},toValue(e,t,r){return on(_.toValueQuantity(e,t,r),_.toValueUnit(e))},toCoinUnit(e){return Et(e)||e.contractSide>0?e.contractUnderlyingAssets:e.settleCurrency},toCoinQuantity(e,t,r){return!t||!e?"-":Et(e)?p.floor(t,e.qtyPrecision):e.contractSide>0?p.floor(g(t).mul(e.contractSize),4):sn(r)||Number(r)===0?"-":p.floor(g(t).mul(e.contractSize).div(r),8)},toCoin(e,t,r){return on(_.toCoinQuantity(e,t,r),_.toCoinUnit(e))},toContUnit(e){return Et(e)?"":"Cont"},toContQuantity(e,t){return Et(e)?"-":t},toCont(e,t){return on(_.toContQuantity(e,t),_.toContUnit(e))},getUnit(e,t){return{[te.Cont]:()=>_.toContUnit(e),[te.Base]:()=>_.toValueUnit(e),[te.Coin]:()=>_.toCoinUnit(e)}[t]()}};function xs(e,t){return{MarketIfTouched:e.stopPxEp,Stop:e.stopPxEp}[t]||e.priceEp}function Et(e){return e.type==="PerpetualV2"}function on(e,t){return e=e===void 0?"-":e,t?`${e} ${t}`:`${e}`}function sn(e){return isNaN(e)||e===""}const wn={unit:"X",precision:2},Or={marginRateErToLeverageEr(e,t=8,r=8){const n=g(10).pow(t+r).div(e).toNumber();return Number(g(n).round(2,g.roundUp).toFixed(2))},marginRateErToLeverage(e,t=8,r=8){return this.leverageErToLeverage(this.marginRateErToLeverageEr(e,t,r),r)},leverageErToLeverage(e,t=8,{removeEnd0:r=!1,unit:n=wn.unit}={}){const i=p.ceil(e,wn.precision,t);return(r?p.trimEnd0(i):i)+n},createMaxLeverage$(e,t){const r=_i(e);return B([r,t]).pipe(l(([n,i])=>qi(n,i.ratioScale)),h(Boolean),Y({leverageEr:1e8,leverageX:"1X"}),ie(1))},createMaxLeverage(e,t){return!e||!t?{leverageEr:1e8,leverageX:"1X"}:qi(e.initialMarginEr,t.ratioScale)},createLeverageOptions$(e,t){const r=_i(t);return B([r,e]).pipe(l(([n,i])=>Ai(n,i)),h(Boolean),Y([]),Ie(),ie(1))},createLeverageOptions(e,t){return!e||!t?[]:Ai(t.initialMarginEr,e)},getMaxLeverageByLeverageOptions(e){const t=e.reduce((r,n)=>g(r.leverageEr).gt(n.leverageEr)?r:n,{leverageEr:0});return Object.assign(Object.assign({},t),{leverageX:`${t.leverage}X`})},getMaxLeverageByLeverages(e,t){return this.getMaxLeverageByLeverageOptions(this.createLeverageOptions(e,t))},convertSlideOptions(e){return e.sort((t,r)=>t.leverageEr-r.leverageEr).map(t=>({value:t.leverageEr,label:`${t.leverage}X`}))},ceilLeverageEr(e,t,r){return g(p.ceil(e,t,r)).times(g(10).pow(r)).toNumber()}};function _i(e){return e.pipe(h(Boolean),l(t=>t.initialMarginEr))}function qi(e,t){const r=Or.marginRateErToLeverageEr(e,t,t);return{leverageEr:r,leverageX:Or.leverageErToLeverage(r,t)}}function Ai(e,t){const r=t.find(n=>n.initialMarginEr===e);return r?r.options:null}function an(){return{maintenanceAmountRv:0,maintenanceMargin:0,maintenanceMarginRateRr:0}}function rp(e,t,r){if(!e)return an();const{leverageMargin:n}=e;if(!r.has("id_"+n)||!t)return an();const{size:i,markPriceEp:o}=t,a=g(i).times(o).toNumber(),s=np(t,n,r).sort((f,b)=>f.notionalValueRv-b.notionalValueRv).find(({notionalValueRv:f})=>f>=a);if(!s)return an();const{maintenanceMarginRateRr:c,maintenanceAmountRv:u}=s,d=Number(g(a).times(c).minus(u));return{maintenanceAmountRv:u,maintenanceMargin:d,maintenanceMarginRateRr:Number(c)}}function np(e={size:0,riskLimitIndexId:0},t,r){var n,i,o;const{size:a,riskLimitIndexId:s}=e;if(a==0)return((n=r.get(t))===null||n===void 0?void 0:n.items)||[];if(s==0){const c=r.get(t)||{index_id:0},u=Number(c.index_id)-1e3;return((i=r.get("id_"+u)||r.get(t))===null||i===void 0?void 0:i.items)||[]}else return(o=r.get("id_"+s)||r.get(t))===null||o===void 0?void 0:o.items}const Be=4,ip=1e4,Tt=2;function op({side:e,contractSide:t,contractSize:r,qty:n,entryPriceEp:i,exitPriceEp:o,factor:a,priceFactor:s}){if(n===0||i===0||o===0)return 0;const c=Fi(t,r,s,a,n,i),u=Fi(t,r,s,a,n,o);return e==="Buy"?(u-c)*t:e==="Sell"?(c-u)*t:0}function Fi(e,t,r,n,i,o){return Number(Bs(e,t,r,i,o).times(n))}function sp(e,t,r,n,i,o){return Bs(e,t,r,i,o).round(n,0).toFixed(n)}function Bs(e,t,r,n,i){if(isNaN(n)||n===0||isNaN(i)||i===0)return g(0);const o=g(n).times(t);return e>0?o.times(i).div(r):e<0?o.times(r).div(i):g(0)}const ye=new V(1);G.pipe(h(e=>e.type==="update-fiat"),Pu("currency"),Y("USD"),Ie()).subscribe(e=>ye.next(e));const Os=re.pipe(h(e=>!!e.tick)),Rs=re.pipe(h(e=>e.method==="perp_market24h_pack.update"),l(e=>e.data.map(Cs))),ap=re.pipe(h(e=>e.method==="perp_market24h_pack_p.update"),l(e=>e.data.map(Cs)));function Cs(e){return{symbol:e[0],open:Number(e[1]),high:Number(e[2]),low:Number(e[3]),close:Number(e[4]),volume:Number(e[5]),turnover:Number(e[6]),openInterest:Number(e[7]),indexPrice:Number(e[8]),markPrice:Number(e[9]),fundingRate:Number(e[10]),predFundingRate:Number(e[11])}}const Qs=re.pipe(h(e=>e.method==="spot_market24h_pack.update"),l(e=>e.data.map(cp)));function cp(e){return{symbol:e[0],openEp:e[1],highEp:e[2],lowEp:e[3],lastEp:e[4],volumeEv:e[5],turnoverEv:e[6],bidEp:e[7],askEp:e[8],indexEp:e[9]}}const up=B([Rs,He]).pipe(l(dp),h(e=>e.length>0)),lp=B([Qs,$n]).pipe(l(yp),h(e=>e.length>0)),pp=B([Os,$o]).pipe(l(([e,t])=>[vp(e,t)])),ne=F(pp,up,lp).pipe(Y([{symbol:".USD",priceEp:ip,price:"1"}]),H((e,t)=>(t.forEach(({symbol:r,priceEp:n,price:i})=>e.set(r,{priceEp:n,price:i,priceFactor:1e4,priceScale:4})),e),new Map),ge(1e3),ie(1));function dp([e,t]){return e.map(r=>fp(r,t)).filter(Boolean)}function fp(e,t){const r=t.get(e.symbol);if(!r)return null;const n=g(e.indexPrice).times(g(10).pow(Be-r.priceScale)).toNumber();return{symbol:r.indexSymbol,priceEp:n,price:p.floor(e.indexPrice,r.pricePrecision,r.priceScale)}}function yp([e,t]){return e.map(r=>bp(r,t)).filter(Boolean)}function bp(e,t){const r=t.get(e.symbol);if(!r||!["USDT","MUSDT"].includes(r.quoteCurrency))return null;const n=g(e.indexEp).times(g(10).pow(Be-r.quoteQtyScale)).toNumber();return{symbol:r.indexSymbol,priceEp:n,price:p.floor(e.indexEp,r.pricePrecision,r.quoteQtyScale)}}function vp({tick:e},t){const{symbol:r,last:n,scale:i}=e,o=n*Math.pow(10,Be-i),a=t.get(r),s=mp(a);return{symbol:r,priceEp:o,price:p.floor(o,s,Be)}}function mp(e){return e?e.pricePrecision:2}Pe.pipe(xu(rt),h(Boolean)).subscribe(()=>{z.next({method:"ras.subscribe",params:{}})});const hp=re.pipe(h(e=>!!e.risk_units)),ks=Vt.pipe(h(e=>!!e.positions),l(({positions:e})=>e.map(t=>Object.assign(Object.assign({},Bp(t)),t)))),Is=Qt.pipe(h(e=>!!e.positions),l(({positions:e})=>ei(e))),gp=B([vs,Hu,Wo,Wn]).pipe(l(([e,t,r,n])=>Tp(e,t,r,n))),Ep=fe.pipe(l(()=>function(e){return e.clear(),e})),Sp=ks.pipe(l(e=>function(t){return e.forEach(r=>{t.set(r.symbol,Object.assign(Object.assign(Object.assign({type:"Perpetual"},t.get(r.symbol)),r),Vr(r,t.get(r.symbol))))}),t})),Pp=Is.pipe(l(e=>function(t){return e.forEach(r=>{const{symbol:n,posSide:i,posMode:o}=r,a=n+i;["Merged","Long","Short"].forEach(s=>{const c=n+s;t.has(c)&&t.set(c,Object.assign(Object.assign({},t.get(c)),{posMode:o}))}),t.set(a,Object.assign(Object.assign(Object.assign({type:"PerpetualV2"},t.get(a)),r),Vr(r,t.get(a))))}),t})),Zn=F(gp,Ep,Sp,Pp).pipe(H((e,t)=>t(e),new Map));function Tp(e,t,r,n){return function(i){const{type:o,symbol:a,settleCurrency:s,ratioFactor:c,defaultLeverage:u="-10",leverageMargin:d}=e,{riskLimitEv:f,initialMarginEr:b}=wp(o,a,d,t,r);return(o==="Perpetual"?["Merged"]:["Merged","Long","Short"]).map(y=>xp(o,y,a,f,s,u,b,c,n)).reduce((y,m)=>{const{type:v,symbol:E,posSide:S}=m,w=v==="Perpetual"?E:E+S;return y.has(w)?y:y.set(w,m)},i)}}function wp(e,t,r,n,i){if(e==="Perpetual"){const o=n.get(t).riskLimits;if(o.length>0){const{riskLimitEv:a,initialMarginEr:s}=o[0];return{riskLimitEv:a,initialMarginEr:s}}}else{const o=i.get("id_"+r).items;if(o.length>0){const{notionalValueRv:a,maxLeverage:s}=o[0];return{riskLimitEv:a||0,initialMarginEr:g(1).div(s).round(2,0).toNumber()}}}return{riskLimitEv:0,initialMarginEr:0}}function xp(e,t,r,n,i,o,a,s,c){const u=Math.abs(Number(o)),d=g(1).div(u),f=Number(d.plus(g(c).times(g(2).minus(d))).times(s)),b=Number(d.plus(g(c).times(g(2).plus(d))).times(s)),y=Number(g(u).times(s));return{accountID:0,assignedPosBalanceEv:0,avgEntryPriceEp:0,bankruptCommEv:0,bankruptPriceEp:0,buyLeavesQty:0,buyLeavesValueEv:0,buyValueToCostEr:f,createdAtNs:0,crossSharedBalanceEv:0,cumClosedPnlEv:0,cumFundingFeeEv:0,cumTransactFeeEv:0,curTermRealisedPnlEv:0,curTermDiscountFeeEv:0,currency:i,dataVer:3,deleveragePercentileEr:0,displayLeverageEr:y,estimatedOrdLossEv:0,execSeq:0,freeCostEv:0,freeQty:0,initMarginReqEr:a,lastFundingTime:0,lastTermEndTime:0,leverageEr:y,isCross:!0,isIsolated:!1,liquidationPriceEp:0,maintMarginReqEr:0,makerFeeRateEr:0,markPriceEp:0,orderCostEv:0,posCostEv:0,positionMarginEv:0,positionStatus:"Normal",riskLimitEv:n,sellLeavesQty:0,sellLeavesValueEv:0,sellValueToCostEr:b,side:"None",size:0,symbol:r,takerFeeRateEr:0,term:1,transactTimeNs:0,unrealisedPnlEv:0,updatedAtNs:0,usedBalanceEv:0,userID:0,valueEv:0,posMode:e==="PerpetualV2"?"Hedged":"OneWay",posSide:t,type:e}}function Vr(e,t){const r=e.leverageEr===void 0?t==null?void 0:t.leverageEr:e.leverageEr;return{leverageEr:Math.abs(r),isIsolated:r>0,isCross:r<=0}}function ei(e){return e.map(t=>Object.assign(Object.assign({},t),{accountID:t.accountID,assignedPosBalanceEv:Number(t.assignedPosBalanceRv)||0,avgEntryPriceEp:Number(t.avgEntryPriceRp)||0,bankruptCommEv:Number(t.bankruptCommRv)||0,bankruptPriceEp:Number(t.bankruptPriceRp)||0,buyLeavesQty:Number(t.buyLeavesQty)||0,buyLeavesValueEv:Number(t.buyLeavesValueRv)||0,buyValueToCostEr:Number(t.buyValueToCostRr)||0,createdAtNs:Number(t.createdAtNs)||0,crossSharedBalanceEv:Number(t.crossSharedBalanceRv)||0,cumClosedPnlEv:Number(t.cumClosedPnlRv)||0,cumFundingFeeEv:Number(t.cumFundingFeeRv)||0,cumTransactFeeEv:Number(t.cumTransactFeeRv)||0,curTermRealisedPnlEv:Number(t.curTermRealisedPnlRv)||0,cumPtFeeEv:Number(t.cumPtFeeRv)||0,curTermDiscountFeeEv:Number(t.curTermDiscountFeeRv)||0,curTermPtFeeEv:Number(t.curTermPtFeeRv)||0,currency:t.currency,dataVer:t.dataVer||0,deleveragePercentileEr:Number(t.deleveragePercentileRr)||0,displayLeverageEr:Number(t.displayLeverageRr)||0,estimatedOrdLossEv:Number(t.estimatedOrdLossRv)||0,execSeq:Number(t.execSeq)||0,freeCostEv:Number(t.freeCostRv)||0,freeQty:Number(t.freeQty)||0,initMarginReqEr:Number(t.initMarginReqRr)||0,lastFundingTime:Number(t.lastFundingTime)||0,lastTermEndTime:Number(t.lastTermEndTime)||0,leverageEr:Number(t.leverageRr)||0,liquidationPriceEp:Number(t.liquidationPriceRp)||0,maintMarginReqEr:Number(t.maintMarginReqRr)||0,makerFeeRateEr:Number(t.makerFeeRateRr)||0,markPriceEp:Number(t.markPriceRp)||0,orderCostEv:Number(t.orderCostRv)||0,posCostEv:Number(t.posCostRv)||0,positionMarginEv:Number(t.positionMarginRv)||0,positionStatus:t.positionStatus,riskLimitEv:Number(t.riskLimitRv)||0,sellLeavesQty:Number(t.sellLeavesQty)||0,sellLeavesValueEv:Number(t.sellLeavesValueRv)||0,sellValueToCostEr:Number(t.sellValueToCostRr)||0,side:t.side,size:Number(t.size),symbol:t.symbol,takerFeeRateEr:Number(t.takerFeeRateRr)||0,term:Number(t.term)||0,transactTimeNs:Number(t.transactTimeNs)||0,unrealisedPnlEv:Number(t.unrealisedPnlRv)||0,updatedAtNs:Number(t.updatedAtNs)||0,usedBalanceEv:Number(t.usedBalanceRv)||0,userID:Number(t.userID)||0,valueEv:Number(t.valueRv)||0,minPosCostRv:Number(t.minPosCostRv)||0,posMode:t.posMode,posSide:t.posSide}))}function Bp({accountID:e,currency:t,symbol:r,side:n}){return{side:n,symbol:r,currency:t,accountID:e,assignedPosBalanceEv:0,avgEntryPriceEp:0,bankruptCommEv:0,bankruptPriceEp:0,buyLeavesQty:0,buyLeavesValueEv:0,buyValueToCostEr:0,createdAtNs:0,crossSharedBalanceEv:0,cumClosedPnlEv:0,cumFundingFeeEv:0,cumTransactFeeEv:1,curTermRealisedPnlEv:-1,dataVer:0,deleveragePercentileEr:0,displayLeverageEr:0,estimatedOrdLossEv:0,execSeq:0,freeCostEv:0,freeQty:0,initMarginReqEr:0,lastFundingTime:0,lastTermEndTime:0,leverageEr:0,liquidationPriceEp:0,maintMarginReqEr:0,makerFeeRateEr:0,markPriceEp:0,orderCostEv:0,posCostEv:0,positionMarginEv:0,positionStatus:"Normal",riskLimitEv:0,sellLeavesQty:0,sellLeavesValueEv:0,sellValueToCostEr:0,size:0,takerFeeRateEr:0,term:0,transactTimeNs:0,unrealisedPnlEv:0,updatedAtNs:0,usedBalanceEv:0,userID:0,valueEv:0,marginRatioRr:"0",marginRatio:"--"}}const Op=F(Rs,ap).pipe(H((e,t)=>(t.forEach(r=>e.set(r.symbol,r)),e),new Map),we(ke),l(([e,t])=>{const r=e.has(t.symbol)?e:e.set(t.symbol,Mp(t));return Array.from(r.values())})),Rp=B([He,Op]).pipe(l(Cp),h(e=>e.length>0),ie(1));function Cp([e,t]){return t.map(r=>Qp(e,r)).filter(Boolean)}function Qp(e,t){const{symbol:r}=t,n=e.get(r);if(!n)return null;const{close:i,high:o,low:a,open:s,indexPrice:c,markPrice:u,volume:d,turnover:f,openInterest:b=0,fundingRate:y,predFundingRate:m}=t,{type:v,displaySymbol:E,pairName:S,baseCurrency:w,pricePrecision:T,priceScale:P,valuePrecision:x,valueScale:O,contractSize:k,status:R,contractSide:I,valueFactor:Q,settleCurrency:D,ratioScale:C}=n,M=p.floor(f,I>0?x:0,O),A=p.delimit(M),q=i-s,U=p.floor(q,T,P),j=Ip(i,s),$=I<0?d:f/Q;if(!["Listed","Suspend"].includes(R))return Np(n);const X=Number(p.floor(g(M).times(c),T,P));return{type:v,symbol:r,status:R,pairName:S,baseCurrency:w,symbolV2:S,displaySymbol:E,closeEp:i,openEp:s,indexPriceEp:c,indexPrice:p.floor(c,T,P),markPriceEp:u,markPrice:p.floor(u,T,P),close:p.floor(i,T,P),highEp:o,high:p.floor(o,T,P),lowEp:a,low:p.floor(a,T,P),open:p.floor(s,T,P),turnover:M,turnoverEv:f,turnoverStr:p.abbreviateNumber(M),turnoverWithUSDRaw:X,turnoverWithUSD:p.abbreviateNumber(p.floor(g(M).times(c),T,P)),turnoverWU:A+" "+D,openInterest:b,openInterestStr:p.delimit(b),volume:d,volume24hStr:p.abbreviateNumber(Math.floor(d*k)),volume24hWithUSD:p.abbreviateNumber(p.floor(g(d).times(k).times(c),T,P)),fundingRate:y,fundingRateStr:p.floor(y,4,C-2),predFundingRate:m,predFundingRateStr:p.floor(m,4,C-2),change24hEp:q,change24hStr:kp(q,U),changePercent:j,changePercentStr:Dp(j),combinationTurnoverEv:$,contractSide:I,klineData:[],isCheapCopyToken:X<1e7}}function kp(e,t){return(e>0?"+":"")+t}function Ip(e,t){return e===0||t===0||e===t?0:(e-t)*100/t}function Dp(e){if(e===0)return"--%";const t=e>0?"+":"",r=p.floor(e,2);return t+r+"%"}function Mp(e){return{close:0,fundingRate:0,high:0,indexPrice:0,low:0,markPrice:0,open:0,openInterest:0,predFundingRate:0,symbol:e.symbol,turnover:0,volume:0}}function Np({type:e,symbol:t,status:r,pairName:n,baseCurrency:i,displaySymbol:o,contractSide:a}){return{type:e,symbol:t,status:r,symbolV2:n,pairName:n,baseCurrency:i,displaySymbol:o,closeEp:0,openEp:0,indexPriceEp:0,indexPrice:"--",markPriceEp:0,markPrice:"--",close:"--",highEp:0,high:"--",lowEp:0,low:"--",open:"--",turnoverEv:0,turnoverStr:"--",turnoverWithUSDRaw:0,turnoverWithUSD:"--",turnoverWU:"--",openInterest:0,openInterestStr:"--",volume:0,volume24hStr:"--",volume24hWithUSD:"--",fundingRate:0,fundingRateStr:"--",predFundingRate:0,predFundingRateStr:"--",change24hEp:0,change24hStr:"--",changePercent:0,changePercentStr:"--%",combinationTurnoverEv:0,contractSide:a,klineData:[],turnover:"--",isCheapCopyToken:!1}}const _p=Rp.pipe(l(Ap)),qp=Os.pipe(we(Xu,$o),l(Fp)),kt=F(_p,qp).pipe(h(Boolean),H((e,t)=>t(e),{changed:!0,cache:new Map}),h(e=>e.changed),l(e=>e.cache),ge(1e3),ie(1));function Ap(e){return function(t){return t.changed=!0,e.forEach(r=>t.cache.set(r.symbol,r)),t}}function Fp([e,t,r]){const{type:n,contract:i}=Up(t,r,e.tick.symbol);return n==="None"?null:function(o){o.changed=!1;const{cache:a}=o,{symbol:s}=i;if(a.has(s)){const c=a.get(s),{last:u,scale:d}=e.tick,f=u*Math.pow(10,4-d),{pricePrecision:b,priceScale:y}=i,m=p.floor(f,b,y);if(n==="MarkPrice"&&c.markPriceEp!==f){o.changed=!0;const v=Object.assign(Object.assign({},c),{markPriceEp:f,markPrice:m});a.set(s,v)}if(n==="IndexPrice"&&c.indexPriceEp!==f){o.changed=!0;const v=Object.assign(Object.assign({},c),{indexPriceEp:f,indexPrice:m});a.set(s,v)}}return o}}function Up(e,t,r){const n=e.get(r);if(n)return{type:"MarkPrice",contract:n};const i=t.get(r);return i?{type:"IndexPrice",contract:i}:{type:"None",contract:null}}const Lp=B([Zn,kt,Wn]).pipe(ge(500),l(jp),Y(g(0)));function jp([e,t,r]){const n=e.toArray().filter(({currency:i,isCross:o})=>["USDT","MUSDT"].includes(i)&&o);return Array.from(new Set(n.map(({symbol:i})=>i))).map(i=>{const o=n.filter(u=>u.symbol===i),a=o.every(({posMode:u})=>u==="OneWay"),s=t.get(i),c=s?s.markPriceEp:0;if(a){const u=o.find(({posMode:E,posSide:S})=>E==="OneWay"&&S==="Merged");if(!u)return g(0);const{side:d,size:f,buyValueToCostEr:b,sellValueToCostEr:y}=u,m=f&&c?g(f).times(c):g(0),v=d==="Buy"?b:y;return m.times(g(v).minus(r))}else{const u=o.find(({posMode:P,posSide:x})=>P==="Hedged"&&x==="Long"),d=o.find(({posMode:P,posSide:x})=>P==="Hedged"&&x==="Short"),f=(u==null?void 0:u.size)||0,b=(d==null?void 0:d.size)||0,y=f>b?u:d;if(!y)return g(0);const m=g(f).minus(b).abs(),v=m.gt(0)?g(m).times(c):g(0),{side:E,buyValueToCostEr:S,sellValueToCostEr:w}=y,T=E==="Buy"?S:w;return v.times(g(T).minus(r))}}).reduce((i,o)=>g(i).plus(o),g(0))}const Ds=B([hp.pipe(h(e=>!!e.risk_units)),Ne]).pipe(h(([e,t])=>{var r;return((r=e==null?void 0:e.risk_units[0])===null||r===void 0?void 0:r.userID)===t}),l(([e])=>e.risk_units)),Vp=Ds.pipe(l(e=>Wp(e)),l(e=>e.reduce((t,r)=>t.set(r.symbol+r.posSide,r),new Map)),Y(new Map),ie(1)),zp=B([Ds,Lp]).pipe(l(([e,t])=>Ms(e,t)),Y({totalBalanceRv:0,totalUsedBalanceRv:0,isolatedTotalBalanceRv:0,totalBonusRv:0,uid:0}));function Ms(e,t){const r=e.reduce((a,{totalBalanceRv:s="0"})=>Number(g(a).plus(s)),0),n=e.filter(({symbol:a})=>a).reduce((a,{totalBalanceRv:s="0"})=>Number(g(a).plus(s)),0),i=e.filter(({symbol:a})=>!a).reduce((a,{symbol:s,totalPosCostRv:c="0",totalDebtCostRv:u="0",totalOrdUsedBalanceRv:d="0",totalOrdOpenLossRv:f="0",fixedUsedRv:b="0"})=>{const y=g(!s&&t?t:c).plus(b).plus(d).plus(u).plus(f);return Number(g(a).plus(y))},0),o=e.reduce((a,{totalBonusRv:s="0"})=>Number(g(a).plus(s)),0);return{totalBalanceRv:r,totalUsedBalanceRv:i,totalBonusRv:o,isolatedTotalBalanceRv:n,uid:e&&e[0]&&e[0].userID}}function Wp(e){const t={0:"Invalid",1:"Long",2:"Short",3:"Merged"};return e.map(r=>{var{posSide:n}=r,i=Me(r,["posSide"]);const{totalBalanceRv:o=0,totalPosCostRv:a=0,totalDebtCostRv:s=0,totalOrdUsedBalanceRv:c=0,totalOrdOpenLossRv:u=0}=i,d=g(a).plus(s).plus(c).plus(u).toNumber();return Object.assign(Object.assign({},i),{posSide:t[n],accountBalanceRv:o,totalUsedBalanceRv:d})})}const $p=Vt.pipe(h(e=>!!e.accounts),l(e=>e.accounts)),Hp=Qt.pipe(h(e=>!!e.accounts),l(e=>e.accounts)),Xp=B([Hp,rt,zp]).pipe(l(Ns));function Ns([e,t,r]){return e.map(({unrealisedPnlRv:n,userID:i,currency:o,accountID:a,accountBalanceRv:s,totalUsedBalanceRv:c,bonusBalanceRv:u})=>{const d=Number(n);let f,b,y,m;if(["USDT","MUSDT"].includes(o)){const v=t&&r?r:{totalBalanceRv:s,totalUsedBalanceRv:c,totalBonusRv:u,isolatedTotalBalanceRv:0};f=Number(v.totalBalanceRv),b=Number(v.totalUsedBalanceRv),y=Number(v.totalBonusRv),m=Number(v.isolatedTotalBalanceRv)}else f=Number(s),b=Number(c),y=Number(u),m=0;return{accountBalanceEv:f,accountID:a,bonusBalanceEv:y,currency:o,totalUsedBalanceEv:b,unrealisedPnlEv:d,userID:i,isolatedTotalBalanceEv:m}})}const Yp=Ho.pipe(l(e=>function(t){return Array.from(new Set(e)).reduce((r,n)=>r.has(n)?r:r.set(n,{accountBalanceEv:0,accountID:0,bonusBalanceEv:0,currency:n,totalUsedBalanceEv:0,userID:0,tradeLevel:0,isolatedTotalBalanceEv:0}),t)})),Gp=$p.pipe(l(e=>function(t){return e.forEach(r=>t.set(r.currency,r)),t})),Kp=Xp.pipe(l(e=>function(t){return e.forEach(r=>t.set(r.currency,r)),t})),Jp=fe.pipe(l(()=>function(e){return e.clear(),e})),_s=F(Yp,Gp,Kp,Jp).pipe(H((e,t)=>t(e),new Map)),Zp=B([ye,ne]).pipe(l(([e,t])=>t.get("."+e)),Ie()),qs=B([ye,Zp]).pipe(l(([e,t])=>ed(e,t))),As=B([Vp,Zn,Wo,He,kt,le,Wn]).pipe(ge(500),l(([e,t,r,n,i,o,a])=>e.toArray().map(({symbol:s,posSide:c,valuationCurrency:u})=>{const d=["USDT","MUSDT"].includes(u),{valueScale:f,valuePrecision:b}=o.get(u),y=["USDC","USDT","MUSDT","PT"].indexOf(u)>-1?0:f;if(s){const m=s+c;if(t.has(m)){const v=t.get(m),E=n.get(v.symbol),{mmCost:S}=Li(v,r,n,i,a),{accountBalanceRv:w}=e.get(m)||{accountBalanceRv:"0"},T=i.get(v.symbol),P=T?T.markPriceEp:0,x=Rr(v,P,E),O=g(w).plus(x),k=O.gt(0)?O:g(0),R=g(S).gt(0)?S:g(0),{marginRatioRr:I,marginRatio:Q}=ji(d,O,S);return{key:m,symbol:s,side:v.side,currency:u,totalEquity:p.floor(k,b,y),maintenanceMargin:p.floor(R,b,y),marginRatioRr:Number(I),marginRatio:Q}}return null}else{const m=t.toArray().filter(({isCross:C,size:M,type:A})=>C&&M>0&&A==="PerpetualV2"),v=m.filter(({posMode:C})=>C==="OneWay").map(C=>{const{mmCost:M}=Li(C,r,n,i,a);return M}).reduce((C,M)=>C.plus(M),g(0)),E=m.filter(({posMode:C})=>C==="Hedged"),S=Array.from(new Set(E.map(({symbol:C})=>C))).map(C=>{const M=E.filter(j=>j.symbol===C),A=M.find(({posSide:j})=>j==="Long"),q=M.find(({posSide:j})=>j==="Short"),{mmCost:U}=sd(A,q,r,n,i,a);return U}).reduce((C,M)=>C.plus(M),g(0)),w=m.reduce((C,M)=>{const A=i.get(M.symbol),q=n.get(M.symbol),U=A?A.markPriceEp:0,j=Rr(M,U,q);return C.plus(j)},g(0)),{accountBalanceRv:T,totalOrdUsedBalanceRv:P,fixedUsedRv:x}=e.get("Invalid"),O=g(T).plus(w).minus(x||0).minus(P||0),k=v.plus(S),R=O.gt(0)?O:g(0),I=k.gt(0)?k:g(0),{marginRatioRr:Q,marginRatio:D}=ji(d,O,k);return{key:"Cross",symbol:"",side:"",currency:u,totalEquity:p.floor(R,b,y),maintenanceMargin:p.floor(I,b,y),marginRatioRr:Q,marginRatio:D}}}).filter(Boolean).reduce((s,c)=>s.set(c.key,c),new Map))),ti=B([He,Zn,kt,_s,qs,As,rt]).pipe(l(([e,t,r,n,i,o,a])=>Fs(e,t,r,n,i,o,a)),ft());function ed(e,t){if(t){const{price:r,priceEp:n}=t;return{fiat:e,price:r,priceEp:n}}return null}function Fs(e,t,r,n,i,o,a){return t.toArray().map(s=>{const{symbol:c,currency:u}=s,d=e.get(c);if(!d)return null;const f=r.get(c);if(!f)return null;const b=n.get(u);return b?td(s,d,f,b,i,o,a):null}).filter(Boolean)}function td(e,t,r,n,i,o,a){var s,c;const{type:u,displaySymbol:d,settleCurrency:f,valuePrecision:b,pricePrecision:y,priceScale:m,valueScale:v}=t,{valueEv:E,assignedPosBalanceEv:S,curTermRealisedPnlEv:w,curTermDiscountFeeEv:T,size:P,side:x,posMode:O,posSide:k,avgEntryPriceEp:R,liquidationPriceEp:I,riskLimitEv:Q,buyLeavesValueEv:D,sellLeavesValueEv:C,isCross:M,symbol:A,bankruptCommEv:q,positionMarginEv:U}=e,j=S||0,$=p.floor(j,b,v),X=t.type==="PerpetualV2",ee=a&&X?Number(g(U).plus(q)):j,oe=p.floor(ee,b,v),me=r?r.closeEp:0,ae=r?r.markPriceEp:0,pe=r?r.indexPriceEp:0,Re=Number(se(w,T||0)),_e=p.floor(Re,b,v),Z=Rr(e,me,t),Yt=p.floor(Z,b,v),Ye=Rr(e,ae,t),Le=p.floor(Ye,b,v),Gt=id(e,Ye),Kt=p.floor(Gt,b,v),ht=ur(t,i,ee,pe),It=ur(t,i,Re,pe),gt=ur(t,i,Z,pe),Dt=ur(t,i,Ye,pe),Jt=od(e,t.ratioScale),Zt=Or.leverageErToLeverage(Jt,t.ratioScale,{removeEnd0:!0,unit:""}),{accountBalanceEv:er,totalUsedBalanceEv:tr}=n,Gr=er-tr,rr=W(X?W(S,Ye):S,Pr(Gr,0)),Mt=X?be(ae,P):E,nr=+rr>0&&+Mt>0?g(Mt).div(rr):0,Kr=g(nr).gt(.01)?p.floor(nr,2):"0.01",Nt=p.floor(R,y,m),ic=_.toContQuantity(t,P),oc=_.toCont(t,P),sc=_.toValueQuantity(t,P,Nt),ac=_.toValue(t,P,Nt),cc=_.toCoinQuantity(t,P,Nt),uc=_.toCoin(t,P,Nt),lc=A+k,vi=M?"Cross":lc,pc=o&&((s=o.get(vi))===null||s===void 0?void 0:s.marginRatioRr)||0,dc=o&&((c=o.get(vi))===null||c===void 0?void 0:c.marginRatio)||"--";return Object.assign(Object.assign({},e),{type:u,posMode:O||"OneWay",posSide:k||"Merged",displaySymbol:d,settleCurrency:f,sizeStr:rd(P,x),value:p.floor(E,b,v),valueWU:p.delimit(p.floor(E,b,v))+" "+f,avgEntryPrice:Nt,liquidationPrice:p.floor(I,y,m),liquidationDistance:p.floor(Math.abs(I-ae),y,m),riskLimit:p.floor(Q,0,v),leverageEr:Jt,leverage:Zt,leverageX:`${Zt}${wn.unit}`,marginEv:j,margin:$,marginWU:oe+" "+t.settleCurrency,marginFiat:ht,marginFiatWU:lr(t,i,ht),markPriceEp:ae,markPrice:r?r.markPrice:0 .toFixed(y),realisedPnlEv:Re,realisedPnl:_e,realisedPnlWU:_e+" "+f,realisedPnlFiat:It,realisedPnlFiatWU:lr(t,i,It),buyLeavesValue:p.floor(D,b,v),sellLeavesValue:p.floor(C,b,v),usedLimit:nd(e,b,v),unrealisedPnlEvByLastPrice:Z,unrealisedPnlByLastPrice:Yt,unrealisedPnlByLastPriceWU:Yt+" "+f,unrealisedPnlByLastPriceFiat:gt,unrealisedPnlByLastPriceFiatWU:lr(t,i,gt),roiByLastPrice:Ui(Z,ee),unrealisedPnlEvByMarkPrice:Ye,unrealisedPnlByMarkPrice:Le,unrealisedPnlByMarkPriceWU:Le+" "+f,unrealisedPnlByMarkPriceFiat:Dt,unrealisedPnlByMarkPriceFiatWU:lr(t,i,Dt),roiByMarkPrice:Ui(Ye,ee),maxRemovableEv:Gt,maxRemovable:Kt,maxRemovableWU:Kt+" "+f,actualLeverage:Kr,sizeByCont:ic,sizeByContWU:oc,sizeByValue:sc,sizeByValueWU:ac,sizeByCoin:cc,sizeByCoinWU:uc,marginRatio:dc,marginRatioRr:pc})}function rd(e,t){return e===0?"0":(t==="Sell"?"-":"")+p.delimit(e)}function nd(e,t,r){if(!e)return 0 .toFixed(t);const n=e.buyLeavesValueEv+(e.side==="Buy"?e.valueEv:0),i=e.sellLeavesValueEv+(e.side==="Sell"?e.valueEv:0);return p.floor(Math.max(n,i),t,r)}function Rr(e,t,r){const{contractSide:n,contractSize:i,valueFactor:o,priceFactor:a}=r;return op({side:e.side,contractSide:n,contractSize:i,qty:e.size,entryPriceEp:e.avgEntryPriceEp,exitPriceEp:t,factor:o,priceFactor:a})}function Ui(e,t){return t===0?"0.00%":p.floor(Ze(e*100,t),2)+"%"}function id(e,t){const{assignedPosBalanceEv:r,posCostEv:n,size:i}=e;if(i===0)return 0;const o=t>0?0:Math.abs(t),a=g(r).minus(n).minus(o);return a.gt(0)?Math.floor(Number(a)):0}function ur(e,t,r,n){if(!t)return"";const{contractSide:i,valueScale:o,isSupportHedge:a}=e,s=a?1e4:1,c=g(r).times(s).div(t.priceEp);if(i>0){const d=p.floor(c,Tt);return p.delimit(d)}const u=p.floor(g(c).times(n),Tt,o);return p.delimit(u)}function lr(e,t,r){if(!t)return"";const{fiat:n}=t;return e.settleCurrency==="USD"&&n==="USD"?"":r+" "+n}function od(e,t){return e.leverageEr===0?Or.marginRateErToLeverageEr(e.initMarginReqEr,t,t):e.leverageEr}function xn(e,t,r,n){if(!e)return 0;const{symbol:i}=e,o=r.get(i),{maintenanceMargin:a}=rp(o,Object.assign(Object.assign({},e),{markPriceEp:n}),t);return a||0}function sd(e,t,r,n,i,o){if(!e&&!t||(e==null?void 0:e.size)<=0&&(t==null?void 0:t.size)<=0)return{mm:0,posValue:0,mmCost:0};const a=(e==null?void 0:e.size)||0,s=(t==null?void 0:t.size)||0,c=a>s?e:t,u=a>s?t:e,d=Ls(c==null?void 0:c.symbol,i),f=c?xn(c,r,n,d):0,b=u?xn(u,r,n,d):0,y=g(f).minus(b),m=se(be((c==null?void 0:c.size)||0,d),be((u==null?void 0:u.size)||0,d)),v=Us(c.posSide==="Long",m,y,o);return{mm:y,posValue:m,mmCost:W(v,y)}}function Li(e,t,r,n,i){if(!e||e.size<=0)return{mm:0,posValue:0,mmCost:0};const o=Ls(e.symbol,n),a=xn(e,t,r,o),s=be(e.size,o),c=Us(e.side==="Buy",s,a,i);return{mm:a,posValue:s,mmCost:W(c,a)}}function ji(e,t,r){const n=t.gt(0)&&g(r).gt(0)?t.div(r):g(999),i=n.gt(999)?999:Number(n),o=e?p.floor(i,2,-2)+"%":"--";return{marginRatioRr:i,marginRatio:o}}function Us(e,t,r,n){return e?g(t).minus(r).times(n):g(t).plus(r).times(n)}function Ls(e,t){const r=t.get(e);return r?r.markPriceEp:0}const js=B([_s,ti,le,De,rt]).pipe(l(([e,t,r,n,i])=>e.toArray().map(o=>Vs(o,t,r,n,i))));function ad(e){return e.reduce((t,r)=>t+r.marginEv,0)}function Vi(e){return e.reduce((t,r)=>t+r.unrealisedPnlEvByMarkPrice,0)}function cd(e){return e.filter(t=>t.isCross&&t.unrealisedPnlEvByMarkPrice<0).reduce((t,r)=>t+r.unrealisedPnlEvByMarkPrice,0)}function ud(e){return e.reduce((t,r)=>t+r.orderCostEv,0)}function Vs(e,t,r,n,i){const{currency:o,accountBalanceEv:a,totalUsedBalanceEv:s,bonusBalanceEv:c,isolatedTotalBalanceEv:u=0}=e,d=n.filter(ae=>ae.settleCurrency===o),f=t.filter(ae=>d.some(pe=>pe.symbol===ae.symbol)),b=t.filter(({isCross:ae,size:pe,symbol:Re,currency:_e})=>["USDT","MUSDT"].includes(_e)&&ae&&pe>0&&d.some(Z=>Z.symbol===Re)),y=Vi(f),{valueScale:m,valuePrecision:v,name:E}=r.get(o),S=/^USD\w$/.test(o)?4:v,w=["USDC","USDT","MUSDT","PT"].indexOf(o)>-1?0:m,T=i?Vi(b):0,P=T>0?.99:1.01,x=g(T).times(P),O=a-u,k=g(O).plus(T).minus(s),R=g(O).plus(x).minus(s),I=k.gte(0)?Number(k):0,Q=R.gte(0)?Number(R):0,D=p.floor(I,S,w),C=p.floor(I,2,w),M=p.floor(I,4,w),A=ad(f),q=ud(f),U=cd(f),j=a+U,$=Number(a)+Number(y),X=g(Q).minus(c),ee=X.gte(0)?Number(X):0,oe=p.floor(ee,v,w),me=p.floor(ee,2,w);return{name:E,currency:o,accountBalanceEv:a,accountBalance:p.floor(a,v,w),totalUsedBalanceEv:s,totalUsedBalance:p.floor(s,v,w),availableBalanceEv:I,availableBalance:D,availableBalanceWU:D+" "+o,availableBalance2:C,availableBalance2WU:C+" "+o,availableBalance4:M,availableBalance4WU:M+" "+o,availableTransferBalanceEv:ee,availableTransferBalance:oe,availableTransferBalanceWU:oe+" "+o,availableTransferBalance2WU:me+" "+o,bonusBalanceEv:c,bonusBalance:p.floor(c,v,w),positionMarginEv:A,positionMargin:p.floor(A,v,w),unrealisedPnlEv:y,unrealisedPnl:p.floor(y,v,w),equityEv:$,equity:p.floor($,v,w),marginBalanceEv:j,marginBalance:p.floor(j,v,w),orderMarginEv:q,orderMargin:p.floor(q,v,w)}}B([Pe,rt,Ur]).pipe(h(([,e,t])=>e&&t.length>0)).subscribe(([,e,t])=>{z.next({method:"ras.subscribe",params:[t]})});const ld=re.pipe(h(e=>!!e.risk_units),we(Ne),h(([e,t])=>e.risk_units.filter(r=>r.userID!==t).length>0),l(([e])=>{var t;return{userId:(t=e==null?void 0:e.risk_units[0])===null||t===void 0?void 0:t.userID,data:Object.assign({},e)}})),pd=B([ld,Ur]).pipe(h(([{userId:e},t])=>t.includes(e)),l(([{userId:e,data:t}])=>function(r){return r.set(e,Ms(t.risk_units)),r}),H((e,t)=>t(e),new Map),Y(new Map)),dd=B([Xn,Ho]).pipe(l(([e,t])=>{const r=function(n){return Array.from(new Set(t)).reduce((i,o)=>i.has(o)?i:i.set(o,{accountBalanceEv:0,accountID:0,bonusBalanceEv:0,currency:o,totalUsedBalanceEv:0,userID:0,tradeLevel:0,isolatedTotalBalanceEv:0}),n)};return n=>e.reduce((i,o)=>i.set(o,r(new Map)),n)})),fd=fe.pipe(l(()=>e=>(e.clear(),e)));function zs(e,t){return function(r){const n=r.get(e)||new Map;return r.set(e,t(n)),r}}const yd=rs.pipe(h(e=>!!e.data.accounts),l(e=>{const t=function(r){return e.data.accounts.forEach(n=>r.set(n.currency,n)),r};return zs(e.userId,t)})),bd=ns.pipe(h(e=>!!e.data.accounts)),vd=B([bd,rt,pd]).pipe(l(([e,t,r])=>{const n=r.get(e.userId);return{accounts:Ns([e.data.accounts,t,n]),userId:e.userId}})),md=vd.pipe(l(e=>{const t=function(r){return e.accounts.forEach(n=>r.set(n.currency,n)),r};return zs(e.userId,t)})),Ws=F(dd,yd,md,fd).pipe(H((e,t)=>t(e),new Map)),hd=rs.pipe(h(e=>!!e.data.positions),l(e=>({userId:e.userId,data:e.data.positions}))),gd=ns.pipe(h(e=>!!e.data.positions),l(e=>({userId:e.userId,data:ei(e.data.positions)})));function $s(e,t){return function(r){const n=r.get(e)||new Map;return r.set(e,t(n)),r}}const Ed=Xn.pipe(l(e=>t=>(e.forEach(r=>{t.set(r,new Map)}),t))),Sd=fe.pipe(l(()=>function(e){return e.clear(),e})),Pd=hd.pipe(l(e=>{const t=function(r){return e.data.forEach(n=>{r.set(n.symbol,Object.assign(Object.assign(Object.assign({},r.get(n.symbol)),n),Vr(n,r.get(n.symbol))))}),r};return $s(e.userId,t)})),Td=gd.pipe(l(e=>{const t=function(r){return e.data.forEach(n=>{const{symbol:i,posSide:o,posMode:a}=n,s=i+o;["Merged","Long","Short"].forEach(c=>{const u=i+c;r.has(u)&&r.set(u,Object.assign(Object.assign({},r.get(u)),{posMode:a}))}),r.set(s,Object.assign(Object.assign(Object.assign({},r.get(s)),n),Vr(n,r.get(s))))}),r};return $s(e.userId,t)})),wd=F(Ed,Sd,Pd,Td).pipe(H((e,t)=>t(e),new Map)),Hs=B([Xn,He,wd,kt,Ws,qs]).pipe(l(([e,t,r,n,i,o])=>e.reduce((a,s)=>a.set(s,Fs(t,r.get(s)||new Map,n,i.get(s),o,new Map,!1)),new Map)),ft()),xd=Bd(Yn);function Bd(e){return e.pipe(Je(t=>Hs.pipe(l(r=>t.reduce((n,i)=>n.set(i,r.get(i)||[]),new Map)),ge(1e3))))}const Xs=B([Ur,Ws,Hs,le,De,rt]).pipe(ge(100),l(([e,t,r,n,i,o])=>e.reduce((a,s)=>a.set(s,(t.get(s)||new Map).toArray().map(c=>Vs(c,r.get(s),n,i,o))),new Map))),Od=Ys(Yn),Rd=Ys(Ko);function Ys(e){return e.pipe(Je(t=>Xs.pipe(l(r=>t.reduce((n,i)=>n.set(i,r.get(i)||[]),new Map)))))}const Cd=B([Qt,Ar]).pipe(h(([e])=>!!e.accounts),l(([e,t])=>e.accounts.find(r=>r.currency===t.symbol)),h(Boolean),Vn(e=>{Ir("aop_pt_account",{content:e})}),l(e=>e.status===1),Ie(),Y(!1));function Qd(){js.pipe(l(e=>({type:"accounts",data:{accounts:e}}))).subscribe(e=>N.next(e)),Od.pipe(l(e=>({type:"accounts-copy-trade",data:e})),ge(500)).subscribe(e=>N.next(e)),Rd.pipe(l(e=>({type:"accounts-bot-trade",data:e})),ge(500)).subscribe(e=>N.next(e)),Cd.pipe(l(e=>({type:"contract-pt-discount-state",data:{state:e}}))).subscribe(e=>N.next(e))}const kd=ke.pipe(l(({symbol:e})=>({reset:!0,symbol:e,bids:[],asks:[]}))),Id=Jn.pipe(ge(1e3),l(Dd),h(Boolean));F(kd,Id);function Dd({tradePair:e,bids:t,bidPriceEps:r,asks:n,askPriceEps:i}){if(!e)return null;const{symbol:o,pricePrecision:a,priceScale:s,type:c}=e,{baseQtyPrecision:u=0,baseQtyScale:d=0,quoteQtyScale:f=0}=e,b=c==="Spot"?f:s,y=zi(t,r,a,b,u,d),m=zi(n,i,a,b,u,d);return{reset:!1,symbol:o,bids:y,asks:m}}function zi(e,t,r,n,i,o){return t.reduce((a,s)=>{const c={priceEp:s,price:p.floor(s,r,n),total:i===0?a.total:Number(p.floor(a.total,i,o))};return{total:a.total+e.get(s),items:[...a.items,c]}},{total:0,items:[]}).items}const Wi={convertToBar(e,t){const{pricePrecision:r}=t,n=Md(t),i=Number(e[2]),o=Number(e[3]),a=i>0?i:o;return{close:At(Number(e[6]),r,n),high:At(Number(e[4]),r,n),low:At(Number(e[5]),r,n),open:At(a,r,n),time:e[0]*1e3,volume:Nd(Number(e[7]),t)}}};function Md(e){return e.type==="Spot"?e.quoteQtyScale:e.priceScale}function At(e,t,r){return Number(p.floor(e,t,r))}function Nd(e,t){if(t.type==="Spot"){const{baseQtyPrecision:r,baseQtyScale:n}=t;return At(e,r,n)}return e}const _d=re.pipe(h(e=>!!e.kline||!!e.kline_p),l(qd));function qd(e){var{kline:t,kline_p:r}=e,n=Me(e,["kline","kline_p"]);let i=t||r;return n.symbol.startsWith(".")&&(i=i.map(o=>(o[7]=0,o))),Object.assign(Object.assign({},n),{kline:i})}class Ad{constructor(t,r,n,i){this.symbol=t,this.resolution=r,this.period=n,this.tradeType=i,this.symbol=t,this.tradeType=i,this.resolution=r,this.period=n,this.window=this.resolution*6e4,this.snapshotLastTime=0,this.lastState={id:0,buffer:[]},this.init()}init(){const{symbol:t,resolution:r,period:n}=this;this.dispose$=new ue;const i=_d.pipe(h(s=>s.kline.length>0&&s.symbol===t&&s.kline[0][1]===n)),o=i.pipe(h(s=>s.type==="snapshot"),Vn(s=>this.snapshotLastTime=s.kline[0][0]),l(s=>s.kline.reverse()),Ke(1));this.snapshotData$=B([o,ke]).pipe(l(([s,c])=>s.map(u=>Wi.convertToBar(u,c))),l(s=>({type:"snapshot",symbol:t,resolution:r,bars:s})));const a=i.pipe(h(s=>s.type==="incremental"),l(s=>s.kline.filter(c=>c[0]>=this.snapshotLastTime).reverse()));this.incrementalData$=B([a,ke]).pipe(l(([s,c])=>s.map(u=>Wi.convertToBar(u,c))),l(s=>({type:"incremental",symbol:t,resolution:r,bars:s})))}start(){F(this.snapshotData$,this.incrementalData$).pipe(Bu(this.dispose$)).subscribe(t=>N.next({type:"kline",data:t})),this.subscribeKline()}dispose(t){this.dispose$.next(),this.unsubscribeKline(t)}subscribeKline(){const t=this.tradeType==="PerpetualV2"?"kline_p1.subscribe":"kline_v1.subscribe";z.next({method:t,params:[this.symbol,this.period]})}unsubscribeKline(t){if(t)return;const r=this.tradeType==="PerpetualV2"?"kline_p1.unsubscribe":"kline_v1.unsubscribe";z.next({method:r,params:[this.symbol,this.period]})}}class Fd{constructor(){this.cache=new Map}subscribe(t,r,n){const i=t+"_"+r;if(this.cache.has(i))return;const o=r*60,a=new Ad(t,r,o,n);this.cache.set(i,a),a.start()}unsubscribe(t,r,n){const i=t+"_"+r;this.cache.has(i)&&(this.cache.get(i).dispose(n),this.cache.delete(i))}clear(){this.cache.clear()}}const cn=new Fd,Ud=G.pipe(h(e=>e.type==="kline-subscribe")),Ld=G.pipe(h(e=>e.type==="kline-unsubscribe"));function jd(){at.subscribe(()=>cn.clear()),Ud.subscribe(e=>cn.subscribe(e.symbol,e.resolution,e.tradeType)),Ld.subscribe(e=>cn.unsubscribe(e.symbol,e.resolution,e.shouldNotUnsubscribe))}const Gs=e=>{const t=new Date(e),r=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return[r,n,i].map(p.pad).join("-")},ri=e=>{const t=new Date(e),r=t.getHours(),n=t.getMinutes(),i=t.getSeconds();return[r,n,i].map(p.pad).join(":")},Vd=e=>{const t=new Date(e),r=t.getMonth()+1,n=t.getDate();return[r,n].map(p.pad).join("-")},zd=e=>[Vd(e),ri(e)].join(" "),Wd=e=>[Gs(e),ri(e)].join(" "),$d=e=>{const t=new Date(e),r=t.getUTCFullYear(),n=t.getUTCMonth()+1,i=t.getUTCDate();return[r,n,i].map(p.pad).join("-")},Hd=e=>{const t=new Date(e),r=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds();return[r,n,i].map(p.pad).join(":")},Te={formatDate:Gs,formatMonthDayTime:zd,formatTime:ri,formatDateTime:Wd,formatUTCDate:$d,formatUTCTime:Hd},Xd=re.pipe(h(e=>!!e.trades||!!e.trades_p),l(e=>{const{trades_p:t,trades:r}=e,n=Me(e,["trades_p","trades"]);return Object.assign(Object.assign({},n),{trades:r||Yd(t)})}));function Yd(e){return e.map(([t,r,n,i])=>[t,r,Number(n),Number(i)])}const Ks=Jd(ke,Xd,Kn),Gd=200,Kd=450;function Jd(e,t,r){const n=e.pipe(l(({symbol:o,type:a})=>({reset:!0,symbol:o,tradeType:a,trades:[]}))),i=e.pipe(Je(o=>nf(o,t,r)));return F(n,i)}function Zd([e,t,r,n],i,o,a,s,c,u){const d=af(n,r,c,u),f=cf(n,r,c,u);return{time:Te.formatTime(e/1e6),buy:t==="Buy",sell:t==="Sell",priceEp:r,price:a(r),size:c.type==="Spot"?n:f,sizeStr:c.type==="Spot"?s(n):d,up:!1,down:!1,fa:i,fb:o}}function ef(e){const t=e.length;if(!(t<2))for(let r=t-1;r>0;r--){const n=e[r],i=e[r-1];i.up=i.priceEp>n.priceEp,i.down=i.priceEp<n.priceEp}}function tf(e,t){return t?e:e===2?1:2}function rf(e,t,r,n){e.forEach((i,o)=>{const a=r.get(o)||0,s=t.get(o),c=tf(s,Kd>n-a);c!==s&&(t.set(o,c),r.set(o,n))})}function nf(e,t,r){const n=new Map,i=new Map,o=t.pipe($i(e.symbol,"snapshot"),l(d=>function(){return d.trades})),a=t.pipe($i(e.symbol,"incremental"),l(d=>(rf(d.trades,n,i,Date.now()),function(f){return f?d.trades.concat(f):d.trades}))),s=F(o,a).pipe(H((d,f)=>f(d).slice(0,Gd),null)),c=of(e),u=sf(e);return B([s,r]).pipe(l(([d,f])=>{const b=d.filter(y=>{var m;return((m=e.timeline)===null||m===void 0?void 0:m.length)>0?y[0]/1e6>((e==null?void 0:e.timeline[1])||0):!0}).map((y,m)=>{const v=n.get(m);return Zd(y,v===1,v===2,c,u,e,f)});return ef(b),{reset:!1,symbol:e.symbol,tradeType:e.type,trades:b}}))}function of(e){if(e.type==="Spot"){const{pricePrecision:t,quoteQtyScale:r}=e;return function(n){return p.floor(n,t,r)}}if(["Perpetual","PerpetualV2"].indexOf(e.type)>-1){const{pricePrecision:t,priceScale:r}=e;return function(n){return p.floor(n,t,r)}}return null}function sf(e){if(e.type==="Spot"){const{baseQtyPrecision:t,baseQtyScale:r}=e;return function(n){return p.abbreviateNumber(p.floor(n,t,r),t)}}return["Perpetual","PerpetualV2"].indexOf(e.type)>-1?function(t){return p.delimit(t)}:null}function $i(e,t){return h(r=>r.symbol===e&&r.type===t)}function af(e,t,r,n){const{contractSide:i,contractSize:o,valuePrecision:a,contractSizePrecision:s,qtyPrecision:c=0,priceFactor:u}=r;if(n===te.Cont){const d=e>1e3?2:c;return p.abbreviateNumber(e,d)}if(n===te.Base){const d=Js(e,i,o,t,u);return p.abbreviateNumber(d,a)}if(n===te.Coin){const d=g(e).times(o),f=Number(d)>1e3?2:s;return p.abbreviateNumber(d,f)}return"0"}function cf(e,t,r,n){const{contractSide:i,contractSize:o,priceFactor:a}=r;return n===te.Cont?e:n===te.Base?Js(e,i,o,t,a):n===te.Coin?Number(g(e).times(o)):0}function Js(e,t,r,n,i){const o=g(e).times(r);return Number(t>0?o.times(n).div(i):o.times(i).div(n))}const uf=B([He,Ks.pipe(h(e=>["Perpetual","PerpetualV2"].indexOf(e.tradeType)>-1)),kt]).pipe(l(lf),h(Boolean),ie(1));function lf([e,{symbol:t,trades:r},n]){const i=e.get(t);if(!i||!n.has(t))return null;const{pricePrecision:o,priceScale:a}=i,s=n.get(t),c=r.length>0?r[0].priceEp:s.closeEp,u=c>0?p.floor(c,o,a):"--",d=c!==0&&s.openEp!==0?c-s.openEp:0,f=c>0?p.floor(d,o,a):"--",b=pf(d,f),y=df(c,s.openEp),m=ff(y);return Object.assign(Object.assign({},s),{closeEp:c,close:u,change24hEp:d,change24hStr:b,changePercent:y,changePercentStr:m})}function pf(e,t){return(e>0?"+":"")+t}function df(e,t){return e===0||t===0||e===t?0:(e-t)*100/t}function ff(e){if(e===0)return"--%";const t=e>0?"+":"",r=p.floor(e,2);return t+r+"%"}function yf(){at.subscribe(()=>{z.next({method:"perp_market24h_pack.subscribe",params:[]}),z.next({method:"perp_market24h_pack_p.subscribe",params:{}})}),kt.subscribe(e=>N.next({type:"market24h-contract",data:e})),uf.subscribe(e=>N.next({type:"market24h-contract-realtime",data:e}))}const Zs=B([ne,ye]).pipe(h(([e,t])=>e.has("."+t)),Ie((e,t)=>e[0].get("."+t)!==t[0].get("."+t))),bf=Zs.pipe(l(vf),ft()),zr=B([vt,Zs]).pipe(l(mf),ft());function vf([e,t]){const r=e.get("."+t);return function(n,i,o){const a=i-Be,s=e.get("."+o);if(!s)return"--"+t;const c=Number(g(n).times(s.priceEp).div(r.priceEp).div(s.priceFactor)),u=c<100?6:Tt;return p.delimit(p.floor(c,u,a))+" "+t}}function mf([e,[t,r]]){const n=t.get("."+r);return function(i,o,a=!1){const s=hf(o,i,e,t,n.priceEp,a);return[p.delimit(s)+" "+r,s]}}function hf(e,t,r,n,i,o=!1){const a=r.get(t);if(!a)return 0 .toFixed(Tt);const s=n.get("."+t);if(!s)return 0 .toFixed(Tt);const c=gf(e,s.priceEp,i),u=o?0:a.valueScale;return p.floor(c,Tt,u)}function gf(e,t,r){return g(e).times(t).div(r).toString()}const Ef=B([$n,Qs,bf,ne]).pipe(ge(50),l(Sf),h(e=>e.length>0),ie(1));function Sf([e,t,r,n]){return t.map(i=>Pf(e,i,r,n)).filter(Boolean)}function Pf(e,t,r,n){const{symbol:i}=t,o=e.get(i);if(!o)return null;const{bidEp:a,askEp:s,lastEp:c,highEp:u,lowEp:d,openEp:f,indexEp:b,turnoverEv:y,volumeEv:m}=t,{type:v,displaySymbol:E,name:S,baseCurrency:w,quoteCurrency:T,displayBaseCurrency:P,pricePrecision:x,quoteQtyScale:O,quoteQtyPrecision:k,status:R,baseQtyPrecision:I,baseQtyScale:Q}=o,D=O,C=Of(n,T,y),M=p.floor(C,k,O),A=p.floor(m,I,Q),q=wf(c,f),U=c-f,j=p.floor(U,x,D);return R!=="Listed"?Bf(o):{type:v,symbol:i,status:R,displaySymbol:E,baseCurrency:w,bid1Ep:a,ask1Ep:s,openEp:f,open:p.floor(f,x,D),closeEp:c,close:p.floor(c,x,D),closeMoneyWU:r(c,D,T),highEp:u,high:p.floor(u,x,D),lowEp:d,low:p.floor(d,x,D),indexPriceEp:b,indexPrice:p.floor(b,x,D),turnoverEv:C,turnoverStr:p.abbreviateNumber(M),volume24hStr:p.abbreviateNumber(A),changePercent:q,changePercentStr:xf(q),change24hEp:U,change24hStr:Tf(U,j),name:S,displayBaseCurrency:P,klineData:[],quoteCurrency:T,combinationTurnoverEv:Number(M),volumeEv:m}}function Tf(e,t){return(e>0?"+":"")+t}function wf(e,t){return e===0||t===0||e===t?0:(e-t)*100/t}function xf(e){if(e===0)return"0.00%";const t=e>0?"+":"",r=p.floor(e,2);return t+r+"%"}function Bf({type:e,symbol:t,status:r,displaySymbol:n,baseCurrency:i,name:o}){return{type:e,symbol:t,status:r,displaySymbol:n,baseCurrency:i,bid1Ep:0,ask1Ep:0,openEp:0,open:"--",closeEp:0,close:"--",closeMoneyWU:"--",highEp:0,high:"--",lowEp:0,low:"--",indexPriceEp:0,indexPrice:"--",turnoverEv:0,turnoverStr:"--",volume24hStr:"--",changePercent:0,changePercentStr:"--",change24hEp:0,change24hStr:"--",name:o,displayBaseCurrency:"",klineData:[],quoteCurrency:"USDT",combinationTurnoverEv:0,volumeEv:0}}function Of(e,t,r){if(t==="TRY"){const n=e.get("."+t);return n?g(r).times(n.priceEp).div(n.priceFactor).toNumber():0}return r}const ea=Ef.pipe(dt(),H((e,t)=>e.set(t.symbol,t),new Map),ge(100),ie(1)),Rf=Ks.pipe(h(e=>e.tradeType==="Spot")),Cf=B([$n,Rf,ea]).pipe(l(Qf),h(Boolean));function Qf([e,{symbol:t,trades:r},n]){const i=e.get(t);if(!i||!n.has(t))return null;const{pricePrecision:o,quoteQtyScale:a}=i,s=n.get(t),c=r.length>0?r[0].priceEp:s.closeEp,u=p.floor(c,o,a),d=c!==0&&s.openEp!==0?c-s.openEp:0,f=p.floor(d,o,a),b=kf(d,f),y=If(c,s.openEp),m=Df(s.changePercent);return Object.assign(Object.assign({},s),{closeEp:c,close:u,change24hEp:d,change24hStr:b,changePercent:y,changePercentStr:m})}function kf(e,t){return(e>0?"+":"")+t}function If(e,t){return e===0||t===0||e===t?0:(e-t)*100/t}function Df(e){if(e===0)return"0.00%";const t=e>0?"+":"",r=p.floor(e,2);return t+r+"%"}function Mf(){at.subscribe(()=>z.next({method:"spot_market24h_pack.subscribe",params:[]})),ea.subscribe(e=>N.next({type:"market24h-spot",data:e})),Cf.subscribe(e=>N.next({type:"market24h-spot-realtime",data:e}))}const J={isConditionalOrder(e){return["Stop","StopLimit","LimitIfTouched","MarketIfTouched","BoSlLimit","BoSlMarket"].indexOf(e)>-1},isLimitOrder(e){return["Bracket","StopLimit","LimitIfTouched","BoTpLimit","BoSlLimit"].indexOf(e)>-1},isMarketOrder(e){return["Market","Stop","MarketIfTouched","BoSlMarket"].indexOf(e)>-1},isBracketOrders(e){return["Bracket","BoTpLimit","BoSlLimit","BoSlMarket"].indexOf(e)>-1},isFinalOrder(e){return["Deactivated","Filled","Canceled","Rejected"].indexOf(e)>-1},isActivation(e,t){return t==="TrailingTakeProfitPeg"&&e==="Inactive"},formatOrderQty(e){return e>0?p.delimit(e):"PositionSize"}},ta=new Oe(te.Coin),ra=new Oe(te.Coin);G.pipe(h(e=>e.type==="qty-before-v2-change"),l(e=>e.qtyType)).subscribe(e=>ta.next(e));G.pipe(h(e=>e.type==="qty-v2-change"),l(e=>e.qtyType)).subscribe(e=>ra.next(e));const Nf=F(ls,fs).pipe(l(({orders:{open:e,closed:t}})=>[].concat(t,e)),dt()),_f=F(us,ds).pipe(l(({orders:{open:e,closed:t}})=>[].concat(t,e))),qf=_f.pipe(l(e=>function(t){return t.clear(),e.forEach(r=>t.set(r.orderID,r)),t})),na=new ue,ia=new Oe(new Map),oa=new ue;oa.asObservable();F(qf,na).pipe(H((e,t)=>t(e),new Map)).subscribe(e=>ia.next(e));Nf.pipe(we(De)).subscribe(([e,t])=>{const r=t.find(o=>o.symbol===e.symbol);if(!r)return;const n=ia.getValue(),i=Af(e,r,n);i&&oa.next(i),na.next(Ff(e))});function _t(e,t,r){const n=(e.type==="Perpetual"?ta:ra).getValue(),i={[te.Cont]:()=>_.toCont(e,t),[te.Base]:()=>_.toValue(e,t,r),[te.Coin]:()=>_.toCoin(e,t,r)};return i[n]&&i[n]()}function Af(e,t,r){const{pricePrecision:n,priceScale:i,pairName:o,settleCurrency:a}=t,{side:s,orderQty:c,priceEp:u,stopPxEp:d,leavesQty:f,ordStatus:b,code:y,action:m,pegPriceType:v="Unspecified",curPosSide:E,stopDirection:S,clOrdID:w,ordType:T}=e,P=J.isMarketOrder(T),x=J.isConditionalOrder(T),O=P?"Market":p.floor(u,n,i),k=p.floor(P?d:u,n,i),R=s,I=c,Q=o,D=a;if(w.startsWith("scaled-")&&T==="Limit"&&m!=="Replace")return null;if(y!==0)return{ID:"OrderError",type:["Canceled","Deactivated"].indexOf(b)>-1?"info":"error",Code:y};if(m==="Replace")return Uf(e,t,r);if(c===0&&(m==="Replace"||m==="New")&&b==="Untriggered"){if(v==="Unspecified"){if(S==="Rising")return{ID:E==="Buy"?"TakeProfileAccepted":"StopLossAccepted",Price:p.floor(e.stopPxEp,n,i)};if(S==="Falling")return{ID:E==="Buy"?"StopLossAccepted":"TakeProfileAccepted",Price:p.floor(e.stopPxEp,n,i)}}if(v==="TrailingStopPeg")return{ID:"TrailingStopAccepted",Price:p.floor(e.stopPxEp,n,i),TrailValue:p.floor(Math.abs(e.pegOffsetValueEp),n,i)};if(v==="TrailingTakeProfitPeg")return{ID:"TrailingProfitAccepted",Price:p.floor(e.stopPxEp-e.pegOffsetValueEp,n,i),TrailValue:p.floor(Math.abs(e.pegOffsetValueEp),n,i)}}if(b==="Deactivated")return{ID:"OrderCanceled"};if(b==="PartiallyFilled"){const C=p.floor(e.execPriceEp,n,i);return{ID:"OrderPartiallyFilled",Symbol:Q,SettleCurrency:D,Side:R,OrderQty:_t(t,e.execQty,C),Price:C,LeavesQty:f}}if(b==="Filled"){const C=p.floor(e.priceEp,n,i);return{ID:"OrderFilled",Symbol:Q,SettleCurrency:D,Side:R,OrderQty:_t(t,I,C),Price:C}}if(m==="New"){if(x&&b==="Untriggered")return{ID:"ConditionalOrderSubmitted",Symbol:Q,SettleCurrency:D,Side:R,OrderQty:_t(t,I,k),Price:O,TriggerPrice:p.floor(e.stopPxEp,n,i)};if(x&&b==="New")return{ID:"ConditionalOrderTriggered",Symbol:Q,SettleCurrency:D,Side:R,OrderQty:_t(t,I,k),Price:O,StopDirection:S==="Rising"?"profit":"stop"};if(!x&&b==="New")return{ID:"OrderSubmitted",Symbol:Q,SettleCurrency:D,Side:R,OrderQty:_t(t,I,k),Price:O}}return b==="Canceled"?{ID:"OrderCanceled"}:null}function Ff(e){return J.isFinalOrder(e.ordStatus)&&e.execStatus!=="ReplaceToCanceled"?function(t){return t.delete(e.orderID,e),t}:function(t){return t.set(e.orderID,e),t}}function Uf(e,t,r){const n=r.get(e.orderID);if(!n)return null;const{pairName:i,settleCurrency:o}=t,{orderQty:a,priceEp:s,stopPxEp:c,tpTimeInForce:u,tpTrigger:d,tpPxRp:f,takeProfitRp:b,slTimeInForce:y,slTrigger:m,slPxRp:v,stopLossRp:E}=e;return n.priceEp!==s||n.orderQty!==a||n.stopPxEp!==c||n.tpTimeInForce!==u||n.tpTrigger!==d||n.tpPxRp!==f||n.takeProfitRp!==b||n.slTimeInForce!==y||n.slTrigger!==m||n.slPxRp!==v||n.stopLossRp!==E?{ID:"OrderModify",Symbol:i,SettleCurrency:o}:null}const Lf=F(ks,Is),jf=Qt.pipe(h(e=>e.type==="incremental"),l(e=>{const t=Xf(e.events),r=ei(e.positions);return Object.assign(Object.assign({},e),{events:t,positions:r})})),Vf=F(Vt.pipe(h(e=>e.type==="incremental")),jf),zf=Vf.pipe(l(({events:e,positions:t})=>t.length<1?null:t.map(r=>{const n=e.find(({symbol:i,posSide:o})=>r.symbol===i&&r.posSide===o);return Object.assign(Object.assign({},r),{event:n})})),h(Boolean),dt()),Wf=Lf.pipe(l(e=>function(t){return e.forEach(r=>{const{symbol:n,posSide:i}=r,o=n+(i||"");t&&t.has(o)?t.set(o,Object.assign(Object.assign({},r),t.get(o))):t.set(o,r)}),t})),sa=new ue,aa=new Oe(new Map),ca=new ue;ca.asObservable();F(Wf,sa).pipe(H((e,t)=>t(e),new Map)).subscribe(e=>aa.next(e));zf.pipe(we(De)).subscribe(([e,t])=>{const r=t.find(o=>o.symbol===e.symbol);if(!r)return;const n=aa.getValue(),i=$f(e,r,n);i&&ca.next(i),sa.next(Hf(e))});function $f(e,t,r){const{event:n}=e;if(!n)return null;const{symbolV2:i,settleCurrency:o,valuePrecision:a,valueScale:s,ratioScale:c}=t,u=i,d=o;if(n.code!==0)return{ID:"Error",Code:n.code};if(n.action==="SetLeverage"){const{symbol:f,posSide:b}=e,y=f+(b||""),m=r.get(y);return m.leverageEr===e.leverageEr?null:{ID:"LeverageModified",Symbol:u,SettleCurrency:d,OldIsIsolated:m.leverageEr>0,OldLeverage:Hi(m.leverageEr,c),Leverage:Hi(e.leverageEr,c),IsIsolated:e.leverageEr>0}}if(n.action==="AssignPosBalance"){const{execValueEv:f}=n;return{ID:f>0?"MarginAdded":"MarginRemoved",Symbol:u,SettleCurrency:d,Amount:p.floor(Math.abs(f),a,s),Currency:o}}return n.action==="SetRiskLimit"?{ID:"RiskLimitModified",Symbol:u,SettleCurrency:d,RiskLimit:p.floor(e.riskLimitEv,0,s)}:n.action==="LiqRequest"?{ID:"PositionLiquidated",Symbol:u,SettleCurrency:d,Side:n.side==="Buy"?"Sell":"Buy",Size:n.orderQty}:n.action==="ADLResult"?{ID:"AutoDeleveraged",Symbol:u,SettleCurrency:d,Side:e.side,Size:e.size}:null}function Hf(e){return function(t){const{symbol:r,posSide:n}=e,i=r+(n||"");return t&&t.has(i)?t.set(i,Object.assign(Object.assign({},t.get(i)),e)):t.set(i,e),t}}function Hi(e,t){return p.trimEnd0(p.ceil(Math.abs(e),2,t))}function Xf(e){return e.map(t=>Object.assign(Object.assign({},t),{execValueEv:Number(t.execValueRv)}))}const L={isConditionalOrder(e){return["Stop","StopLimit","LimitIfTouched","MarketIfTouched"].indexOf(e.ordType)>-1},isMarketOrder(e){return["Market","Stop","MarketIfTouched"].indexOf(e.ordType)>-1},isLiqTradeOrder(e){return e.ordType==="LiqTrade"},calcValue({qtyType:e,priceEp:t,baseQtyEv:r,quoteQtyEv:n,baseQtyScale:i,quoteQtyScale:o,baseQtyPrecision:a,quoteQtyPrecision:s}){const c=this.getByQtyType(e,a,s,!0);if(t<=0)return this.formatDelimit(0,c);const u=g(t).div(g(10).pow(o));if(e==="ByBase"){const d=g(10).pow(i);return this.formatDelimit(g(r).div(d).times(u),c)}if(e==="ByQuote"){const d=g(10).pow(o);return this.formatDelimit(g(n).div(d).div(u),c)}return this.formatDelimit(0,c)},calcValueWU({qtyType:e,priceEp:t,baseQtyEv:r,quoteQtyEv:n,baseQtyScale:i,quoteQtyScale:o,baseQtyPrecision:a,quoteQtyPrecision:s,displayBaseCurrency:c,quoteCurrency:u}){const d=this.calcValue({qtyType:e,priceEp:t,baseQtyEv:r,quoteQtyEv:n,baseQtyScale:i,quoteQtyScale:o,baseQtyPrecision:a,quoteQtyPrecision:s});return e==="ByBase"?[d,u].join(" "):e==="ByQuote"?[d,c].join(" "):"-"},calcQty(e,t,r){return e==="ByBase"?p.delimit(t):e==="ByQuote"?p.delimit(r):""},calcQtyWU(e,t,r,n,i){return e==="ByBase"?p.delimit(t)+" "+r:e==="ByQuote"?p.delimit(n)+" "+i:""},getByQtyType(e,t,r,n=!1){if(e==="ByBase")return n?r:t;if(e==="ByQuote")return n?t:r},joinWU(e,t){return!e||!t?"-":[e,t].join(" ")},formatDelimit(e,t){return p.delimit(p.floor(e,t))},isFinalOrder(e){return["Deactivated","Filled","Canceled","Rejected"].indexOf(e)>-1}};function zt(e,t,r,n){return e?"Market":p.floor(t,r,n)}function ua(e,t,r=!1){if(e.bizError!==0)return{ID:"OrderError",Code:e.bizError};const{side:n,priceEp:i,stopPxEp:o,qtyType:a,baseQtyEv:s,quoteQtyEv:c,leavesBaseQtyEv:u,leavesQuoteQtyEv:d,ordStatus:f,action:b}=e,y=t.find(D=>D.symbol===e.symbol);if(!y)return null;const{pricePrecision:m,baseCurrency:v,quoteCurrency:E,baseQtyPrecision:S,quoteQtyPrecision:w}=y,T=r?0:y.quoteQtyScale,P=r?0:y.baseQtyScale,x=L.isLiqTradeOrder(e),O=L.isMarketOrder(e),k=p.floor(s,S,P),R=p.floor(c,w,T),I=zt(O||x,i,m,T),Q=pa({QtyType:a,Price:I,Side:n,Coin:v},{qtyType:a,baseQty:k,baseCurrency:v,quoteQty:R,quoteCurrency:E});if(b==="Replace")return Q("OrderModify");if(f==="Untriggered")return Q("ConditionalOrderSubmitted",{TriggerPrice:p.floor(o,m,T)});if(f==="Deactivated")return Q("OrderCanceled");if(f==="New")return Q("ConditionalOrderTriggered");if(f==="PartiallyFilled"){const D=p.floor(u,S,P),C=p.floor(se(s,u),S,P),M=p.floor(d,S,P),A=p.floor(se(c,d),S,P),q=L.calcQtyWU(a,C,v,A,E),U=L.calcQtyWU(a,D,v,M,E);return Q("OrderPartiallyFilled",{Amount:q,RemainingAmount:U})}return f==="Filled"?Q("OrderFilled"):f==="Canceled"?Q("OrderCanceled"):null}function la(e,t,r=!1){if(e.bizError!==0)return{ID:"OrderError",Code:e.bizError};const{side:n,priceEp:i,qtyType:o,baseQtyEv:a,quoteQtyEv:s,leavesBaseQtyEv:c,leavesQuoteQtyEv:u,action:d,ordStatus:f}=e,b=t.find(Q=>Q.symbol===e.symbol);if(!b)return null;const{pricePrecision:y,baseCurrency:m,quoteCurrency:v,baseQtyPrecision:E,quoteQtyPrecision:S}=b,w=r?0:b.quoteQtyScale,T=r?0:b.baseQtyScale,P=L.isLiqTradeOrder(e),x=L.isMarketOrder(e),O=p.floor(a,E,T),k=p.floor(s,S,w),R=zt(x||P,i,y,w),I=pa({QtyType:o,Price:R,Side:n,Coin:m},{qtyType:o,baseQty:O,baseCurrency:m,quoteQty:k,quoteCurrency:v});if(d==="Replace")return I("OrderModify");if(f==="New")return I("OrderSubmitted");if(f==="PartiallyFilled"){const Q=p.floor(c,E,T),D=p.floor(se(a,c),E,T),C=p.floor(u,S,w),M=p.floor(se(s,u),S,w),A=L.calcQtyWU(o,D,m,M,v),q=L.calcQtyWU(o,Q,m,C,v);return I("OrderPartiallyFilled",{Amount:A,RemainingAmount:q})}return f==="Filled"?I("OrderFilled"):f==="Canceled"?I("OrderCanceled"):null}function pa({QtyType:e,Price:t,Side:r,Coin:n},{qtyType:i,baseQty:o,baseCurrency:a,quoteQty:s,quoteCurrency:c}){return function(u,d={}){return Object.assign(Object.assign({},d),{ID:u,QtyType:e,Price:t,Side:r,Coin:n,Amount:i==="ByBase"?o+" "+a:s+" "+c})}}const Yf=mt.pipe(l(({open:e,closed:t})=>[].concat(e,t)),dt(),h(e=>e.execStatus!=="ReplaceToCanceled")),[Gf,Kf]=Qo(Yf,e=>L.isConditionalOrder(e)),Jf=B([Gf,Ue]).pipe(l(([e,t])=>ua(e,t)),h(Boolean)),Zf=B([Kf,Ue]).pipe(l(([e,t])=>la(e,t)),h(Boolean));F(Jf,Zf).pipe(h(e=>!!e));const da=fe.pipe(l(()=>e=>(e.clear(),e))),fa=G.pipe(h(e=>e.type==="order-active-remove"),l(e=>t=>(t.delete(e.orderID),t))),ya=Lr.pipe(l(({orders:{open:e}})=>e)),ey=ma(ya,!1),ty=ma(ya,!0),ba=nt.pipe(l(({orders:{open:e,closed:t}})=>[...t,...e])),ry=ha(ba,!1),ny=ha(ba,!0),va=nt.pipe(l(({orders:{closed:e}})=>e.filter(t=>t.execStatus!=="ReplaceToCanceled"))),iy=cy(va),oy=uy(va),sy=F(ey,ry,iy,da,fa).pipe(H((e,t)=>t(e),new Map)),ay=F(ty,ny,oy,da,fa).pipe(H((e,t)=>t(e),new Map));function ni(e,t,r){return["New","Replace","Cancel"].indexOf(e.action)>-1&&["ReplaceRejected","CancelRejected"].indexOf(e.execStatus)<0?J.isBracketOrders(e.ordType)?r:t==="snapshot"?["New","PartiallyFilled"].indexOf(e.ordStatus)>-1:t==="incremental"?["New","PartiallyFilled","Filled","Canceled"].indexOf(e.ordStatus)>-1:!1:!1}function ma(e,t){return e.pipe(l(r=>(t?by(r):r).filter(n=>ni(n,"snapshot",t))),h(r=>r.length>0),l(ly))}function ha(e,t){return e.pipe(l(r=>r.filter(n=>ni(n,"incremental",t))),h(r=>r.length>0),l(py))}function cy(e){return e.pipe(l(t=>t.filter(r=>ni(r,"incremental",!1)&&J.isFinalOrder(r.ordStatus))),h(t=>t.length>0),l(dy),Ot(5e3))}function uy(e){return e.pipe(l(t=>t.filter(r=>J.isBracketOrders(r.ordType)&&J.isFinalOrder(r.ordStatus))),h(t=>t.length>0),l(fy),Ot(5e3))}function ly(e){return function(t){return e.forEach(r=>t.set(r.orderID,r)),t}}function py(e){return function(t){return e.forEach(r=>t.set(r.orderID,r)),t}}function dy(e){return function(t){return e.forEach(r=>t.delete(r.orderID)),t}}function fy(e){return function(t){const r=t.toArray();return e.forEach(n=>{const i=yy(r,n);if(i&&J.isFinalOrder(i.ordStatus)){const{tpOrder:o,slOrder:a}=ga(r,i);!o&&!a&&t.delete(i.orderID),o&&a&&J.isFinalOrder(o.ordStatus)&&J.isFinalOrder(a.ordStatus)&&(t.delete(i.orderID),t.delete(o.orderID),t.delete(a.orderID))}}),t}}function yy(e,t){if(t.ordType==="Bracket")return t;const r=t.clOrdID.slice(0,-3);return e.find(n=>n.orderID===r)}function by(e){const t=e.filter(n=>n.ordType==="Bracket"),r=new Set;return t.forEach(n=>{const{tpOrder:i,slOrder:o}=ga(e,n);if(i||console.log(`BO has no TP: orderID: ${n.orderID}, priceEp: ${n.priceEp}, orderQty: ${n.orderQty}, ordStatus: ${n.ordStatus}`),o||console.log(`BO has no SL: orderID: ${n.orderID}, priceEp: ${n.priceEp}, orderQty: ${n.orderQty}, ordStatus: ${n.ordStatus}`),!i||!o){r.add(n.orderID),i&&r.add(i.orderID),o&&r.add(o.orderID);return}J.isFinalOrder(n.ordStatus)&&i&&J.isFinalOrder(i.ordStatus)&&o&&J.isFinalOrder(o.ordStatus)&&(r.add(n.orderID),r.add(i.orderID),r.add(o.orderID))}),e.filter(n=>!r.has(n.orderID))}function ga(e,t){return{tpOrder:e.find(r=>r.clOrdID===t.orderID+"_TP"),slOrder:e.find(r=>r.clOrdID===t.orderID+"_SL")}}const vy=B([sy,He]).pipe(l(([e,t])=>e.toObject(r=>mr(r,t))),Y({})),my=B([ay,He]).pipe(l(([e,t])=>Sy(e,t).toObject("orderID")),Y({}));B([vy,my]).pipe(l(([e,t])=>Object.values(Object.assign({},e,t))));function hy(e,t,r){return J.isMarketOrder(e.ordType)?"Market":e.priceEp===0?"-":p.floor(e.priceEp,t,r)}function gy(e,t,r,n,i){return e.cumValueEv===0||e.cumQty===0?"-":p.floor(Math.pow(e.cumValueEv/(e.cumQty*r*n),t),i)}function Ey(e,t,r,n){return J.isConditionalOrder(e)?t===0?"-":p.floor(t,r,n):"-"}function mr(e,t,r){const n=t.get(e.symbol),{displaySymbol:i,settleCurrency:o,contractSide:a,contractSize:s,valuePrecision:c,valueFactor:u,pricePrecision:d,priceFactor:f,priceScale:b}=n,{orderID:y,clOrdID:m,ordType:v,ordStatus:E,code:S,symbol:w,side:T,orderQty:P,cumQty:x,leavesQty:O,priceEp:k,stopPxEp:R,takeProfitEp:I,stopLossEp:Q,tpTrigger:D,slTrigger:C,execInst:M,actionTimeNs:A=0,timeInForce:q="",curPosTerm:U,posSide:j,tpPxRp:$,slPxRp:X,slTimeInForce:ee,tpTimeInForce:oe,displayQty:me}=e,ae=sp(a,s,f,c,P,k),pe=Math.floor(A/1e6),Re=J.formatOrderQty(P),_e=hy(e,d,b),Z=r||p.floor(xs(e,v),d,b);return{orderID:y,clOrdID:m,ordType:v,ordStatus:E,code:S,symbol:w,displaySymbol:i,side:T,displayQty:me,orderQty:Number(P),orderQtyByCont:_.toCont(n,P),orderQtyByValue:_.toValue(n,P,Z),orderQtyByCoin:_.toCoin(n,P,Z),orderQtyStr:Re,cumQty:x,cumQtyByCont:_.toCont(n,x),cumQtyByValue:_.toValue(n,x,Z),cumQtyByCoin:_.toCoin(n,x,Z),leavesQty:O,leavesQtyByCont:_.toCont(n,O),leavesQtyByValue:_.toValue(n,O,Z),leavesQtyByCoin:_.toCoin(n,O,Z),priceEp:Number(k),price:_e,stopPxEp:R,stopPx:Ey(v,R,d,b),fillPrice:gy(e,a,u,s,d),value:ae,valueWU:ae+" "+o,takeProfitEp:I,takeProfitPrice:p.floor(I,d,b),stopLossEp:Q,stopLossPrice:p.floor(Q,d,b),tpTrigger:D,slTrigger:C,execInst:M,actionTimestamp:pe,actionTime:Te.formatDateTime(pe),actionMonthDayTime:Te.formatMonthDayTime(pe),timeInForce:q,removable:J.isFinalOrder(E),curPosTerm:U,posSide:j,tpPxRp:$,slPxRp:X,slTimeInForce:ee,tpTimeInForce:oe,icebergOrderQtyByCont:_.toCont(n,me??0),icebergOrderQtyByValue:_.toValue(n,me??0,Z),icebergOrderQtyByCoin:_.toCoin(n,me??0,Z)}}function Sy(e,t){const r=e.toArray();return r.filter(n=>n.ordType==="Bracket").map(n=>{const i=mr(n,t),{tpOrder:o,slOrder:a}=Py(r,i);return o&&a&&(i.tpOrder=mr(o,t,i.price),i.slOrder=mr(a,t,i.price),i.removable=J.isFinalOrder(i.ordStatus)&&J.isFinalOrder(o.ordStatus)&&J.isFinalOrder(a.ordStatus)),i})}function Py(e,t){return{tpOrder:e.find(r=>r.clOrdID===t.orderID+"_TP"),slOrder:e.find(r=>r.clOrdID===t.orderID+"_SL")}}const Ty=fe.pipe(l(()=>e=>(e.clear(),e))),wy=G.pipe(h(e=>e.type==="order-condition-remove"),l(e=>t=>(t.delete(e.orderID),t))),xy=Lr.pipe(l(({orders:{open:e}})=>e)),By=Iy(xy),Oy=nt.pipe(l(({orders:{open:e,closed:t}})=>[...t,...e])),Ry=Dy(Oy),Cy=nt.pipe(l(({orders:{closed:e}})=>e)),Qy=My(Cy),ky=F(By,Ry,Qy,Ty,wy).pipe(H((e,t)=>t(e),new Map));function Iy(e){return e.pipe(l(t=>t.filter(r=>ii(r,"snapshot"))),h(t=>t.length>0),l(Ny))}function Dy(e){return e.pipe(l(t=>t.filter(r=>ii(r,"incremental"))),h(t=>t.length>0),l(_y))}function My(e){return e.pipe(l(t=>t.filter(r=>ii(r,"incremental")&&J.isFinalOrder(r.ordStatus))),h(t=>t.length>0),l(qy),Ot(5e3))}function Ny(e){return function(t){return e.forEach(r=>t.set(r.orderID,r)),t}}function _y(e){return function(t){e.forEach(r=>t.set(r.orderID,r));for(let r of t.values())r.ordStatus==="Rejected"&&t.delete(r.orderID);return t}}function qy(e){return function(t){return e.forEach(r=>t.delete(r.orderID)),t}}function ii(e,t){return!(["New","Replace","Cancel"].indexOf(e.action)>-1&&["ReplaceRejected","CancelRejected"].indexOf(e.execStatus)<0)||J.isBracketOrders(e.ordType)||!J.isConditionalOrder(e.ordType)?!1:t==="snapshot"?["New","PartiallyFilled","Untriggered"].indexOf(e.ordStatus)>-1:t==="incremental"?["New","PartiallyFilled","Untriggered","Filled","Deactivated","Canceled","Rejected"].indexOf(e.ordStatus)>-1:!1}const Ay=B([ky,De]).pipe(l(([e,t])=>e.toArray(r=>Vy(r,t)).filter(Boolean)));function Fy(e,t){if(t==="TrailingTakeProfitPeg"){if(e==="Rising")return"≤";if(e==="Falling")return"≥"}return e==="Rising"?"≥":e==="Falling"?"≤":""}function Uy(e){return e==="ByLastPrice"||e==="ByLastPriceLimit"?"LP":e==="ByMarkPrice"||e==="ByMarkPriceLimit"?"MP":""}function Ly(e,t){return t==="TrailingTakeProfitPeg"&&e==="Untriggered"?"Inactive":e}function jy(e,t,r){return["TrailingTakeProfitPeg","TrailingTakeProfitByProportionPeg"].includes(e)?t-r:0}function Vy(e,t){const r=t.find(oe=>oe.symbol===e.symbol);if(!r)return null;const{displaySymbol:n,pricePrecision:i,priceScale:o}=r,{orderID:a,clOrdID:s,ordType:c,ordStatus:u,symbol:d,side:f,orderQty:b,priceEp:y,trigger:m,stopPxEp:v,actionTimeNs:E,stopDirection:S,timeInForce:w,pegOffsetValueEp:T,pegOffsetProportionEr:P,pegPriceType:x,takeProfitEp:O,stopLossEp:k,tpTrigger:R,slTrigger:I,curPosTerm:Q,posSide:D,actionBy:C,displayQty:M}=e,A=Math.floor(E/1e6),q=jy(x,v,T),U=J.formatOrderQty(b),j=p.floor(y,i,o),$=p.floor(xs(e,c),i,o),X=r.type==="PerpetualV2",ee=p.floor(Math.abs(P),2,X?-2:6)+"%";return{orderID:a,clOrdID:s,ordType:c,ordStatus:Ly(u,x),displaySymbol:n,symbol:d,side:f,orderQty:Number(b),orderQtyByCont:_.toCont(r,b),orderQtyByValue:_.toValue(r,b,$),orderQtyByCoin:_.toCoin(r,b,$),orderQtyStr:U,priceEp:Number(y),price:j,activationPriceEp:q,activationPrice:q?p.floor(q,i,o):"-",stopPxEp:v,stopPx:p.floor(v,i,o),actionTimestamp:A,actionTime:Te.formatDateTime(A),actionMonthDayTime:Te.formatMonthDayTime(A),stopDirection:Fy(S,x),trigger:m,triggerType:Uy(m),timeInForce:w,pegOffsetValueEp:T,pegOffsetValue:p.floor(Math.abs(T),i,o),pegOffsetProportionEr:P,pegOffsetProportion:ee,pegPriceType:x,removable:J.isFinalOrder(u),takeProfitEp:O,takeProfitPrice:p.floor(O,i,o),stopLossEp:k,stopLossPrice:p.floor(k,i,o),tpTrigger:R,slTrigger:I,curPosTerm:Q,posSide:D,actionBy:C,displayQty:M,icebergOrderQtyByCont:_.toCont(r,M??0),icebergOrderQtyByValue:_.toValue(r,M??0,$),icebergOrderQtyByCoin:_.toCoin(r,M??0,$)}}const zy=Lr.pipe(l(({orders:{fills:e}})=>e)),Wy=nt.pipe(l(({orders:{fills:e}})=>e)),$y=fe.pipe(l(()=>e=>(e.clear(),e))),Hy=F(zy,Wy).pipe(l(e=>function(t){return e.forEach(r=>t.set(r.execID,r)),t})),Xy=F(Hy,$y).pipe(H((e,t)=>t(e),new Map)),Ea=B([ne,ye]).pipe(h(([e,t])=>e.has("."+t)),l(([e,t])=>e.get("."+t)));Ea.pipe(l(e=>({type:"fiat-rate",data:{fiatRate:e}}))).subscribe(e=>N.next(e));B([Xy,He,Ar,ne,Ea]).pipe(l(([e,t,r,n,i])=>e.toArray(o=>Yy(o,t,r,n,i)).filter(Boolean)));function Yy(e,t,r,n,i){const{orderID:o,clOrdID:a,ordType:s,ordStatus:c,symbol:u,side:d,orderQty:f,priceEp:b,execID:y,execQty:m,execPriceEp:v,transactTimeNs:E,timeInForce:S,closedPnlEv:w,execFeeEv:T,ptFeeEv:P,currency:x,tradeType:O,posSide:k}=e,R=t.get(u);if(!R)return null;const{displaySymbol:I,pricePrecision:Q,priceScale:D,valuePrecision:C,valueScale:M,baseCurrency:A}=R,q=Math.floor(E/1e6),U=p.floor(b,Q,D),j=p.floor(v,Q,D),$=T?p.floor(T,C,M)+" "+x:"",X=P&&Ce(P,0),ee=X?p.floor(P,r.valuePrecision)+" "+r.displayCurrency:"",oe=X?n.get(".PT"):n.get("."+A),me=oe?oe.priceEp:0,ae=(X?P:T)||0;return{orderID:o,clOrdID:a,ordType:Gy(s,O),ordStatus:c,symbol:u,displaySymbol:I,side:d,orderQty:Number(f),orderQtyByCont:_.toCont(R,f),orderQtyByValue:_.toValue(R,f,U),orderQtyByCoin:_.toCoin(R,f,U),orderQtyStr:p.delimit(f),priceEp:Number(b),price:U,execID:y,execQty:m,execQtyByCont:_.toCont(R,m),execQtyByValue:_.toValue(R,m,j),execQtyByCoin:_.toCoin(R,m,j),execQtyStr:p.delimit(m),execPriceEp:v,execPrice:j,transactTimestamp:q,transactTime:Te.formatDateTime(q),timeInForce:S,closedPnl:w?p.floor(w,C,M)+" "+x:"-",execFee:ee||$||"-",execFeeMoney:Ky(R,i,ae,me),posSide:k}}function Gy(e,t){return e||{AdlTrade:"AdlTrade",LiqTrade:"Liquidation"}[t]||"-"}function Ky(e,t,r,n){if(!t)return"";const{contractSide:i,valueScale:o,isSupportHedge:a}=e,s=a?1e4:1,c=g(r).times(s).div(t.priceEp);return i>0?p.floor(c,8):p.floor(g(c).times(n),8,o)}const Jy=fe.pipe(l(()=>e=>(e.clear(),e))),Zy=Lr.pipe(l(e=>{const{closed:t}=e.orders;return function(r){return t.filter(Sa).forEach(n=>r.set(n.orderID,n)),r}})),eb=nt.pipe(l(e=>{const{closed:t}=e.orders;return function(r){return t.filter(Sa).forEach(n=>r.set(n.orderID,n)),r}})),tb=F(Zy,eb,Jy).pipe(H((e,t)=>t(e),new Map));function Sa(e){return["New","Replace","Cancel","LiqRequest"].includes(e.action)&&!["ReplaceRejected","CancelRejected"].includes(e.execStatus)}B([tb,De]).pipe(l(([e,t])=>e.toArray(r=>ob(r,t)).filter(Boolean).sort((r,n)=>n.transactTimestamp-r.transactTimestamp)));function rb(e,t,r){return J.isMarketOrder(e.ordType)?"Market":e.priceEp===0?"-":p.floor(e.priceEp,t,r)}function nb(e,t,r,n,i){return e.cumValueEv===0||e.cumQty===0?"-":p.floor(Math.pow(e.cumValueEv/(e.cumQty*r*n),t),i)}function ib(e,t,r,n){return J.isConditionalOrder(e)?t===0?"-":p.floor(t,r,n):"-"}function ob(e,t){const r=t.find(j=>j.symbol===e.symbol);if(!r)return null;const{displaySymbol:n,contractSide:i,contractSize:o,pricePrecision:a,valueFactor:s,priceScale:c}=r,{orderID:u,clOrdID:d,ordType:f,ordStatus:b,symbol:y,side:m,priceEp:v,stopPxEp:E,orderQty:S,cumQty:w,leavesQty:T,createBy:P,actionTimeNs:x,transactTimeNs:O,timeInForce:k,action:R,execPriceEp:I,posSide:Q}=e,D=Math.floor(x/1e6),C=Math.floor(O/1e6),M=J.formatOrderQty(S),A=p.floor(I,a,c),q=nb(e,i,s,o,a),U=sb(e,r);return{orderID:u,clOrdID:d,ordType:R==="LiqRequest"?"Liquidation":f,ordStatus:b,displaySymbol:n,symbol:y,side:m,orderQty:S,orderQtyStr:M,orderQtyStrByCont:_.toCont(r,S),orderQtyStrByValue:_.toValue(r,S,U),orderQtyStrByCoin:_.toCoin(r,S,U),cumQty:w,cumQtyByCont:_.toCont(r,w),cumQtyByValue:_.toValue(r,w,U),cumQtyByCoin:_.toCoin(r,w,U),leavesQty:T,leavesQtyByCont:_.toCont(r,T),leavesQtyByValue:_.toValue(r,T,U),leavesQtyByCoin:_.toCoin(r,T,U),leavesQtyStr:p.delimit(T),priceEp:v,price:rb(e,a,c),fillPrice:q,stopPxEp:E,stopPx:ib(f,E,a,c),createBy:P,actionTimestamp:D,actionTime:Te.formatDateTime(D),actionMonthDayTime:Te.formatMonthDayTime(D),transactTimestamp:C,transactTime:Te.formatDateTime(C),transactMonthDayTime:Te.formatMonthDayTime(C),timeInForce:k,execPriceEp:I,execPrice:A,posSide:Q}}function sb(e,t){const{pricePrecision:r,priceScale:n}=t,i=["execPriceEp","priceEp","stopPxEp"];for(let o=0;o<i.length;o++){const a=i[o],s=e[a];if(s)return p.floor(s,r,n)}return""}const Wt=new Oe(!0);G.pipe(h(e=>e.type==="spot-all-symbols"),l(e=>e.data)).subscribe(e=>Wt.next(e));function Pa(e,t){const r=jt.pipe(l(()=>s=>(s.clear(),s))),n=G.pipe(h(s=>s.type==="order-active-remove"),l(s=>c=>(c.delete(s.orderID),c))),i=e.pipe(l(s=>s.open.filter(c=>un(c,"snapshot"))),h(s=>s.length>0),l(s=>function(c){return c.clear(),s.forEach(u=>c.set(u.orderID,u)),c})),o=t.pipe(l(s=>[...s.open,...s.closed].filter(c=>un(c,"incremental")&&c.execStatus!=="ReplaceToCanceled")),h(s=>s.length>0),l(s=>function(c){return s.forEach(u=>c.set(u.orderID,u)),c})),a=t.pipe(l(s=>s.closed.filter(c=>un(c,"incremental")&&c.execStatus!=="ReplaceToCanceled")),h(s=>s.length>0),l(s=>function(c){return s.forEach(u=>c.delete(u.orderID)),c}),Ot(5e3));return F(i,o,a,r,n).pipe(H((s,c)=>c(s),new Map))}function un(e,t){const{execStatus:r,ordStatus:n}=e;return["ReplaceRejected","CancelRejected"].includes(r)?!1:t==="snapshot"?["New","PartiallyFilled"].includes(n):t==="incremental"?["New","PartiallyFilled","Filled","Canceled"].includes(n):!1}const ab=Pa(jr,mt);function Bn(e,t,r,n){const i=e.length;return{orders:(n?e:e.filter(o=>o.symbol===r.symbol)).map(o=>cb(o,t,r.mode)).filter(Boolean).sort((o,a)=>a.createTimestamp-o.createTimestamp),count:i}}function On(e,t,r,n){const i=e.length;return{orders:(n?e:e.filter(o=>o.symbol===r.symbol)).map(o=>pb(o,t,r.mode)).filter(Boolean).sort((o,a)=>a.createTimestamp-o.createTimestamp),count:i}}function Rn(e,t,r,n){return{orders:(n?e:e.filter(i=>i.symbol===r.symbol)).map(i=>lb(i,t,r.mode)).filter(Boolean).sort((i,o)=>o.transactTimestamp-i.transactTimestamp)}}function Cn(e,t,r,n){return{orders:(n?e:e.filter(i=>i.symbol===r.symbol)).map(i=>ub(i,t,r.mode)).filter(Boolean).sort((i,o)=>o.createTimestamp-i.createTimestamp)}}function cb(e,t,r="Spot"){const{orderID:n,symbol:i,side:o,qtyType:a,baseQtyEv:s,quoteQtyEv:c,leavesBaseQtyEv:u,leavesQuoteQtyEv:d,ordType:f,ordStatus:b,priceEp:y,createTimeNs:m}=e,v=t.find(oe=>oe.symbol===i);if(!v)return null;const{displaySymbol:E,pricePrecision:S,baseCurrency:w,displayBaseCurrency:T,quoteCurrency:P,baseQtyPrecision:x,quoteQtyPrecision:O}=v,{baseQtyScale:k,quoteQtyScale:R}=Wr(r,v),I=p.floor(s,x,k),Q=p.floor(u,x,k),D=p.floor(se(s,u),x,k),C=p.floor(c,O,R),M=p.floor(d,O,R),A=p.floor(se(c,d),O,R),q=L.calcQty(a,I,C),U=Number(a==="ByBase"?s:c),j=L.getByQtyType(a,T,P),$=L.calcValue({qtyType:a,priceEp:y,baseQtyEv:s,quoteQtyEv:c,baseQtyScale:k,quoteQtyScale:R,quoteQtyPrecision:O,baseQtyPrecision:x}),X=L.getByQtyType(a,T,P,!0),ee=$r(m);return{orderID:n,symbol:i,displaySymbol:E,side:o,qtyType:a,qty:q,qtyEv:U,qtyWU:L.joinWU(q,j),qtyCurrency:j,supportMarginTrade:v.supportMarginTrade,priceEp:y,price:p.floor(y,S,R),value:$,valueWU:L.joinWU($,X),valueCurrency:X,filledQty:L.calcQty(a,D,A),remainingQtyWU:L.calcQtyWU(a,Q,w,M,P),remainingQty:L.calcQty(a,Q,M),ordType:f,ordStatus:b,createTimestamp:ee,createTime:Te.formatDateTime(ee),removable:L.isFinalOrder(b)}}function ub(e,t,r="Spot"){const{orderID:n,symbol:i,side:o,qtyType:a,baseQtyEv:s,quoteQtyEv:c,ordType:u,ordStatus:d,priceEp:f,avgPriceEp:b,stopPxEp:y,createTimeNs:m}=e,v=t.find(q=>q.symbol===i);if(!v)return null;const{displaySymbol:E,pricePrecision:S,displayBaseCurrency:w,quoteCurrency:T,baseQtyPrecision:P,quoteQtyPrecision:x}=v,{baseQtyScale:O,quoteQtyScale:k}=Wr(r,v),R=L.isLiqTradeOrder(e),I=L.isMarketOrder(e),Q=p.floor(s,P,O),D=p.floor(c,x,k),C=$r(m),M=L.calcQty(a,Q,D),A=L.getByQtyType(a,w,T);return{orderID:n,symbol:i,displaySymbol:E,side:o,amount:M,supportMarginTrade:v.supportMarginTrade,amountWU:L.joinWU(M,A),amountCurrency:A,price:zt(I||R,f,S,k),fillPrice:bb(b,S,k),value:I||R?"-":L.calcValueWU({qtyType:a,priceEp:f,baseQtyEv:s,quoteQtyEv:c,baseQtyScale:O,quoteQtyScale:k,baseQtyPrecision:P,quoteQtyPrecision:x,displayBaseCurrency:w,quoteCurrency:T}),stopPx:vb(y,u,S,k),ordType:u,ordStatus:d,createTimestamp:C,createTime:Te.formatDateTime(C)}}function lb(e,t,r="Spot"){const{orderID:n,execID:i,symbol:o,side:a,qtyType:s,baseQtyEv:c,quoteQtyEv:u,execBaseQtyEv:d,execQuoteQtyEv:f,ordType:b,priceEp:y,execPriceEp:m,transactTimeNs:v}=e,E=t.find(U=>U.symbol===o);if(!E)return null;const{displaySymbol:S,pricePrecision:w,displayBaseCurrency:T,quoteCurrency:P,baseQtyPrecision:x,quoteQtyPrecision:O}=E,{baseQtyScale:k,quoteQtyScale:R}=Wr(r,E),I=L.isLiqTradeOrder(e),Q=L.isMarketOrder(e),D=p.floor(c,x,k),C=p.floor(d,x,k),M=p.floor(u,O,R),A=p.floor(f,O,R),q=$r(v);return{orderID:n,execID:i,symbol:o,displaySymbol:S,side:a,supportMarginTrade:E.supportMarginTrade,qty:L.calcQtyWU(s,D,T,M,P),getQty:fb(a,C,T,A,P),spendQty:yb(a,C,T,A,P),price:zt(Q||I,y,w,R),execPrice:p.floor(m,w,R),ordType:b,transactTimestamp:q,transactTime:Te.formatDateTime(q),execBaseQtyEv:d,execQuoteQtyEv:f}}function pb(e,t,r="Spot"){const{orderID:n,symbol:i,side:o,qtyType:a,baseQtyEv:s,quoteQtyEv:c,leavesBaseQtyEv:u,leavesQuoteQtyEv:d,ordType:f,ordStatus:b,priceEp:y,stopPxEp:m,createTimeNs:v,stopDirection:E}=e,S=t.find(Re=>Re.symbol===i);if(!S)return null;const{displaySymbol:w,pricePrecision:T,baseCurrency:P,displayBaseCurrency:x,quoteCurrency:O,baseQtyPrecision:k,quoteQtyPrecision:R}=S,{baseQtyScale:I,quoteQtyScale:Q}=Wr(r,S),D=L.isLiqTradeOrder(e),C=L.isMarketOrder(e),M=$r(v),A=p.floor(s,k,I),q=p.floor(u,k,I),U=p.floor(se(s,u),k,I),j=p.floor(c,R,Q),$=p.floor(d,R,Q),X=p.floor(se(c,d),R,Q),ee=L.calcQty(a,A,j),oe=Number(a==="ByBase"?s:c),me=L.getByQtyType(a,x,O),ae=L.calcValue({qtyType:a,priceEp:y,baseQtyEv:s,quoteQtyEv:c,baseQtyScale:I,quoteQtyScale:Q,quoteQtyPrecision:R,baseQtyPrecision:k}),pe=L.getByQtyType(a,x,O,!0);return{orderID:n,symbol:i,displaySymbol:w,side:o,isMarket:C,qtyType:a,qty:ee,qtyWU:L.joinWU(ee,me),qtyCurrency:me,supportMarginTrade:S.supportMarginTrade,price:zt(C||D,y,T,Q),priceEp:Number(y),qtyEv:oe,value:C||D?"-":ae,valueWU:C||D?"-":L.joinWU(ae,pe),valueCurrency:pe,filledQty:L.calcQty(a,U,X),remainingQtyWU:L.calcQtyWU(a,q,P,$,O),remainingQty:L.calcQty(a,q,$),stopDirection:db(E),stopPxEp:m,stopPx:p.floor(m,T,Q),ordType:f,ordStatus:b,createTimestamp:M,createTime:Te.formatDateTime(M),createMDTime:Te.formatMonthDayTime(M)}}function db(e){return e==="Rising"?"≥":e==="Falling"?"≤":""}function fb(e,t,r,n,i){return e==="Buy"?p.delimit(t)+" "+r:e==="Sell"?p.delimit(n)+" "+i:""}function yb(e,t,r,n,i){return e==="Buy"?p.delimit(n)+" "+i:e==="Sell"?p.delimit(t)+" "+r:""}function bb(e,t,r){return zu(e,0)?"-":p.floor(e,t,r)}function vb(e,t,r,n){return["Stop","StopLimit","LimitIfTouched","MarketIfTouched"].indexOf(t)<0?"-":p.floor(e,r,n)}function Wr(e,{baseQtyScale:t,quoteQtyScale:r}){return e==="Margin"?{baseQtyScale:0,quoteQtyScale:0}:{baseQtyScale:t,quoteQtyScale:r}}function $r(e){return Math.floor((e||0)/1e6)}const mb=ab.pipe(l(e=>e.toArray()));B([mb,Ue,Xe,Wt]).pipe(h(([,,e])=>e.mode==="Spot"),l(([e,t,r,n])=>Bn(e,t,r,n)));function Ta(e,t){const r=jt.pipe(l(()=>s=>(s.clear(),s))),n=G.pipe(h(s=>s.type==="order-conditional-remove"),l(s=>c=>(c.delete(s.orderID),c))),i=e.pipe(l(s=>s.open.filter(c=>ln(c,"snapshot"))),l(s=>function(c){return c.clear(),s.forEach(u=>c.set(u.orderID,u)),c})),o=t.pipe(l(s=>[...s.open,...s.closed].filter(c=>ln(c,"incremental"))),h(s=>s.length>0),l(s=>function(c){return s.forEach(u=>c.set(u.orderID,u)),c})),a=t.pipe(l(s=>s.closed.filter(c=>ln(c,"incremental"))),h(s=>s.length>0),l(s=>function(c){return s.forEach(u=>c.delete(u.orderID)),c}),Ot(5e3));return F(i,o,n,r,a).pipe(H((s,c)=>c(s),new Map))}function ln(e,t){if(!L.isConditionalOrder(e))return!1;const{execStatus:r,ordStatus:n}=e;return["ReplaceRejected","CancelRejected"].includes(r)?!1:t==="snapshot"?["New","PartiallyFilled","Untriggered"].includes(n):t==="incremental"?["New","PartiallyFilled","Untriggered","Filled","Deactivated","Canceled","Rejected"].includes(n):!1}const hb=Ta(jr,mt),gb=hb.pipe(l(e=>e.toArray()));B([gb,Ue,Xe,Wt]).pipe(h(([,,e])=>e.mode==="Spot"),l(([e,t,r,n])=>On(e,t,r,n)));function wa(e,t){const r=jt.pipe(l(()=>o=>(o.clear(),o))),n=e.pipe(l(o=>o.fills),l(o=>function(a){return a.clear(),o.forEach(s=>a.set(s.execID,s)),a})),i=t.pipe(l(o=>o.fills),h(o=>o.length>0),l(o=>function(a){return o.forEach(s=>a.set(s.execID,s)),a}));return F(n,i,r).pipe(H((o,a)=>a(o),new Map))}const Eb=wa(jr,mt),Sb=Eb.pipe(l(e=>e.toArray()));B([Sb,Ue,Xe,Wt]).pipe(h(([,,e])=>e.mode==="Spot"),l(([e,t,r,n])=>Rn(e,t,r,n)));function xa(e,t){const r=jt.pipe(l(()=>o=>(o.clear(),o))),n=e.pipe(l(o=>{const{open:a,closed:s}=o;return function(c){return c.clear(),a.forEach(u=>c.set(u.orderID,u)),s.forEach(u=>c.set(u.orderID,u)),c}})),i=t.pipe(l(o=>{const{open:a,closed:s}=o;return function(c){return a.forEach(u=>c.set(u.orderID,u)),s.forEach(u=>c.set(u.orderID,u)),c}}));return F(n,i,r).pipe(H((o,a)=>a(o),new Map))}const Pb=xa(jr,mt),Tb=Pb.pipe(l(e=>e.toArray()));B([Tb,Ue,Xe,Wt]).pipe(h(([,,e])=>e.mode==="Spot"),l(([e,t,r,n])=>Cn(e,t,r,n)));function wb(){ti.pipe(l(e=>({type:"positions",data:{positions:e}}))).subscribe(e=>N.next(e)),xd.pipe(l(e=>[].concat(...e.toArray())),l(e=>({type:"positions-copy-trade",data:{positions:e}}))).subscribe(e=>N.next(e)),As.pipe(l(e=>[].concat(...e.toArray())),l(e=>({type:"contract-margin-level",data:{marginLevels:e}}))).subscribe(e=>N.next(e))}const et=_r.pipe(l(e=>e.spot===2),Ie()),oi=new Oe({status:0}),xb=oi.pipe(l(e=>e.status===1),Ie());G.pipe(h(e=>e.type==="init-user-data")).subscribe(e=>{e.data&&(e.data.uta&&_r.next(e.data.uta),e.data.lendingAccount&&oi.next(e.data.lendingAccount))});es.pipe(h(e=>e.bizType==="ACCOUNT"&&e.bizChangeType==="ACCOUNT_UPGRADE"||e.bizType===null&&e.bizChangeType===null),l(e=>e.content.uta)).subscribe(e=>{e&&_r.next(e)});es.pipe(h(e=>e.bizType==="ACCOUNT"&&e.bizChangeType==="LENDING_ACCOUNT_OPEN"||e.bizType===null&&e.bizChangeType===null),l(e=>e.content.lendingAccount)).subscribe(e=>{e&&oi.next(e)});const Bb=$e.pipe(l(e=>t=>(e.forEach(r=>t.has(r.currency)?t:t.set(r.currency,kb(r))),t))),Ob=fe.pipe(l(()=>e=>(e.clear(),e))),Rb=Gn.pipe(l(e=>e.wallets)),Cb=B([Rb,$e]).pipe(l(([e,t])=>{const r=t.map(n=>n.currency);return n=>(e.filter(i=>r.includes(i.currency)).forEach(i=>n.set(i.currency,i)),n)})),Qb=F(Bb,Cb,Ob).pipe(H((e,t)=>t(e),new Map));function kb({currency:e,displayCurrency:t}){return{balanceEv:0,currency:e,displayCurrency:t,lastUpdateTimeNs:Date.now(),lockedTradingBalanceEv:0,lockedWithdrawEv:0,userID:0}}B([et,Pe]).pipe(h(([e])=>!e)).subscribe(()=>{z.next({method:"mao.subscribe",params:[]}),et.pipe(Ie(),h(Boolean)).subscribe(()=>{z.next({method:"maos.unsubscribe",params:[]})})});const Ib=B({isUtaSpot:et,wsMsg:re}).pipe(h(({isUtaSpot:e,wsMsg:t})=>!e&&!!t.wallets_mao&&!!t.orders_mao),l(({wsMsg:e})=>Db(e)),we(Ne),h(([e,t])=>Tr(e)===t),l(([e])=>e));function Db(e){var{orders_mao:t,wallets_mao:r,riskLevelRr:n}=e,i=Me(e,["orders_mao","wallets_mao","riskLevelRr"]);const{closed:o=[],open:a=[],fills:s=[]}=t,c=n;return Object.assign(Object.assign({},i),{riskLevelEr:c,wallets:Mb(r,c),orders:{closed:pn(o),open:pn(a),fills:pn(s)}})}function Mb(e,t){return e.map(r=>({balanceEv:r.balanceRq||"0",fundEv:r.fundRq||"0",currency:r.currency,lastUpdateTimeNs:r.lastUpdateTimeNs,lockedTradingBalanceEv:r.lockedTradingBalanceRq||"0",lockedWithdrawEv:r.lockedWithdrawRq||"0",borrowedEv:r.borrowedRq||"0",cumInterestEv:r.cumInterestRq||"0",hourlyInterestRateEr:r.hourlyInterestRateRr,maxAmountToBorrowEv:r.maxAmountToBorrowRq||"0",riskLevelEr:t,userID:r.userID}))}function pn(e){return e.map(t=>{const{avgPriceRp:r,averageRp:n,baseQtyRq:i,cumBaseQtyRq:o,cumFeeRv:a,cumQuoteQtyRq:s,curBaseWalletQtyRq:c,curQuoteWalletQtyRq:u,execBaseQtyRq:d,execFeeRv:f,execPriceRp:b,execQuoteQtyRq:y,leavesBaseQtyRq:m,leavesQuoteQtyRq:v,pegOffsetValueRv:E,priceRp:S,quoteQtyRq:w,stopPxRp:T,borrowQtyRq:P,paybackPrincipalQtyRq:x,paybackInterestQtyRq:O,hourlyInterestRateRr:k,riskLevelRr:R,liqFeeRv:I,liqFeeRateRr:Q}=t,D=Me(t,["avgPriceRp","averageRp","baseQtyRq","cumBaseQtyRq","cumFeeRv","cumQuoteQtyRq","curBaseWalletQtyRq","curQuoteWalletQtyRq","execBaseQtyRq","execFeeRv","execPriceRp","execQuoteQtyRq","leavesBaseQtyRq","leavesQuoteQtyRq","pegOffsetValueRv","priceRp","quoteQtyRq","stopPxRp","borrowQtyRq","paybackPrincipalQtyRq","paybackInterestQtyRq","hourlyInterestRateRr","riskLevelRr","liqFeeRv","liqFeeRateRr"]);return Object.assign(Object.assign({},D),{avgPriceEp:r||"0",averageEp:n||"0",baseQtyEv:i||"0",cumBaseQtyEv:o||"0",cumFeeEv:a||"0",cumQuoteQtyEv:s||"0",curBaseWalletQtyEv:c||"0",curQuoteWalletQtyEv:u||"0",execBaseQtyEv:d||"0",execFeeEv:f||"0",execPriceEp:b||"0",execQuoteQtyEv:y||"0",leavesBaseQtyEv:m||"0",leavesQuoteQtyEv:v||"0",pegOffsetValueEv:E||"0",priceEp:S||"0",quoteQtyEv:w||"0",stopPxEp:T||"0",borrowQtyEq:P||"0",paybackPrincipalQtyEq:x||"0",paybackInterestQtyEq:O||"0",hourlyInterestRateEr:k||"0",riskLevelEr:R||"0",liqFeeEv:I||"0",liqFeeRateEr:Q||"0"})})}const Nb={1:"SPOT",2:"SPOT_MARGIN_TRADE",3:"UTA_SPOT",4:"UTA_MARGIN"};Pe.subscribe(()=>z.next({method:"uta.mao.subscribe",params:[]}));const Ba=re.pipe(h(e=>!!e.wallets_mao&&!!e.orders_mao),l(e=>qb(e))),_b=B({isUtaSpot:et,wsMsg:Ba}).pipe(h(({isUtaSpot:e})=>e),l(({wsMsg:e})=>e),we(Ne),h(([e,t])=>Tr(e)===t),l(([e])=>e));function qb(e){var{orders_mao:t,wallets_mao:r,riskLevelRr:n}=e,i=Me(e,["orders_mao","wallets_mao","riskLevelRr"]);const{closed:o=[],open:a=[],fills:s=[]}=t,c=n;return Object.assign(Object.assign({},i),{riskLevelEr:c,wallets:Ab(r,c),orders:{closed:dn(o),open:dn(a),fills:dn(s)}})}function Ab(e,t){return e.map(r=>({balanceEv:r.balanceRq||"0",fundEv:r.fundRq||"0",currency:r.currency,lastUpdateTimeNs:r.lastUpdateTimeNs,lockedTradingBalanceEv:r.lockedTradingBalanceRq||"0",lockedWithdrawEv:r.lockedWithdrawRq||"0",borrowedEv:r.borrowedRq||"0",cumInterestEv:r.cumInterestRq||"0",hourlyInterestRateEr:r.hourlyInterestRateRr,maxAmountToBorrowEv:r.maxAmountToBorrowRq||"0",riskLevelEr:t,userID:r.userID}))}function dn(e){return e.map(t=>{const{avgPriceRp:r,averageRp:n,baseQtyRq:i,cumBaseQtyRq:o,cumFeeRv:a,cumQuoteQtyRq:s,curBaseWalletQtyRq:c,curQuoteWalletQtyRq:u,execBaseQtyRq:d,execFeeRv:f,execPriceRp:b,execQuoteQtyRq:y,leavesBaseQtyRq:m,leavesQuoteQtyRq:v,pegOffsetValueRv:E,priceRp:S,quoteQtyRq:w,stopPxRp:T,borrowQtyRq:P,paybackPrincipalQtyRq:x,paybackInterestQtyRq:O,hourlyInterestRateRr:k,riskLevelRr:R,liqFeeRv:I,liqFeeRateRr:Q,business:D}=t,C=Me(t,["avgPriceRp","averageRp","baseQtyRq","cumBaseQtyRq","cumFeeRv","cumQuoteQtyRq","curBaseWalletQtyRq","curQuoteWalletQtyRq","execBaseQtyRq","execFeeRv","execPriceRp","execQuoteQtyRq","leavesBaseQtyRq","leavesQuoteQtyRq","pegOffsetValueRv","priceRp","quoteQtyRq","stopPxRp","borrowQtyRq","paybackPrincipalQtyRq","paybackInterestQtyRq","hourlyInterestRateRr","riskLevelRr","liqFeeRv","liqFeeRateRr","business"]);return Object.assign(Object.assign({},C),{business:Nb[D],avgPriceEp:r||"0",averageEp:n||"0",baseQtyEv:i||"0",cumBaseQtyEv:o||"0",cumFeeEv:a||"0",cumQuoteQtyEv:s||"0",curBaseWalletQtyEv:c||"0",curQuoteWalletQtyEv:u||"0",execBaseQtyEv:d||"0",execFeeEv:f||"0",execPriceEp:b||"0",execQuoteQtyEv:y||"0",leavesBaseQtyEv:m||"0",leavesQuoteQtyEv:v||"0",pegOffsetValueEv:E||"0",priceEp:S||"0",quoteQtyEv:w||"0",stopPxEp:T||"0",borrowQtyEq:P||"0",paybackPrincipalQtyEq:x||"0",paybackInterestQtyEq:O||"0",hourlyInterestRateEr:k||"0",riskLevelEr:R||"0",liqFeeEv:I||"0",liqFeeRateEr:Q||"0"})})}const Hr=F(Ib,_b);B([Pe,il]).pipe(h(([e,t])=>t.length>0)).subscribe(([e,t])=>t.map(r=>z.next({method:"uta.mao.subscribe",params:[0,r]})));const Fb=Ba.pipe(we(Ne),h(([e,t])=>Tr(e)!==t),l(([e])=>({userId:Tr(e),data:e}))),xt={getBalanceEv(e,t,r=1e8,n=1e4,i=1e8,o=0){if(e===0)return 0;const a=g(i).times(n).div(r);return Number(Ee(g(e).div(t).times(a)))},getBalanceRv(e,t,r=1e8,n=1e4,i=8,o=0){if(e===0)return g(0).toFixed(i,o);const a=g(n).div(r);return g(e).div(t).times(a).round(i,o).toFixed(i)},getValueEv(e,t,r=1e8,n=1e4,i=1e8,o=!0){if(e===0)return 0;const a=g(i).div(n).div(r);return o?Number(Ee(g(e).times(t).times(a))):Ee(g(e).times(t).times(a))},getValueRv(e,t,r=1e8,n=1e4,i=8,o=0){if(e===0)return g(0).toFixed(i,o);const a=g(n).times(r);return g(e).times(t).div(a).round(i,o).toFixed(i)}},$t=!1;function ve(e,t,r,n,i=$t,o=!1,a=0){if(!t.has(".BTC")||!r.get("BTC")||!r.get("USD")||!t.get(".USDT"))return null;const s=Xi(e,t,r,n,i,!1,a);if(!o)return s;const{btcEv:c,btc:u,usdEv:d,usd:f,usdtEv:b,usdt:y,money:m}=Xi(e,t,r,n,i,!0,a);return Object.assign(Object.assign({},s),{bonusBtcEv:c,bonusBtc:u,bonusUsdEv:d,bonusUsd:f,bonusUsdtEv:b,bonusUsdt:y,bonusMoney:m})}function Xi(e,t,r,n,i=$t,o=!1,a=0){if(!t.has(".BTC"))return null;const s=r.get("BTC"),c=r.get("USD"),[u,d]=Yi(s),[f,b]=Yi(c),{priceEp:y}=t.get(".BTC"),m=t.get(".USDT"),v=e.filter(C=>C.currency==="BTC"),E=e.filter(C=>C.currency==="USD"),S=e.filter(C=>["BTC","USD"].indexOf(C.currency)<0),w=v.map(C=>o?C.bonusBalanceEv:C.valueEv),T=E.map(C=>o?C.bonusBalanceEv:C.valueEv),P=Sr(...w),x=Sr(...T),O=S.reduce((C,M)=>W(C,jb(M,t,r,b,i,o)),"0"),k=Ub(P,x,O,y,d,b,i),R=Lb(P,x,O,y,d,b,i),I=t.get("."+n),Q=Oa(I,R),D=g(R).times(m.priceFactor).div(m.priceEp).toNumber();return{btcEv:k,btc:pr(k,u,d,a),usdEv:R,usd:pr(R,f,b,a),usdtEv:D,usdt:pr(D,f,b,a),money:pr(Q,c.valuePrecision,c.valueScale,a)}}function Ub(e,t,r,n,i,o,a=$t){return Math.floor(Number(g(t).plus(r).times(ut(a?Be:g(i).plus(Be).minus(o))).div(n).plus(e).times(ut(a?i:0)).valueOf()))}function Lb(e,t,r,n,i,o,a=$t){return Math.floor(Number(g(e).times(n).times(ut(a?-Be:g(o).minus(Be).minus(i))).plus(t).plus(r).times(ut(a?o:0)).valueOf()))}function jb(e,t,r,n,i=$t,o=!1){const{currency:a}=e,s=r.get(a);if(!s)return 0;const c=t.get("."+a);if(!c)return 0;const u=i?-Be:se(n,W(Be,s.valueScale));return g(o?e.bonusBalanceEv:e.valueEv).times(c.priceEp).times(ut(u)).valueOf()}function Yi(e){return[e.valuePrecision,e.valueScale,e.valueFactor]}function pr(e,t,r,n=0){const i=n===3?p.ceil:p.floor;return p.delimit(i(e,t,r))}function Oa(e,t){return e?Number(g(t).times(e.priceFactor).div(e.priceEp)):0}function Vb([e,t,r,...n]){const i=e.get("BTC");if(!i)return null;const o=e.get("USD");if(!o)return null;const a=(n||[]).filter(Boolean),s=Gi(t,r,o,i,a),{btcEv:c,btc:u,usdEv:d,usd:f,usdtEv:b,usdt:y,money:m}=Gi(t,r,o,i,a,!0);return Object.assign(Object.assign({},s),{bonusBtcEv:c,bonusBtc:u,bonusUsdEv:d,bonusUsd:f,bonusUsdtEv:b,bonusUsdt:y,bonusMoney:m})}function Gi(e,t,r,n,i,o=!1){const{valueScale:a,valueFactor:s}=r,c=2,u=2,d=Number(Qe(Sr(...i.map(S=>o?S.bonusBtcEv||0:S.btcEv)),0,0)),f=Number(Qe(Sr(...i.map(S=>o?S.bonusUsdEv||0:S.usdEv)),0,0)),b=t.get("."+e),y=Oa(b,f),m=p.delimit(p.floor(y,u,a)),v=t.get(".USDT"),E=xt.getBalanceEv(f,v.priceEp,s,v.priceFactor,s);return{btcEv:d,btc:p.floor(d,n.valuePrecision,n.valueScale),usdEv:f,usd:p.delimit(p.floor(f,c,a)),money:m,usdtEv:E,usdt:p.delimit(p.floor(E,c,a))}}const Ra=Fb.pipe(H((e,t)=>{const r=t.data.wallets.map(n=>Object.assign(Object.assign({},n),{valueEv:Number(n.balanceEv)-Number(n.borrowedEv)-Number(n.cumInterestEv)}));return e.set(t.userId,r),e},new Map),Y(new Map)),zb=B([Ra,ne,le,ye]).pipe(ge(100),l(([e,t,r,n])=>{const i=[].concat(...e.toArray());return ve(i,t,r,n,!0)}),h(Boolean)),si=Ra.pipe(l(e=>{const t=[].concat(...e.toArray());return Wb(t)}),Y(new Map));function Wb(e){return e.reduce((t,r)=>{const n=r.currency,i=parseFloat(r.balanceEv);return t.set(n,(t.get(n)||0)+i),t},new Map)}const Ca=new V(1),ai=new V(1),Qa=new V(1);B([Ca,Mr]).pipe(l(([e,t])=>{const r=e.filter(({currency:i})=>t.includes(i)),n=e.filter(({currency:i})=>!t.includes(i));return[r,n]})).subscribe(([e,t])=>{ai.next({wallets:e}),Qa.next({wallets:t})});B([et,Qb,le,zr,si]).pipe(h(([e])=>!e),l($b)).subscribe(e=>Ca.next(e));function $b([e,t,r,n,i]){return e?[]:t.toArray(o=>Hb(o,r,n,i)).filter(Boolean).sort((o,a)=>Ce(a.totalBalanceValue,o.totalBalanceValue)?1:-1)}function Hb({lastUpdateTimeNs:e,currency:t,balanceEv:r,lockedTradingBalanceEv:n,lockedWithdrawEv:i},o,a,s){const c=o.get(t);if(!c)return null;const{valueScale:u,valuePrecision:d=8,valueFactor:f,name:b,displayCurrency:y,depositOpen:m,withdrawOpen:v,status:E}=c,S=s.has(t)?s.get(t):0,w=Number(be(S,f)),T=p.delimit(p.floor(w,d,u)),P=Number(W(r,w)),x=Number(W(W(n,i),w)),O=Number(se(P,x)),k=it(O,d,u),R=it(O,2,u),I=it(O,4,u),[Q]=a(y,O),[D]=a(y,x),[C,M]=a(y,P);return{time:Math.floor(e/1e6),currency:t,displayCurrency:y,name:b,totalBalanceEv:P,totalBalance:it(P,d,u),totalBalanceMoneyWU:C,totalBalanceValue:M,availableBalanceEv:O,availableBalance:k,availableBalanceWU:k+" "+t,availableBalance2:R,availableBalance2WU:R+" "+t,availableBalance4:I,availableBalance4WU:I+" "+t,availableBalanceMoneyWU:Q,freezeBalanceEv:x,freezeBalance:it(x,d,u),freezeBalanceMoneyWU:D,lockedTradingBalanceEv:n,lockedTradingBalance:it(n,d,u),lockedWithdrawEv:i,lockedWithdraw:it(i,d,u),depositOpen:m,withdrawOpen:v,status:E,tradingBotEv:w,tradingBotsStr:T}}function it(e,t,r){return p.delimit(p.floor(e,t,r))}const ka=Gn.pipe(h(e=>!!e.users));ka.subscribe(e=>{const{sequence:t,timestamp:r,type:n,users:i,version:o}=e;Ir("wo_users_debug",{sequence:t,timestamp:r,type:n,content:i,version:o})});const Xb=B([ka,Ar]).pipe(l(([e,t])=>!!e.users.find(r=>r.discountWithCcy===t.code)));function Yb(){ai.pipe(l(e=>({type:"spot-wallets",data:e}))).subscribe(e=>N.next(e)),Qa.pipe(l(e=>({type:"spot-invalid-wallets",data:e}))).subscribe(e=>N.next(e)),Xb.pipe(l(e=>({type:"spot-pt-discount-state",data:{state:e}}))).subscribe(e=>N.next(e))}function Gb(){at.subscribe(()=>{z.next({method:"tick.subscribe",params:[".BTC"]}),z.next({method:"tick.subscribe",params:[".USDT"]}),z.next({method:"tick.subscribe",params:[".TRY"]}),z.next({method:"tick.subscribe",params:[".BRZ"]}),z.next({method:"markprice.subscribe",params:[]})}),B([at,ye]).pipe(l(e=>e[1]),h(e=>e!=="USD"),Ie()).subscribe(e=>z.next({method:"tick.subscribe",params:["."+e]}))}const Ia=B([et,$e,zn]).pipe(l(([e,t,r])=>{const n=r.reduce((i,o)=>(i.set(o.currency,o),i),new Map);return e?t.reduce((i,o)=>(n.has(o.currency)||i.set(o.currency,rv(o)),i),n):n})),ci=Ia.pipe(l(e=>e.toArray())),Kb=ci.pipe(l(e=>t=>(e.forEach(r=>t.get(r.currency)?t:t.set(r.currency,tv(r.currency))),t))),Jb=fe.pipe(l(()=>e=>(e.clear(),e))),Zb=Hr.pipe(l(e=>e.wallets)),ev=B([Zb,ci]).pipe(l(([e,t])=>{const r=t.map(n=>n.currency);return n=>(e.filter(i=>r.includes(i.currency)).forEach(i=>n.set(i.currency,i)),n)})),ui=F(Kb,ev,Jb).pipe(H((e,t)=>t(e),new Map));function tv(e){return{balanceEv:"0",fundEv:"0",currency:e,lastUpdateTimeNs:0,lockedTradingBalanceEv:"0",lockedWithdrawEv:"0",borrowedEv:"0",cumInterestEv:"0",hourlyInterestRateEr:"0",maxAmountToBorrowEv:"0",riskLevelEr:"999",userID:0}}function rv(e){return{currency:e.currency,name:e.name,displayCurrency:e.displayCurrency,valuePrecision:e.valuePrecision,pricePrecision:e.pricePrecision,status:e.status,valueFactor:1,valueScale:0,code:e.code,leverage:0,markDelete:!0,coefficient:"0",defaultHourlyInterestRate:"0",defaultMaxAmountToBorrowPerAccount:"0",minAmountToBorrowPerAccount:"0",maxAmountToBorrow:"0",liqFeeRate:"0",adlTargetRiskLevel:"0",priceCoefficientInAdl:"1",canRepay:!1,canBorrow:!1,canTransferOut:!0,canTransferIn:!0,canTrade:!0}}const nv=999,iv="999",ov=Hr.pipe(h(e=>e.hasOwnProperty("riskLevelEr")&&Ce(e.riskLevelEr,0)),l(e=>e.riskLevelEr)),Da=B([ov,ui]).pipe(l(([e,t])=>t.toArray().find(r=>Ce(r.borrowedEv,0)||Ce(r.cumInterestEv,0))?{riskLevelEr:e,riskLevel:Ce(e,nv)?iv:p.floor(e,2)}:{riskLevelEr:"999",riskLevel:"--"})),li=new V(1),Ma=new V(1),sv=6,av=4,cv=2;B([et,ui,Da,Ia,Vo,ne,zr,vt,si]).pipe(ge(100),l(uv),l(pv)).subscribe(({accounts:e,overview:t})=>{li.next({accounts:e}),Ma.next(t)});function uv([e,t,r,n,i,o,a,s,c]){return[t.toArray(u=>lv(u,r,n,o,a,s,e?c:new Map)).filter(Boolean).sort((u,d)=>Ce(d.totalBalanceValue,u.totalBalanceValue)?1:-1),i]}function lv({lastUpdateTimeNs:e,currency:t,balanceEv:r,lockedTradingBalanceEv:n,borrowedEv:i,cumInterestEv:o,hourlyInterestRateEr:a,maxAmountToBorrowEv:s},c,u,d,f,b,y){const m=u.get(t),v=b.get("USD"),E=b.get("BTC"),S=d.get("."+t),w=d.get(".USDT"),T=d.get(".BTC");if(!m||!S||S.priceEp===0||!E||!v||!w||!T)return null;const{valuePrecision:P,pricePrecision:x,valueScale:O,name:k,displayCurrency:R,maxAmountToBorrow:I,canBorrow:Q,leverage:D,coefficient:C}=m,M=Ce(s,0)?s:I,A=y.has(t)?y.get(t):0,q=p.delimit(p.floor(A,P,O)),U=W(n,A),j=U,$=W(r,A),X=se($,U),ee=je(X,P),oe=je(X,2),me=je(X,4),[ae]=f(R,X,!0),[pe]=f(R,j,!0),[Re,_e]=f(R,$,!0),Z=W(i,o),[Yt,Ye]=f(R,Z,!0),Le=se($,Z),[Gt,Kt]=f(R,Le,!0),ht=be(a,24),It=be(ht,365),gt=Ze(S.priceEp,ut(Be)),Dt=Ce(Le,0),Jt=Q?Ee(g(Le).times(se(D,1)).times(Dt?C:1).minus(Z).times(gt)):"0",Zt=Q?Ee(g(Le).times(Dt?C:1).minus(Z).times(gt)):"0",er=Q?se(M,Z):"0",{valueFactor:tr,valuePrecision:Gr}=v,{valuePrecision:rr}=E,Mt=bv($,t,d),nr=g(Mt).times(tr).div(w.priceEp),Kr=g(Mt).times(tr).div(T.priceEp);return Object.assign(Object.assign({time:Math.floor(e/1e6),currency:t,displayCurrency:R,name:k,totalBalanceEv:$,totalBalance:je($,P),totalBalanceMoneyWU:Re,totalBalanceValue:_e,availableBalanceEv:X,availableBalance:ee,availableBalanceWU:ee+" "+t,availableBalance2:oe,availableBalance2WU:oe+" "+t,availableBalance4:me,availableBalance4WU:me+" "+t,availableBalanceMoneyWU:ae,freezeBalanceEv:j,freezeBalance:je(j,P),freezeBalanceMoneyWU:pe,lockedTradingBalanceEv:U,lockedTradingBalance:je(U,P),borrowedEv:i,borrowed:fn(i,P),cumInterestEv:o,cumInterest:fn(o,P),totalDebtEv:Z,totalDebt:fn(Z,P),totalDebtValue:Ye,totalDebtMoneyWU:Yt,netEquityEv:Le,netEquity:je(Le,P),netEquityValue:Kt,netEquityMoneyWU:Gt,maxAmountToBorrowEv:M,maxAmountToBorrow:je(M,P),remainingMaxAmountToBorrowEv:er,remainingMaxAmountToBorrow:je(er,P),hourlyInterestRateEr:a,hourlyInterestRate:Qe(be(a,100),sv,3)+"%",dailyInterestRateEr:ht,dailyInterestRate:Qe(be(ht,100),av,3)+"%",annualInterestRateEr:It,annualInterestRate:Qe(be(It,100),cv,3)+"%",indexPriceEp:gt,remainingBorrowValueEv:Jt,remainingBorrow2XValueEv:Zt,valuePrecision:P,pricePrecision:x,canBorrow:Q},c),{totalBalanceUsdt:p.delimit(p.floor(nr,Gr)),totalBalanceBtc:p.delimit(p.floor(Kr,rr)),tradingBot:A,tradingBotStr:q})}function je(e,t){return p.delimit(Qe(e,t,0))}function fn(e,t){return p.delimit(Qe(e,t,3))}function pv([e,t]){if(e.length<1)return{overview:{netEquityEv:"0",totalEquityEv:"0",totalDebtEv:"0",maxTransferOutValueEv:"0",totalAvailableEv:"0",totalMarginEv:"0",totalFreezeEv:"0"},accounts:[]};const{totalEquityEv:r,totalDebtEv:n,totalEquityCanBorrowEv:i,totalDebtCanBorrowEv:o,netEquityEv:a,remainingBorrowTotalValueEv:s,remainingBorrow2XTotalValueEv:c,totalAvailableEv:u,totalMarginEv:d,totalFreezeEv:f}=e.reduce(({totalEquityEv:E,totalEquityCanBorrowEv:S,totalDebtEv:w,totalDebtCanBorrowEv:T,netEquityEv:P,remainingBorrowTotalValueEv:x,remainingBorrow2XTotalValueEv:O,totalAvailableEv:k,totalMarginEv:R,totalFreezeEv:I},Q)=>{const D=be(Q.totalBalanceEv,Q.indexPriceEp),C=be(Q.totalDebtEv,Q.indexPriceEp);return{totalEquityEv:W(E,D),totalEquityCanBorrowEv:Q.canBorrow?W(S,D):S,totalDebtEv:W(w,C),totalDebtCanBorrowEv:Q.canBorrow?W(T,C):T,netEquityEv:W(P,be(Q.netEquityEv,Q.indexPriceEp)),remainingBorrowTotalValueEv:W(x,Q.remainingBorrowValueEv),remainingBorrow2XTotalValueEv:W(O,Q.remainingBorrow2XValueEv),totalAvailableEv:W(k,be(Q.availableBalanceEv,Q.indexPriceEp)),totalMarginEv:Q.canBorrow?W(R,D):R,totalFreezeEv:W(I,be(Q.freezeBalanceEv,Q.indexPriceEp))}},{totalEquityEv:"0",totalEquityCanBorrowEv:"0",totalDebtEv:"0",totalDebtCanBorrowEv:"0",netEquityEv:"0",remainingBorrowTotalValueEv:"0",remainingBorrow2XTotalValueEv:"0",totalAvailableEv:"0",totalMarginEv:"0",totalFreezeEv:"0"}),b=e[0].riskLevelEr,y=yv(i,o,b,t),m=Pr(s,0),v=Pr(c,0);return{overview:{netEquityEv:a,totalEquityEv:r,totalDebtEv:n,maxTransferOutValueEv:y,totalAvailableEv:u,totalMarginEv:d,totalFreezeEv:f},accounts:e.map(E=>{const S=Ki(E.canBorrow,m,E,t),w=Ki(E.canBorrow,v,E,t),T=dv(E.canBorrow,i,o,E,t),P=fv(E.canBorrow,y,E);return delete E.remainingBorrowValueEv,delete E.remainingBorrow2XValueEv,delete E.valuePrecision,delete E.pricePrecision,delete E.canBorrow,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},E),T),S),P),{remainingBorrow2XEv:w.remainingBorrowEv,remainingBorrow2X:w.remainingBorrow})})}}function Ki(e,t,r,n){if(!e||st(r.riskLevelEr,n.canBorrowAbove))return{remainingBorrowEv:"0",remainingBorrow:p.floor(0,r.valuePrecision)};const i=Lo(Ze(t,r.indexPriceEp),r.remainingMaxAmountToBorrowEv);return{remainingBorrowEv:i,remainingBorrow:p.delimit(p.floor(i,r.valuePrecision))}}function dv(e,t,r,n,i){const o={liquidationPriceEp:"0",liquidationPrice:"-"};if(!e||Ce(n.riskLevelEr,10)||st(n.totalBalanceEv,0)&&st(n.totalDebtEv,0))return o;const a=se(t,be(r,i.canTradeAbove)),s=se(be(n.totalDebtEv,i.canTradeAbove),n.totalBalanceEv),c=Ee(g(a).div(s).plus(n.indexPriceEp));return st(c,0)?o:{liquidationPriceEp:c,liquidationPrice:p.delimit(Qe(c,n.valuePrecision))}}function fv(e,t,r){if(!e){const i=se(r.netEquityEv,r.freezeBalanceEv);return{maxTransferOutAmountEv:i,maxTransferOutAmount:p.delimit(p.floor(i,r.valuePrecision))}}if(st(r.availableBalanceEv,0)||st(t,0))return Ji(r.valuePrecision);const n=Lo(Ze(t,r.indexPriceEp),r.availableBalanceEv);return Ce(n,0)?{maxTransferOutAmountEv:n,maxTransferOutAmount:p.delimit(p.floor(n,r.valuePrecision))}:Ji(r.valuePrecision)}function yv(e,t,r,n){return st(r,n.canTransferOutAbove)?"0":Pr(0,se(e,be(t,n.canTransferOutAbove)))}function Ji(e=8){return{maxTransferOutAmountEv:"0",maxTransferOutAmount:0 .toFixed(e)}}function bv(e,t,r){const n=r.get("."+t);if(!n)return 0;const i=1,o=1;return xt.getValueEv(e,n.priceEp,i,n.priceFactor,o)}const Na=new V(1),_a=new V(1),pi=new V(1),qa=new V(1),Aa=new V(1),Fa=new V(1);B([et,ui,ci,ne,zr,vt]).pipe(h(([e])=>e),l(vv),we(Mr)).subscribe(([[e,t],r])=>{Na.next(e),_a.next(t),Ua(r,e,t)});Mr.pipe(we(Na,_a)).subscribe(([e,t,r])=>{Ua(e,t,r)});function Ua(e,t,r){pi.next({accounts:t.filter(({currency:n})=>e.includes(n))}),Aa.next({accounts:t.filter(({currency:n})=>!e.includes(n))}),qa.next({accounts:r.filter(({currency:n})=>e.includes(n))}),Fa.next({accounts:r.filter(({currency:n})=>!e.includes(n))})}function vv([e,t,r,n,i,o]){if(!e)return[[],[]];const a=t.toArray(s=>mv(s,r,n,i,o)).filter(Boolean).sort((s,c)=>Ce(c.totalBalanceValue,s.totalBalanceValue)?1:-1);return hv(a,i)}function mv({lastUpdateTimeNs:e,fundEv:t,currency:r,lockedWithdrawEv:n},i,o,a,s){const c=i.find(D=>D.currency===r),u=s.get("USD"),d=s.get("BTC"),f=o.get("."+r),b=o.get(".USDT"),y=o.get(".BTC");if(!c||!f||!d||!u||!b||!y)return null;const{valuePrecision:m,code:v,name:E,displayCurrency:S}=c,{valueScale:w}=s.get(r),[T,P]=a(S,t,!0),{valueFactor:x,valuePrecision:O}=u,{valuePrecision:k}=d,R=gv(t,r,o),I=Ze(be(R,x),b.priceEp),Q=Ze(be(R,x),y.priceEp);return{time:Math.floor(e/1e6),currency:r,currencyCode:v,displayCurrency:S,name:E,fundEv:t,lockedWithdrawEv:n,totalBalanceMoneyWU:T,totalBalanceValue:P,valuePrecision:m,valueScale:w,totalBalanceUsdt:p.delimit(p.floor(I,O)),totalBalanceBtc:p.delimit(p.floor(Q,k))}}function hv(e,t){const r=[],n=[];return e.forEach(i=>{const{time:o,currency:a,currencyCode:s,displayCurrency:c,name:u,fundEv:d,lockedWithdrawEv:f,totalBalanceMoneyWU:b,totalBalanceValue:y,valuePrecision:m,valueScale:v,totalBalanceUsdt:E,totalBalanceBtc:S}=i,w=f,T=se(d,w),P=St(T,m),x=St(T,2),O=St(T,4),[k]=t(c,T,!0),R={time:o,currency:a,currencyCode:s,displayCurrency:c,name:u,totalBalance:St(d,m),totalBalanceMoneyWU:b,totalBalanceValue:y,availableBalance:P,availableBalanceWU:P+" "+a,availableBalance2:x,availableBalance2WU:x+" "+a,availableBalance4:O,availableBalance4WU:O+" "+a,availableBalanceMoneyWU:k,lockedWithdraw:St(f,m),freezeBalance:St(w,m),totalBalanceUsdt:E,totalBalanceBtc:S};n.push(Object.assign(Object.assign({},R),{totalBalanceEv:dr(d,v),availableBalanceEv:dr(T,v),lockedWithdrawEv:dr(f,v),freezeBalanceEv:dr(w,v)})),r.push(Object.assign(Object.assign({},R),{totalBalanceEv:d,availableBalanceEv:T,lockedWithdrawEv:f,freezeBalanceEv:w}))}),[r,n]}function St(e,t){return p.delimit(p.floor(e,t,0))}function dr(e,t){return p.floor(e,0,-t)}function gv(e,t,r){const n=r.get("."+t);if(!n)return 0;const i=1,o=1;return xt.getValueEv(e,n.priceEp,i,n.priceFactor,o)}function Ev(){li.pipe(l(e=>({type:"margin-trade-accounts",data:e}))).subscribe(e=>N.next(e)),Hr.pipe(l(()=>!0),Ke(1)).subscribe(e=>N.next({type:"update-margin-account-status",data:{isActivateMarginAccount:e}}))}function Sv(){pi.pipe(l(e=>({type:"fund-accounts",data:e}))).subscribe(e=>N.next(e)),qa.pipe(l(e=>({type:"fund-scale-accounts",data:e}))).subscribe(e=>N.next(e)),Aa.pipe(l(e=>({type:"fund-invalid-accounts",data:e}))).subscribe(e=>N.next(e)),Fa.pipe(l(e=>({type:"fund-invalid-scale-accounts",data:e}))).subscribe(e=>N.next(e))}const Pv=li.pipe(l(({accounts:e})=>e.map(t=>({currency:t.currency,valueEv:t.netEquityEv}))),Y([])),Tv=B([Pv,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n,!0)),h(Boolean)),wv=ne.pipe(h(e=>e.has(".BTC")),l(e=>e.get(".BTC")),l(e=>e.priceEp),Ie()),xv=le.pipe(l(e=>e.get("BTC")),h(Boolean)),Bv=le.pipe(l(e=>e.get("USD")),h(Boolean)),Ov=B([Ma,Da,wv,xv,Bv]).pipe(l(([e,t,r,n,i])=>{const{totalEquityEv:o,totalDebtEv:a,netEquityEv:s,maxTransferOutValueEv:c,totalAvailableEv:u,totalMarginEv:d,totalFreezeEv:f}=e,b=yn(o,r,n),y=yn(a,r,n),m=yn(s,r,n);return Object.assign(Object.assign({},t),{totalEquityEv:o,totalEquityUsd:p.delimit(p.floor(o,i.valuePrecision)),totalEquityBtc:p.delimit(b),totalDebtEv:a,totalDebtUsd:p.delimit(Qe(a,i.valuePrecision,3)),totalDebtBtc:p.delimit(y),netEquityEv:s,netEquityUsd:p.delimit(p.floor(s,i.valuePrecision)),netEquityBtc:p.delimit(m),maxTransferOutValueEv:c,totalAvailableEv:u,totalAvailableUsd:p.delimit(p.floor(u,i.valuePrecision)),totalMarginEv:d,totalMarginUsd:p.delimit(p.floor(d,i.valuePrecision)),totalFreezeEv:f,totalFreezeUsd:p.delimit(p.floor(f,i.valuePrecision))})}));function yn(e,t,{valuePrecision:r}){return p.floor(Ze(e,t),r,-Be)}const Rv=pi.pipe(l(({accounts:e})=>e.map(t=>({currency:t.currency,valueEv:t.totalBalanceEv}))),Y([])),Cv=B([Rv,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n,!0)),h(Boolean));function Qv(){Tv.pipe(l(e=>({type:"margin-assets",data:{assets:e}}))).subscribe(e=>N.next(e)),Ov.pipe(l(e=>({type:"margin-assets-overview",data:e}))).subscribe(e=>N.next(e)),Cv.pipe(l(e=>({type:"fund-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}const{orders$:T0,snapshotOrders$:Xr,incrementalOrders$:Ht}=bs(Hr),kv=Ht.pipe(l(({open:e,closed:t})=>[].concat(e,t)),dt()),[Iv,Dv]=Qo(kv,e=>L.isConditionalOrder(e)),Mv=B([Iv,Nr]).pipe(l(([e,t])=>ua(e,t,!0)),h(Boolean)),Nv=B([Dv,Nr]).pipe(l(([e,t])=>la(e,t,!0)),h(Boolean)),_v=F(Mv,Nv).pipe(h(e=>!!e));function qv(){_v.subscribe(e=>N.next({type:"notification-spot-order",data:e}))}const Xt=new Oe(!0);G.pipe(h(e=>e.type==="margin-all-symbols"),l(e=>e.data)).subscribe(e=>Xt.next(e));function Yr(e){const t=[],r=[];return e.forEach(n=>{n.hasOwnProperty("business")&&n.business==="UTA_SPOT"?t.push(n):r.push(n)}),{spotOrders:t,marginOrders:r}}const Av=Pa(Xr,Ht),Fv=Av.pipe(l(e=>e.toArray())),La=new V(1),ja=new V(1);B([Fv,qr,Xe,Xt]).pipe(l(([e,t,r,n])=>{const{spotOrders:i,marginOrders:o}=Yr(e),a=t.map(s=>Object.assign(Object.assign({},s),{quoteQtyScale:0,baseQtyScale:0}));return{spotOrders:Bn(i,a,r,n),marginOrders:Bn(o,a,r,n)}})).subscribe(({spotOrders:e,marginOrders:t})=>{ja.next(e),La.next(t)});function Uv(){La.pipe(l(e=>({type:"margin-orders-active",data:e}))).subscribe(e=>N.next(e)),ja.pipe(l(e=>({type:"uta-spot-orders-active",data:e}))).subscribe(e=>N.next(e))}const Lv=Ta(Xr,Ht),jv=Lv.pipe(l(e=>e.toArray())),Va=new V(1),za=new V(1);B([jv,qr,Xe,Xt]).pipe(l(([e,t,r,n])=>{const{spotOrders:i,marginOrders:o}=Yr(e);return{spotOrders:On(i,t,r,n),marginOrders:On(o,t,r,n)}})).subscribe(({spotOrders:e,marginOrders:t})=>{Va.next(e),za.next(t)});function Vv(){za.pipe(l(e=>({type:"margin-orders-conditional",data:e}))).subscribe(e=>N.next(e)),Va.pipe(l(e=>({type:"uta-spot-orders-conditional",data:e}))).subscribe(e=>N.next(e))}const zv=wa(Xr,Ht),Wv=zv.pipe(l(e=>e.toArray())),Wa=new V(1),$a=new V(1);B([Wv,qr,Xe,Xt]).pipe(l(([e,t,r,n])=>{const{spotOrders:i,marginOrders:o}=Yr(e);return{spotOrders:Rn(i,t,r,n),marginOrders:Rn(o,t,r,n)}})).subscribe(({spotOrders:e,marginOrders:t})=>{Wa.next(e),$a.next(t)});function $v(){$a.pipe(l(e=>({type:"margin-orders-fill",data:e}))).subscribe(e=>N.next(e)),Wa.pipe(l(e=>({type:"uta-spot-orders-fill",data:e}))).subscribe(e=>N.next(e))}const Hv=xa(Xr,Ht),Xv=Hv.pipe(l(e=>e.toArray())),Ha=new V(1),Xa=new V(1);B([Xv,qr,Xe,Xt]).pipe(l(([e,t,r,n])=>{const{spotOrders:i,marginOrders:o}=Yr(e);return{spotOrders:Cn(i,t,r,n),marginOrders:Cn(o,t,r,n)}})).subscribe(({spotOrders:e,marginOrders:t})=>{Ha.next(e),Xa.next(t)});function Yv(){Xa.pipe(l(e=>({type:"margin-orders-history",data:e}))).subscribe(e=>N.next(e)),Ha.pipe(l(e=>({type:"uta-spot-orders-history",data:e}))).subscribe(e=>N.next(e))}function Gv(){Ev(),Sv(),Qv(),qv(),Uv(),Vv(),$v(),Yv()}function di(e){return["TrailingStopPeg","TrailingTakeProfitPeg","TrailingStopByProportionPeg","TrailingTakeProfitByProportionPeg"].includes(e)}function Kv(e){return e.ordStatus==="Untriggered"&&["LimitIfTouched","MarketIfTouched"].includes(e.ordType)&&!di(e.pegPriceType)}function Jv(e){return e.ordStatus==="Untriggered"&&["Stop","StopLimit"].includes(e.ordType)&&!di(e.pegPriceType)}function Zv(e){return["Stop","StopLimit","StopAsLimit"].indexOf(e.ordType)>-1}function em(e){return Zv(e)&&di(e.pegPriceType)&&["Inactive","Untriggered"].includes(e.ordStatus)}function Ya(e,t){return t==="Entire"?e.orderQty===0:t==="Partial"?e.orderQty!==0:!0}function fi(e,t){const r=e.curPosTerm===t.term&&e.actionBy==="FromPosition",n=e.symbol===t.symbol,i=t.type==="PerpetualV2"?e.posSide===t.posSide:!0;return n&&r&&i}function yi(e,t){return t.actionTimestamp-e.actionTimestamp}function bn(e,t,r="All"){return e.filter(n=>fi(n,t)&&Kv(n)&&Ya(n,r)).sort(yi)}function vn(e,t,r="All"){return e.filter(n=>fi(n,t)&&Jv(n)&&Ya(n,r)).sort(yi)}function tm(e,t){return e.filter(r=>fi(r,t)&&em(r)).sort(yi)}const rm=Ay.pipe(l(e=>e.reduce((t,r)=>{const{symbol:n}=r;return t.has(n)?t.get(n).push(r):t.set(n,[r]),t},new Map)));B([ti,rm]).pipe(l(([e,t])=>e.filter(r=>r.size>0).reduce((r,n)=>{const[i,o]=nm(n,t.get(n.symbol)||[]);return r.set(i,o)},new Map)));function nm(e,t){return[e.symbol+e.posSide,{tp:{Entire:bn(t,e,"Entire"),Partial:bn(t,e,"Partial"),All:bn(t,e,"All")},sl:{Entire:vn(t,e,"Entire"),Partial:vn(t,e,"Partial"),All:vn(t,e,"All")},ts:{All:tm(t,e)}}]}const im=ai.pipe(l(({wallets:e})=>e.map(t=>({currency:t.currency,valueEv:t.totalBalanceEv}))),Y([])),om=B([im,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n)),h(Boolean));function sm(){om.pipe(l(e=>({type:"wallet-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}const am=B([js,Ar]).pipe(l(([e,t])=>e.map(r=>{let n=["USDT","MUSDT"].indexOf(r.currency)>-1?1e8:1;return r.currency===t.symbol&&(n=t.valueFactor),{currency:r.currency,valueEv:r.equityEv*n,bonusBalanceEv:r.bonusBalanceEv*n}})),Y([])),Ga=B([am,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n,!1,!0)),h(Boolean)),Ka=Xs.pipe(l(e=>[...e.keys()].reduce((t,r)=>t.set(r,(e.get(r)||[]).map(n=>{const i=["USDT","MUSDT"].indexOf(n.currency)>-1?1e8:1;return{currency:n.currency,valueEv:n.equityEv*i,bonusBalanceEv:n.bonusBalanceEv*i}})),new Map)),ie(1)),cm=B([Ka,ne,le,ye]).pipe(Ln(500),l(([e,t,r,n])=>{const i=[].concat(...e.toArray());return ve(i,t,r,n,!1,!0)})),um=Ja(Ko),lm=Ja(Yn),pm=B([le,ye,ne,Ga,cm]).pipe(Ln(500),l(Vb),h(Boolean));function Ja(e){return B([dm(e),ne,le,ye]).pipe(Ln(500),l(([t,r,n,i])=>{const o=[].concat(...t.toArray());return ve(o,r,n,i,!1,!0)}))}function dm(e){return e.pipe(Je(t=>Ka.pipe(l(r=>t.reduce((n,i)=>n.set(i,r.get(i)||[]),new Map)))))}function fm(){Ga.pipe(l(e=>({type:"account-assets",data:{assets:e}}))).subscribe(e=>N.next(e)),pm.pipe(l(e=>({type:"account-assets-all",data:{assets:e}}))).subscribe(e=>N.next(e)),um.pipe(l(e=>({type:"account-assets-bot-trade",data:{assets:e}}))).subscribe(e=>N.next(e)),lm.pipe(l(e=>({type:"account-assets-copy-trade",data:{assets:e}}))).subscribe(e=>N.next(e))}Pe.subscribe(()=>z.next({method:"service.subscribe",params:["service.unitrade"]}));fe.subscribe(()=>z.next({method:"service.unsubscribe",params:["service.unitrade"]}));const Za=re.pipe(h(e=>e.msgType==="unitrade.fiat.balance"));Za.pipe(h(e=>e.pushType==="snapshot")).subscribe(e=>{e.payload.forEach(t=>{t.currency!=="USD"&&z.next({method:"tick.subscribe",params:["."+t.currency]})})});const ym=Za.pipe(l(e=>e.payload),Y([])),bm=ym.pipe(l(e=>t=>(e.forEach(r=>t.set(r.currency,r)),t))),vm=fe.pipe(l(()=>e=>(e.clear(),e))),mm=F(bm,vm).pipe(H((e,t)=>t(e),new Map)),hm=8,mn=2,ec=B([mm,le,ne,ye]).pipe(l(gm),h(Boolean));function gm([e,t,r,n]){const i=t.get("BTC");if(!i)return null;const o=t.get("USD"),a=e.toArray();if(!o)return a;const{valueScale:s,valueFactor:c}=i,{valueScale:u,valueFactor:d}=o,f=r.get(".BTC");if(!f)return null;const b=r.get(".USDT");return b?a.map(({currency:y,balanceEv:m})=>{const v=r.get("."+y),E=r.get("."+n),S=Em(m,v),w=xt.getBalanceEv(S,f.priceEp,d,f.priceFactor,c),T=xt.getBalanceEv(S,b.priceEp,d,b.priceFactor,d),P=p.floor(S,mn,u);return{currency:y,balanceEv:m,usdBalance:P,usd:P,money:Zi(S,E,mn,u),btc:p.floor(w,hm,s),usdt:Zi(T,b,mn,u)}}):null}function Em(e,t){return t?e*t.priceEp/100:0}function Zi(e,t,r,n){if(t){const{priceEp:i,priceScale:o=4}=t;return p.delimit(p.floor(e/i,r,n-o))}return 0 .toFixed(r)}const Sm=B([ec,ne,vt,ye]).pipe(l(Pm),h(Boolean));function Pm([e,t,r,n]){const i=r.get("BTC"),o=r.get("USD"),a=t.get(".BTC"),s=t.get(".USDT");if(!i||!o||!a||!s)return null;const[c,u,d]=eo(i),[f,b,y]=eo(o),m=e.reduce((T,P)=>T+wm(P,t),0),v=Tm(m,a.priceEp,y,1e4,d),E=t.get("."+n),S=xm(E,m),w=g(m).times(s.priceFactor).div(s.priceEp).toNumber();return{btcEv:v,btc:fr(v,c,u),usdEv:m,usd:fr(m,f,b),money:fr(S,f,b),usdtEv:w,usdt:fr(w,f,b)}}function eo(e){return[e.valuePrecision,e.valueScale,e.valueFactor]}function Tm(e,t,r=1e8,n=1e4,i=1e8){if(e===0)return 0;const o=g(i).times(n).div(r);return Number(g(e).div(t).times(o))}function wm(e,t){const{balanceEv:r,currency:n}=e,i=t.get("."+n);return i?r*i.priceEp/100:0}function xm(e,t){return e?Number(g(t).times(e.priceFactor).div(e.priceEp)):0}function fr(e,t,r){return p.delimit(p.floor(e,t,r))}function Bm(){Sm.pipe(l(e=>({type:"fiat-account-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}function Om(){ec.pipe(l(e=>({type:"fiat-accounts",data:{accounts:e}}))).subscribe(e=>N.next(e))}Pe.subscribe(()=>z.next({method:"wm.subscribe",params:[]}));fe.subscribe(()=>z.next({method:"wm.unsubscribe",params:[]}));const Rm=re.pipe(h(e=>!!e.investments)),Cm=fe.pipe(l(()=>e=>(e.clear(),e))),Qm=Rm.pipe(l(e=>e.investments)),km=B([Qm,$e]).pipe(l(([e,t])=>e.filter(r=>t.some(n=>n.currency===r.currency)))),Im=km.pipe(l(e=>function(t){return e.forEach(r=>t.set(r.currency,r)),t})),Dm=F(Im,Cm).pipe(H((e,t)=>t(e),new Map)),tc=Dm.pipe(l(e=>e.toArray())),Mm=tc.pipe(l(e=>e.map(t=>({currency:t.currency,valueEv:t.balanceEv}))),Y([])),Nm=B([Mm,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n)),h(Boolean));function _m(){Nm.pipe(l(e=>({type:"investment-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}Pe.subscribe(()=>z.next({method:"service.subscribe",params:["service.launchpool"]}));fe.subscribe(()=>z.next({method:"service.unsubscribe",params:["service.launchpool"]}));const qm=re.pipe(h(e=>e.msgType==="launch.pool.assets")),Am=qm.pipe(l(e=>e.payload)),Fm=B([Am,vt]).pipe(l(([e,t])=>{const r=e.map(n=>{const i=t.get(n.investCurrency);if(!i)return n;const{name:o,valueScale:a,valuePrecision:s}=i;return Object.assign(Object.assign({},n),{name:o,investAmount:p.floor(n.investAmountEv,s,a)})});return function(n){return r.forEach(i=>{n.set(i.poolId,i)}),n}})),Um=fe.pipe(l(()=>e=>(e.clear(),e))),Lm=F(Fm,Um).pipe(H((e,t)=>t(e),new Map)),rc=Lm.pipe(l(e=>e.toArray()));function jm(){rc.pipe(l(e=>({type:"launch-pool",data:{accounts:e}}))).subscribe(e=>N.next(e))}Pe.subscribe(()=>z.next({method:"service.subscribe",params:["service.predict"]}));fe.subscribe(()=>z.next({method:"service.unsubscribe",params:["service.predict"]}));const Vm=re.pipe(h(e=>e.msgType==="predict.project.assets")),zm=Vm.pipe(l(e=>e.payload)),Wm=B([zm,vt]).pipe(l(([e,t])=>{const r=e.map(n=>{const i=t.get(n.currencyName);if(!i)return Object.assign(Object.assign({},n),{name:"--",balance:"--"});const{name:o,valueScale:a,valuePrecision:s}=i;return Object.assign(Object.assign({},n),{name:o,balance:p.floor(n.balanceEv,s,a)})});return function(n){return r.forEach(i=>{n.set(i.currencyName,i)}),n}})),$m=fe.pipe(l(()=>e=>(e.clear(),e))),Hm=F(Wm,$m).pipe(H((e,t)=>t(e),new Map)),nc=Hm.pipe(l(e=>e.toArray()));function Xm(){nc.pipe(l(e=>({type:"predict",data:{accounts:e}}))).subscribe(e=>N.next(e))}function Ym(){tc.pipe(l(e=>({type:"investment",data:{accounts:e}}))).subscribe(e=>N.next(e))}function Gm(){ne.pipe(l(e=>({type:"index-price",data:{prices:e}}))).subscribe(e=>N.next(e))}const Km=nc.pipe(l(e=>e.map(t=>({currency:t.currencyName,valueEv:t.balanceEv}))),Y([])),Jm=B([Km,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n)),h(Boolean));function Zm(){Jm.pipe(l(e=>({type:"predict-project-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}const e0=rc.pipe(l(e=>e.map(t=>({currency:t.investCurrency,valueEv:t.investAmountEv}))),Y([])),t0=B([e0,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n)),h(Boolean));function r0(){t0.pipe(l(e=>({type:"launch-pool-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}function n0(){zb.pipe(l(e=>({type:"spot-trading-bots-total-assets",data:{assets:e}}))).subscribe(e=>N.next(e))}function i0(){_r.pipe(l(e=>({type:"uta-state",data:e}))).subscribe(e=>N.next(e)),xb.subscribe(e=>N.next({type:"update-lending-account-status",data:{isActivateLendingAccount:e}}))}const to=["service.phemex_auction"];class o0{constructor(){this.isOpen=!1,this.isConnect=!1,Pe.subscribe(()=>this._subscribe(!0)),fe.subscribe(()=>this._unsubscribe())}destroy(){this._unsubscribe()}subscribe(){this.isOpen=!0,Hn.getValue()&&this._subscribe()}unsubscribe(){this.isOpen=!1,this._subscribe()}_subscribe(t=!1){!t&&this.isConnect||!this.isOpen||(this.isConnect=!0,z.next({method:"service.subscribe",params:to}))}_unsubscribe(){this.isConnect&&(this.isConnect=!1,z.next({method:"service.unsubscribe",params:to}))}}const s0=re.pipe(h(e=>e.msgType==="auction.project.pool.info"),l(e=>e.payload[0]),ie(1)),ro=new o0,a0=G.pipe(h(e=>e.type==="auction-subscribe")),c0=G.pipe(h(e=>e.type==="auction-unsubscribe"));function u0(){a0.subscribe(()=>ro.subscribe()),c0.subscribe(()=>ro.unsubscribe()),s0.pipe(l(e=>({type:"auction-project-pool-info",data:e}))).subscribe(e=>N.next(e))}Pe.subscribe(()=>z.next({method:"service.subscribe",params:["service.contract-biz"]}));re.pipe(h(e=>e.msgType==="service.contract-biz"&&e.payload.length>0),l(e=>e.payload),ie(1));const l0=$e.pipe(l(e=>e.reduce((t,r)=>t.set(r.code,r),new Map)),ie(1)),p0=fe.pipe(l(()=>e=>(e.clear(),e))),d0=G.pipe(h(e=>e.type==="lending-account-asset"),l(e=>e.data.map(t=>Object.assign(Object.assign({},t),{currencyCode:t.currency,currency:""}))),Y([])),f0=B([d0,l0]).pipe(l(([e,t])=>r=>(e.filter(n=>t.has(n.currencyCode)).forEach(n=>{const i=t.get(n.currencyCode);r.set(i.symbol,Object.assign(Object.assign({},n),{currency:i.symbol}))}),r))),y0=F(f0,p0).pipe(H((e,t)=>t(e),new Map)),bi=B([y0,ne,zr,vt,si]).pipe(ge(100),l(b0));function b0([e,t,r,n]){return e.toArray(i=>v0(i,t,r,n)).filter(Boolean).sort((i,o)=>Ce(o.totalBalanceValue,i.totalBalanceValue)?1:-1)}function v0({currency:e,currencyCode:t,collateralAmountRq:r,loanAmountRq:n,interestAmountRq:i,balanceRq:o,lockedWithdrawRq:a,supplyAmountRq:s,supplyTotalInterestRq:c,autoInvest:u},d,f,b){const y=b.get(e);if(!y||!y.inAssetsDisplay)return null;const m=b.get("USD"),v=b.get("BTC"),E=d.get("."+e),S=d.get(".USDT"),w=d.get(".BTC");if(!E||!v||!m||!S||!w)return null;const{valuePrecision:T,name:P,displayCurrency:x}=y,O=se(o,a),k=qe(O,T),R=qe(O,2),I=qe(O,4),[Q]=f(x,O,!0),D=Ze(E.priceEp,ut(Be)),{valueFactor:C,valuePrecision:M}=m,{valuePrecision:A}=v,q=W(W(o,r),s),[U,j]=f(x,q,!0),$=no(q,E),X=g($).times(C).div(S.priceEp),ee=g($).times(C).div(w.priceEp),oe=W(n,i),[me,ae]=f(x,oe,!0),pe=se(q,oe),[Re,_e]=f(x,pe,!0),Z=no(s,E);return{currency:e,currencyCode:t,displayCurrency:x,name:P,totalBalanceEv:q,totalBalance:qe(q,T),totalBalanceMoneyWU:U,totalBalanceValue:j,availableBalanceEv:O,availableBalance:k,availableBalanceWU:k+" "+e,availableBalance2:R,availableBalance2WU:R+" "+e,availableBalance4:I,availableBalance4WU:I+" "+e,availableBalanceMoneyWU:Q,collateralBalanceEv:r,collateralBalance:qe(r,T),lockedWithdrawEv:a,lockedWithdraw:qe(a,T),borrowedEv:n,borrowed:hn(n,T),cumInterestEv:i,cumInterest:hn(i,T),totalDebtEv:oe,totalDebt:hn(oe,T),totalDebtValue:ae,totalDebtMoneyWU:me,netEquityEv:pe,netEquity:qe(pe,T),netEquityValue:_e,netEquityMoneyWU:Re,indexPriceEp:D,totalBalanceUsdt:p.delimit(p.floor(X,M)),totalBalanceBtc:p.delimit(p.floor(ee,A)),supplyAmountEv:s,supplyAmount:qe(s,T),supplyAmountUsdEv:Z,supplyAmountUsd:qe(Z,T),supplyTotalInterestEv:c,supplyTotalInterest:qe(c,T),autoInvest:u}}function no(e,t){if(!t)return"0";const r=1,n=1;return xt.getValueEv(e,t.priceEp,r,t.priceFactor,n,!1)}function qe(e,t){return p.delimit(Qe(e,t,0))}function hn(e,t){return p.delimit(Qe(e,t,3))}function m0(){bi.pipe(l(e=>({type:"lending-accounts",data:{accounts:e}}))).subscribe(e=>N.next(e))}const h0=bi.pipe(l(e=>e.map(t=>({currency:t.currency,valueEv:t.netEquityEv}))),Y([]));B([h0,ne,le,ye]).pipe(l(([e,t,r,n])=>ve(e,t,r,n,!0)),h(Boolean));const g0=B([bi,ne,le,ye]).pipe(ge(100),l(([e,t,r,n])=>{const i=e.map(y=>({currency:y.currency,valueEv:y.netEquityEv})),o=e.map(y=>({currency:y.currency,valueEv:y.totalBalanceEv})),a=e.map(y=>({currency:y.currency,valueEv:y.totalDebtEv})),s=e.map(y=>({currency:y.currency,valueEv:y.availableBalanceEv})),c=e.map(y=>({currency:y.currency,valueEv:y.collateralBalanceEv})),u=e.map(y=>({currency:y.currency,valueEv:y.lockedWithdrawEv})),d=e.map(y=>({currency:y.currency,valueEv:y.supplyTotalInterestEv})),f=e.map(y=>({currency:y.currency,valueEv:y.supplyAmountEv})),b={btcEv:0,btc:"--",usdEv:0,usd:"--",money:"--",usdtEv:0,usdt:"--"};return{netEquity:ve(i,t,r,n,!0)||b,totalEquity:ve(o,t,r,n,!0)||b,totalDebt:ve(a,t,r,n,!0,!1,3)||b,totalAvailable:ve(s,t,r,n,!0)||b,totalCollateralBalance:ve(c,t,r,n,!0)||b,totalLockedWithdraw:ve(u,t,r,n,!0)||b,totalSupply:ve(f,t,r,n,!0)||b,supplyTotalInterest:ve(d,t,r,n,!0)||b}}));function E0(){g0.pipe(l(e=>({type:"lending-assets-overview",data:e}))).subscribe(e=>N.next(e))}function S0(){m0(),E0()}rl();Qd();jd();yf();Mf();wb();Yb();Gb();Gv();sm();fm();Bm();Om();_m();jm();Xm();Ym();Gm();Zm();r0();n0();i0();S0();u0();In.onUnhandledError=function(e){if(e.type==="close"){console.warn("ws close");return}console.warn("rxjs error",e)};G.pipe(Nn(e=>e.type==="foundation-data")).subscribe(({currencies:e,contracts:t,spots:r,riskLimits:n,leverages:i,marginCurrencies:o,marginPairs:a,marginRiskLevels:s,leverageMargins:c})=>{$e.next(e),De.next(t),Ue.next(r),jo.next(n),$u.next(i),zn.next(o),Nr.next(a),Vo.next(s),zo.next(c),N.next({type:"worker-ready"})});G.pipe(Nn(e=>e.type==="ws-url"),oo(e=>e.url),wc()).subscribe(Mu);G.pipe(Nn(e=>e.type==="risk-engine-mode"),oo(e=>e.data)).subscribe(e=>rt.next(e));Ao.subscribe(e=>{console.log("WS Status:",e),N.next({type:"ws-status",data:{status:e}})});
//# sourceMappingURL=data-worker-b2656089.js.map

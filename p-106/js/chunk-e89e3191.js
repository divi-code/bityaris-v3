import{o as J,S as A,B as o,w as O,Q as Y,f as i,m as c,s as U,e as Z,q as D}from"./app-7c71c7a1.js";import{d as ee,R as $,aO as te,a as x,a9 as I,m as h,b as k,b_ as W,s as ne,bC as ae,bd as M,w as m,ba as re,e as R,aq as se,a1 as z,c as _,b3 as ce,P as E,C as ie,k as oe,j as ue,b2 as T,B}from"./chunk-a092f8ee.js";import{f as le}from"./chunk-a9a63979.js";import{p as fe}from"./chunk-4fe59fce.js";import{s as de}from"./chunk-19eee52c.js";function pe(e){return J(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}function be(e,t,n){return ee(()=>(t&&t(),e)).pipe($({bufferSize:1,refCount:!0}),pe(()=>{n&&n()}))}const q=new A,V=new o(null);V.subscribe(e=>{O.send({type:"assets",data:e})});Y.isMock()||q.pipe(te(200),x(ve),i(Boolean)).subscribe(V);async function ve(){const{data:e,error:t}=await I.getDataAssetsOverview({includeSub:!1,includeFiat:!0});return t?(h.send("toast","error",t),{userId:0,includeSub:!0,includeFiat:!0,usdTotalAssets:"0",usdtTotalAssets:"0",btcTotalAssets:"0",localCurrency:"0",localCcyTotalAssets:"0",timestampMill:"0",expiredTimeMill:"0",details:[]}):e}const ye=be(O.pipe(i(e=>e.type==="assets"),c(e=>e.data.assets),U(Be()),$(1)),()=>{Z.isServer||q.next()});function Be(){const e={btcEv:0,btc:"--",usdEv:0,usd:"--",money:"--",usdtEv:0,usdt:"--"};return{isInit:!0,...e,localCurrency:"",details:{spot:e,spotMargin:e,spotStrategy:e,contract:e,contractStrategy:e,copyTrade:e,investment:e,fiat:e,lending:e,trading:e,funding:e,spotAll:e,contractAll:e,tradingAll:e,tradingBot:e}}}const j=8,p=2,C=new o(!0),Se=new A,N=new o({assetGuide:!0,assetsTrade:!0,hideAsset:!1}),ge=new A,me=new o([]),We=ye.pipe(c(({isInit:e})=>!!e)),Me=k.pipe(W(Se),x(e=>he(e))),H=new o([]),G=new o([]);de.subscribe(e=>{const t=e.cfgList.map(a=>a.fromCurrency);if(t.length===0)return;const n=t.reduce((a,r)=>(a.indexOf(r)===-1&&a.push(r),a),[]);H.next(n)});fe.subscribe(e=>{const{rows:t}=e;if(t.length===0)return;const n=t.filter(a=>a.calculationPeriodMultiplier===1).reduce((a,r)=>(a.indexOf(r.currency)===-1&&a.push(r.currency),a),[]);G.next(n)});ge.pipe(ne(k),x(e=>Le(e))).subscribe(e=>N.next(e));ae.subscribe(()=>Q());h.subscribe("user-preference","refresh",()=>Q());const Ee=new o(X()),Te=new o(X());M.pipe(c(e=>e.find(t=>t.currency==="BTC")),i(Boolean)).subscribe(e=>Ee.next(e));M.pipe(c(e=>e.find(t=>t.currency==="USDT")),i(Boolean)).subscribe(e=>Te.next(e));const K=m.pipe(i(e=>e.length>0),W(re(R([m,ce]).pipe(c(Ce)),H.pipe(i(e=>e.length>0),c(we)),G.pipe(i(e=>e.length>0),c(Ae)),le.pipe(c($e))))).pipe(se((e,t)=>t(e),[]),$(1),z(300),U([]));K.subscribe(e=>{e.length>0&&C.next(!1)});function Ce([e,t]){return function(){return e.filter(n=>!!n.inAssetsDisplay).map(({currency:n,displayCurrency:a,name:r,status:u,valuePrecision:s,depositOpen:f,withdrawOpen:l})=>{const b=0 .toFixed(s),S=xe(n,u,t);return{name:r,currency:n,displayCurrency:a,totalBalance:b,availableBalance:b,availableBalanceEv:0,totalBalanceEv:0,freezeBalance:b,depositLink:E.ASSETS_DEPOSIT.pathname+"?"+D.stringify({currency:n}),withdrawalLink:E.ASSETS_WITHDRAWAL.pathname+"?"+D.stringify({currency:n}),earnLink:"",depositOpen:f,withdrawOpen:l,canTransfer:["BTC","ETH","USD","USDT"].indexOf(n)>-1,canConvert:!1,btcEv:0,btc:0 .toFixed(j),usdEv:0,usd:0 .toFixed(p),money:0 .toFixed(p),usdtEv:0,usdt:0 .toFixed(p),...S}})}}function we(e){return function(t){return t.map(n=>{const a=e.indexOf(n.currency)>-1;return n.canConvert===a?n:{...n,canConvert:a}})}}function Ae(e){return function(t){return t.map(n=>{const a=e.indexOf(n.currency)>-1?E.EARN.pathname:"";return n.earnLink===a?n:{...n,earnLink:a}})}}function $e(e){return function(t){return t.map(n=>{const a=e.find(r=>r.currency===n.currency);return a?{...n,totalBalance:a.totalBalance,availableBalance:a.availableBalance,freezeBalance:a.freezeBalance,totalBalanceEv:a.totalBalanceEv,availableBalanceEv:a.availableBalanceEv}:n})}}function xe(e,t,n){const a=n.find(r=>r.baseCurrency===e||r.quoteCurrency===e);if(a){const r=(["USD","USDT"].indexOf(e)===-1||t!=="Listed")&&a.status==="Listed";return{tradeLink:[ie.PHEMEX_SPOT_TRADE,"/",a.baseCurrency,a.quoteCurrency].join(""),canTrade:r}}return{tradeLink:"",canTrade:!1}}async function he(e){C.next(!0);const t={offset:e,limit:10,withCount:!0},{data:n}=await I.getMarginTransferList(t);return C.next(!1),n||[]}async function Q(){const{data:e,error:t}=await _.getPreference();e&&N.next(e),t&&h.send("toast","error",t)}async function Le(e){const{data:t}=await _.updatePreference(e);return t||{}}R([K,oe,m,ue]).pipe(z(500),c(Fe),i(Boolean)).subscribe(e=>me.next(e));function Fe([e,t,n,a]){const r=n.find(d=>d.currency==="BTC");if(!r)return null;const u=n.find(d=>d.currency==="USD");if(!u)return null;const s=t.get(".BTC");if(!s)return null;const f=w(t,a);if(!f)return null;const l=w(t,"USDT");if(!l)return null;const{valueScale:b,valueFactor:S}=r,{valueScale:g,valueFactor:y}=u;return e.map(d=>{const v=De(d,t,n,y),L=T.getBalanceEv(v,s.priceEp,y,s.priceFactor,S);if(!l)return;const F=T.getBalanceEv(v,l.priceEp,y,l.priceFactor,y);return{...d,btcEv:L,btc:B.floor(L,j,b),usdEv:v,usd:B.floor(v,p,g),money:P(v,f,p,g),usdtEv:F,usdt:P(F,l,p,g)}})}function De(e,t,n,a){const{currency:r}=e,u=n.find(f=>f.currency===r);if(!u)return 0;const s=w(t,r);return s?T.getValueEv(e.totalBalanceEv,s.priceEp,u.valueFactor,s.priceFactor,a):0}function w(e,t){return e.get("."+t)}function P(e,t,n,a){return t&&e>0?B.delimit(B.floor(e/t.priceEp,n,a-t.priceScale||0)):0 .toFixed(n)}function X(){return{isInit:!0,time:0,totalBalanceEv:0,totalBalance:"0.000000000",availableBalanceEv:0,availableBalance:"0.000000000",freezeBalanceEv:0,freezeBalance:"0.000000000"}}export{We as a,Me as b,me as c,C as d,Ee as e,Te as f,q as l,Se as o,N as p,ye as t,ge as u};
//# sourceMappingURL=chunk-e89e3191.js.map

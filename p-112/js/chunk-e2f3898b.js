import{z as Q,S as w,B as o,w as P,N as Y,b as i,m as c,s as U,e as Z,q as D}from"./app-7aa7d139.js";import{bQ as ee,as as $,A as te,aW as x,a$ as O,$ as h,aX as W,di as k,bj as ne,aV as ae,dj as re,bi as M,aN as g,dk as se,ar as R,dl as ce,dm as z,bJ as V,aH as ie,X as m,aI as oe,b5 as ue,a0 as le,b4 as T,B}from"./chunk-707a9f2f.js";import{f as fe}from"./chunk-11658a4c.js";import{p as de}from"./chunk-dc44f90f.js";function pe(e){return Q(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}function be(e,t,n){return ee(()=>(t&&t(),e)).pipe($({bufferSize:1,refCount:!0}),pe(()=>{n&&n()}))}const N=new w,_=new o(null);_.subscribe(e=>{P.send({type:"assets",data:e})});Y.isMock()||N.pipe(te(200),x(ve),i(Boolean)).subscribe(_);async function ve(){const{data:e,error:t}=await O.getDataAssetsOverview({includeSub:!1,includeFiat:!0});return t?(h.send("toast","error",t),{userId:0,includeSub:!0,includeFiat:!0,usdTotalAssets:"0",usdtTotalAssets:"0",btcTotalAssets:"0",localCurrency:"0",localCcyTotalAssets:"0",timestampMill:"0",expiredTimeMill:"0",details:[]}):e}const ye=be(P.pipe(i(e=>e.type==="assets"),c(e=>e.data.assets),U(Be()),$(1)),()=>{Z.isServer||N.next()});function Be(){const e={btcEv:0,btc:"--",usdEv:0,usd:"--",money:"--",usdtEv:0,usdt:"--"};return{isInit:!0,...e,localCurrency:"",details:{spot:e,spotMargin:e,spotStrategy:e,contract:e,contractStrategy:e,copyTrade:e,investment:e,fiat:e,lending:e,trading:e,funding:e,spotAll:e,contractAll:e,tradingAll:e,tradingBot:e}}}const j=8,p=2,A=new o(!0),Se=new w,q=new o({assetGuide:!0,assetsTrade:!0,hideAsset:!1}),Ee=new w,ge=new o([]);ye.pipe(c(({isInit:e})=>!!e));W.pipe(k(Se),x(e=>he(e)));const H=new o([]),X=new o([]);ne.subscribe(e=>{const t=e.cfgList.map(a=>a.fromCurrency);if(t.length===0)return;const n=t.reduce((a,r)=>(a.indexOf(r)===-1&&a.push(r),a),[]);H.next(n)});de.subscribe(e=>{const{rows:t}=e;if(t.length===0)return;const n=t.filter(a=>a.calculationPeriodMultiplier===1).reduce((a,r)=>(a.indexOf(r.currency)===-1&&a.push(r.currency),a),[]);X.next(n)});Ee.pipe(ae(W),x(e=>Le(e))).subscribe(e=>q.next(e));re.subscribe(()=>J());h.subscribe("user-preference","refresh",()=>J());const me=new o(K()),Te=new o(K());M.pipe(c(e=>e.find(t=>t.currency==="BTC")),i(Boolean)).subscribe(e=>me.next(e));M.pipe(c(e=>e.find(t=>t.currency==="USDT")),i(Boolean)).subscribe(e=>Te.next(e));const G=g.pipe(i(e=>e.length>0),k(se(R([g,ie]).pipe(c(Ae)),H.pipe(i(e=>e.length>0),c(Ce)),X.pipe(i(e=>e.length>0),c(we)),fe.pipe(c($e))))).pipe(ce((e,t)=>t(e),[]),$(1),z(300),U([]));G.subscribe(e=>{e.length>0&&A.next(!1)});function Ae([e,t]){return function(){return e.filter(n=>!!n.inAssetsDisplay).map(({currency:n,displayCurrency:a,name:r,status:u,valuePrecision:s,depositOpen:f,withdrawOpen:l})=>{const b=0 .toFixed(s),S=xe(n,u,t);return{name:r,currency:n,displayCurrency:a,totalBalance:b,availableBalance:b,availableBalanceEv:0,totalBalanceEv:0,freezeBalance:b,depositLink:m.ASSETS_DEPOSIT.pathname+"?"+D.stringify({currency:n}),withdrawalLink:m.ASSETS_WITHDRAWAL.pathname+"?"+D.stringify({currency:n}),earnLink:"",depositOpen:f,withdrawOpen:l,canTransfer:["BTC","ETH","USD","USDT"].indexOf(n)>-1,canConvert:!1,btcEv:0,btc:0 .toFixed(j),usdEv:0,usd:0 .toFixed(p),money:0 .toFixed(p),usdtEv:0,usdt:0 .toFixed(p),...S}})}}function Ce(e){return function(t){return t.map(n=>{const a=e.indexOf(n.currency)>-1;return n.canConvert===a?n:{...n,canConvert:a}})}}function we(e){return function(t){return t.map(n=>{const a=e.indexOf(n.currency)>-1?m.EARN.pathname:"";return n.earnLink===a?n:{...n,earnLink:a}})}}function $e(e){return function(t){return t.map(n=>{const a=e.find(r=>r.currency===n.currency);return a?{...n,totalBalance:a.totalBalance,availableBalance:a.availableBalance,freezeBalance:a.freezeBalance,totalBalanceEv:a.totalBalanceEv,availableBalanceEv:a.availableBalanceEv}:n})}}function xe(e,t,n){const a=n.find(r=>r.baseCurrency===e||r.quoteCurrency===e);if(a){const r=(["USD","USDT"].indexOf(e)===-1||t!=="Listed")&&a.status==="Listed";return{tradeLink:[oe.PHEMEX_SPOT_TRADE,"/",a.baseCurrency,a.quoteCurrency].join(""),canTrade:r}}return{tradeLink:"",canTrade:!1}}async function he(e){A.next(!0);const t={offset:e,limit:10,withCount:!0},{data:n}=await O.getMarginTransferList(t);return A.next(!1),n||[]}async function J(){const{data:e,error:t}=await V.getPreference();e&&q.next(e),t&&h.send("toast","error",t)}async function Le(e){const{data:t}=await V.updatePreference(e);return t||{}}R([G,ue,g,le]).pipe(z(500),c(Fe),i(Boolean)).subscribe(e=>ge.next(e));function Fe([e,t,n,a]){const r=n.find(d=>d.currency==="BTC");if(!r)return null;const u=n.find(d=>d.currency==="USD");if(!u)return null;const s=t.get(".BTC");if(!s)return null;const f=C(t,a);if(!f)return null;const l=C(t,"USDT");if(!l)return null;const{valueScale:b,valueFactor:S}=r,{valueScale:E,valueFactor:y}=u;return e.map(d=>{const v=De(d,t,n,y),L=T.getBalanceEv(v,s.priceEp,y,s.priceFactor,S);if(!l)return;const F=T.getBalanceEv(v,l.priceEp,y,l.priceFactor,y);return{...d,btcEv:L,btc:B.floor(L,j,b),usdEv:v,usd:B.floor(v,p,E),money:I(v,f,p,E),usdtEv:F,usdt:I(F,l,p,E)}})}function De(e,t,n,a){const{currency:r}=e,u=n.find(f=>f.currency===r);if(!u)return 0;const s=C(t,r);return s?T.getValueEv(e.totalBalanceEv,s.priceEp,u.valueFactor,s.priceFactor,a):0}function C(e,t){return e.get("."+t)}function I(e,t,n,a){return t&&e>0?B.delimit(B.floor(e/t.priceEp,n,a-t.priceScale||0)):0 .toFixed(n)}function K(){return{isInit:!0,time:0,totalBalanceEv:0,totalBalance:"0.000000000",availableBalanceEv:0,availableBalance:"0.000000000",freezeBalanceEv:0,freezeBalance:"0.000000000"}}export{Te as a,me as b,ge as c,q as p,ye as t,Ee as u};
//# sourceMappingURL=chunk-e2f3898b.js.map
